{
 "paragraphs": [
  {
   "text": "%spark.conf\n\n# It is strongly recommended to set SPARK_HOME explictly instead of using the embedded spark of Zeppelin. As the function of embedded spark of Zeppelin is limited and can only run in local mode.\nSPARK_HOME /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2\n#com.github.haifengl:smile-scala_2.12:2.5.3,com.databricks:spark-xml_2.12:0.10.0,com.github.mrpowers:spark-stringmetric_2.12:0.3.0\n#spark.jars /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2/plugins/rapids-4-spark_2.12-0.3.0.jar, /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2/plugins/cudf-0.17-cuda10-1.jar\n\n#spark.sql.warehouse.dir /home/ometaxas/Programs/zeppelin-0.9.0-preview2-bin-all/spark-warehouse\n\nspark.serializer org.apache.spark.serializer.KryoSerializer\nspark.kryoserializer.buffer.max 1000M\nspark.driver.memory 95g\nspark.driver.maxResultSize 5g \n\n#spark.rapids.sql.concurrentGpuTasks=2\n#spark.rapids.sql.enabled true\n#spark.rapids.memory.pinnedPool.size 2G \n\n#spark.plugins com.nvidia.spark.SQLPlugin \n\n#spark.locality.wait 0s \n#spark.sql.files.maxPartitionBytes 512m \n#spark.sql.shuffle.partitions 100 \n#spark.executor.resource.gpu.amount=1\n\n\nSPARK_LOCAL_DIRS /media/ometaxas/nvme/spark\n#, /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2/tmp\n                                             \n# /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2/tmp,/media/datadisk/Datasets/Spark\n#,/media/datadisk/Datasets/Spark \n#/media/datadisk/Datasets/Spark\n\n# set executor memrory 110g\n# spark.executor.memory  60g\n\n\n# set executor number to be 6\n# spark.executor.instances  6\n\n\n# Uncomment the following line if you want to use yarn-cluster mode (It is recommended to use yarn-cluster mode after Zeppelin 0.8, as the driver will run on the remote host of yarn cluster which can mitigate memory pressure of zeppelin server)\n# master yarn-cluster\n\n# Uncomment the following line if you want to use yarn-client mode (It is not recommended to use it after 0.8. Because it would launch the driver in the same host of zeppelin server which will increase memory pressure of zeppelin server)\n# master yarn-client\n\n# Uncomment the following line to enable HiveContext, and also put hive-site.xml under SPARK_CONF_DIR\n# zeppelin.spark.useHiveContext true\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-19T22:32:16+0200",
   "config": {
    "editorSetting": {
     "language": "scala",
     "editOnDblClick": false,
     "completionKey": "TAB",
     "completionSupport": true
    },
    "colWidth": 12.0,
    "editorMode": "ace/mode/scala",
    "fontSize": 9.0,
    "results": {},
    "enabled": true
   },
   "settings": {
    "params": {},
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": []
   },
   "apps": [],
   "runtimeInfos": {},
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616185936192_1433887712",
   "id": "paragraph_1616185936192_1433887712",
   "dateCreated": "2021-03-19T22:32:16+0200",
   "dateStarted": "2021-03-19T22:32:16+0200",
   "dateFinished": "2021-03-19T22:32:16+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\n\nimport org.apache.spark.sql.types._\nimport org.apache.spark.sql.functions.countDistinct;\n\nval ORGS_HOME = \"/media/ometaxas/nvme/datasets/institutions\"\n\n/*\naffId: string (nullable = true)\n |-- magId: long (nullable = true)\n |-- gridId: string (nullable = true)\n |-- ringgoldId: string (nullable = true)\n |-- wikiIds: string (nullable = true)\n |-- isniIds: string (nullable = true)\n |-- rorIds: string (nullable = true)\n |-- fundrefIds: string (nullable = true)\n |-- name: string (nullable = true)\n |-- normalizedNames: string (nullable = true)\n |-- acronyms: string (nullable = true)\n |-- urls: string (nullable = true)\n |-- wikiPageUrls: string (nullable = true)\n |-- email: string (nullable = true)\n |-- city: string (nullable = true)\n |-- state: string (nullable = true)\n |-- postCode: string (nullable = true)\n |-- countryCode: string (nullable = true)\n |-- longitude: double (nullable = true)\n |-- latitude: double (nullable = true)\n |-- magRank: long (nullable = true)\n |-- paperCount: integer (nullable = true)\n |-- paperFamilyCount: integer (nullable = true)\n |-- citationCount: integer (nullable = true)\n */\nval institutionsTsvFilename = \"AffiliationsExtended.tsv\" \n                              \nval institutionsSchema = new StructType().\n                add(\"affId\", StringType, true).\n                add(\"magId\", LongType, false).\n                add(\"gridId\", StringType, true).                \n                add(\"ringgoldId\", StringType, true).\n                add(\"wikiIds\",StringType, true).\n                add(\"isniIds\",StringType, true).\n                add(\"rorIds\",StringType, true).\n                add(\"fundrefIds\", StringType, true).\n                add(\"name\", StringType, true).\n                add(\"normalizedNames\", StringType, true).\n                add(\"acronyms\", StringType, true).\n                add(\"urls\", StringType, true).\n                add(\"wikiPageUrls\", StringType, true).\n                add(\"email\", StringType, true).\n                add(\"city\", StringType, true).\n                add(\"state\", StringType, true).\n                add(\"postCode\", StringType, true).\n                add(\"countryCode\", StringType, true).\n                add(\"longitude\", DoubleType, true).\n                add(\"latitude\", DoubleType, true).\n                add(\"magRank\", LongType, false).\n                add(\"paperCount\", LongType, false).\n                add(\"paperFamilyCount\", LongType, false).\n                add(\"citationCount\", LongType, false)\n\n                \nval institutionsdf = spark.read.options(Map(\"sep\"->\"\\t\", \"header\"-> \"false\")).\n                schema(institutionsSchema).\n                csv(s\"file://$ORGS_HOME/$institutionsTsvFilename\")\n    .withColumn(\"normalizedNamesArr\", split(col(\"normalizedNames\"),\"\\\\|\\\\|\")).\n       withColumn(\"urlsArr\", split(regexp_replace(col(\"urls\"),\"(https?\\\\://)|/\",\"\"),\"\\\\|\\\\|\"))\n\n/*\nval cases = institutionsdf\n.filter(\n    //array_contains($\"normalizedNamesArr\",\"canon\") || \n//        $\"ringgoldId\"===\"11776\" || \n    array_contains($\"normalizedNamesArr\",\"university of paris\") ||\n    array_contains($\"normalizedNamesArr\",\"oklahoma state university\") ||\n    array_contains($\"normalizedNamesArr\",\"rio tinto) ||\n    //array_contains($\"normalizedNamesArr\",\"mitsubishi electric\") ||\n    //array_contains($\"normalizedNamesArr\",\"toyota\") ||\n    array_contains($\"normalizedNamesArr\",\"university of rennes\")  \n  //      array_contains($\"normalizedNamesArr\",\"world health organization\") ||\n     \n    \n).select(     $\"affId\", $\"magId\",$\"gridId\",$\"ringgoldId\",$\"wikiIds\",$\"rorIds\",$\"name\",$\"normalizedNames\",$\"urls\",$\"countryCode\")\n        .cache()\n\ncases.show()\n   cases.coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/cases2.csv\")\n\n//institutionsdf.show(5,true)\n\n\n\nval rin_grid = institutionsdf\n.filter($\"gridId\"=!=\"\" && !isnull($\"gridId\") && $\"ringgoldId\"=!=\"\" && !isnull($\"ringgoldId\") )\n        .cache()\n\nprintln(rin_grid.count())\nrin_grid.show(20)\n\n\nval grid_noRing = institutionsdf\n.filter(\n    $\"gridId\"=!=\"\" && !isnull($\"gridId\") \n        //&& \n   //$\"magId\"=!=0 && !isnull($\"magId\") \n        && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\")) \n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\ngrid_noRing.show(50)\nprintln(grid_noRing.count())\n\n*/\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-19T22:32:19+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Table",
        "table": {
         "columnWidths": {
          "name": 223.0
         }
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "import org.apache.spark.sql.types._\nimport org.apache.commons.lang.StringUtils\nimport java.lang.Integer.parseInt\nimport org.slf4j.Logger\nimport org.slf4j.LoggerFactory\nimport org.apache.spark.sql.functions.concat_ws\nimport org.apache.spark.sql.functions.countDistinct\nimport org.apache.commons.lang3.StringUtils\nimport java.text.Normalizer\nimport java.util.Locale\nimport org.apache.spark.storage.StorageLevel\nimport java.util.Calendar\n\u001b[1m\u001b[34mORGS_HOME\u001b[0m: \u001b[1m\u001b[32mString\u001b[0m = /media/ometaxas/nvme/datasets/institutions\n\u001b[1m\u001b[34minstitutionsTsvFilename\u001b[0m: \u001b[1m\u001b[32mString\u001b[0m = AffiliationsExtended.tsv\n\u001b[1m\u001b[34minstitutionsSchema\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.types.StructType\u001b[0m = StructType(StructField(affId,StringType,true), StructField(magId,LongType,false), StructField(gridId,S...\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {},
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616185939193_652137251",
   "id": "paragraph_1616185939193_652137251",
   "dateCreated": "2021-03-19T22:32:19+0200",
   "dateStarted": "2021-03-19T22:32:19+0200",
   "dateFinished": "2021-03-19T22:32:30+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\ninstitutionsdf\n.filter( \n  //  ($\"normalizedNames\".contains(\"rio tinto\")    &&  $\"urls\".contains(\"riotinto.com\"))\n    //        ||\n            (  array_contains($\"normalizedNamesArr\",\"university of paris\")) \n            )\n        //.show()\n        .select(     $\"affId\", $\"magId\",$\"gridId\",$\"ringgoldId\",$\"wikiIds\",$\"rorIds\",$\"name\",$\"normalizedNames\",$\"urls\",$\"countryCode\", $\"wikiPageUrls\")\n.coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/uniofParis.csv\")\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T15:20:09+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Table",
        "table": {
         "visibleColumn": 5.0,
         "columnWidths": {
          "wikiPageUrls": 268.0
         }
        },
        "chart": {
         "series": [
          {
           "type": "Line",
           "x": {
            "column": "affId",
            "index": 0.0
           },
           "y": {
            "column": "longitude",
            "index": 18.0
           }
          }
         ]
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": []
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=51"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616246409968_492254287",
   "id": "paragraph_1616246409968_492254287",
   "dateCreated": "2021-03-20T15:20:09+0200",
   "dateStarted": "2021-03-20T15:20:09+0200",
   "dateFinished": "2021-03-20T15:20:12+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\n/*\n|-- magId: long (nullable = true)\n |-- gridId: string (nullable = true)\n |-- ringgoldId: string (nullable = true)\n |-- wikiIds: string (nullable = true)\n |-- isniIds: string (nullable = true)\n |-- rorIds: string (nullable = true)\n |-- fundrefIds: string (nullable = true)\n |-- name: string (nullable = true)\n |-- normalizedNames: string (nullable = true)\n |-- acronyms: string (nullable = true)\n |-- urls: string (nullable = true)\n |-- wikiPageUrls: string (nullable = true)\n |-- email: string (nullable = true)\n |-- city: string (nullable = true)\n |-- state: string (nullable = true)\n |-- postCode: string (nullable = true)\n |-- countryCode: string (nullable = true)\n |-- longitude: double (nullable = true)\n |-- latitude: double (nullable = true)\n |-- magRank: long (nullable = true)\n |-- paperCount: integer (nullable = true)\n |-- paperFamilyCount: integer (nullable = true)\n |-- citationCount: integer (nullable = true)\n*/\nimport org.apache.spark.sql.expressions.Window\nimport org.apache.spark.sql.functions._\n\nval grid_noRing = institutionsdf\n.filter(\n    ($\"gridId\"=!=\"\" && !isnull($\"gridId\") \n     && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\")))    || \n   ($\"magId\"=!=0 && !isnull($\"magId\") \n        && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\"))\n        && ($\"gridId\"===\"\" || isnull($\"gridId\"))) \n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\ngrid_noRing.show(50)\nprintln(grid_noRing.count())\n\nval name_based_matchesall = institutionsdf.as(\"df1\").join(broadcast(grid_noRing.as(\"df2\")),  \n    arrays_overlap($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\") && $\"df1.affId\" =!=$\"df2.affId\" \n            && arrays_overlap($\"df1.urlsArr\",$\"df2.urlsArr\") \n&& $\"df2.countryCode\" === $\"df1.countryCode\"\n    , \"inner\")\n .select(  $\"df2.affId\", $\"df2.magId\",$\"df2.gridId\",$\"df2.ringgoldId\",$\"df2.wikiIds\",$\"df2.isniIds\" ,$\"df2.rorIds\",$\"df2.fundrefIds\", $\"df2.name\", $\"df2.normalizedNames\",\n                    $\"df2.acronyms\", $\"df2.urls\",$\"df2.wikipageurls\",$\"df2.email\", $\"df2.city\",$\"df2.state\",$\"df2.postCode\",$\"df2.countryCode\", \n                  $\"df2.latitude\",$\"df2.longitude\",$\"df2.papercount\",$\"df2.magrank\",$\"df2.citationcount\",$\"df2.paperFamilyCount\",\n                      $\"df1.affId\".as(\"affId1\"), $\"df1.name\".as(\"name1\"), $\"df1.ringgoldId\".as(\"ringgoldId1\"),$\"df1.gridId\".as(\"gridId1\"),$\"df1.magId\".as(\"magId1\"),\n             array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\").as(\"normalizedNamesArrAll\"),\n            array_union($\"df1.urlsArr\",$\"df2.urlsArr\").as(\"urlsArrAll\"),\n              array_join(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\"), \"||\").as(\"normalizedNamesAll\"),\n                array_join(array_union($\"df1.urlsArr\",$\"df2.urlsArr\"), \"||\").as(\"urlsAll\"), \n                ((size(array_intersect($\"df1.urlsArr\",$\"df2.urlsArr\")) / size(array_union($\"df1.urlsArr\",$\"df2.urlsArr\")))+\n                (size(array_intersect($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")) / size(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")))).as(\"jaccname\")\n         //, ($\"jaccurl\"+$\"jaccname\").as(\"jacc\")\n                \n                )\n        .orderBy($\"df1.name\")\n        .cache()\n\nprintln(name_based_matchesall.count())\nname_based_matchesall.show(true)\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T14:04:22+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Table",
        "table": {
         "visibleRow": 3.0
        },
        "chart": {
         "series": [
          {
           "type": "Line",
           "x": {
            "column": "paperCount",
            "index": 21.0
           },
           "y": {
            "column": "magId",
            "index": 1.0
           }
          }
         ]
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "\u001b[33mwarning: \u001b[0mthere was one feature warning; for details, enable `:setting -feature' or `:replay -feature'\n+--------------------+----------+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+-----------+--------------+--------+-----------+-----------+-----------+-------+----------+----------------+-------------+--------------------+--------------------+\n|               affId|     magId|       gridId|ringgoldId|  wikiIds|         isniIds|   rorIds|fundrefIds|                name|     normalizedNames|acronyms|                urls|        wikiPageUrls|email|       city|         state|postCode|countryCode|  longitude|   latitude|magRank|paperCount|paperFamilyCount|citationCount|  normalizedNamesArr|             urlsArr|\n+--------------------+----------+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+-----------+--------------+--------+-----------+-----------+-----------+-------+----------+----------------+-------------+--------------------+--------------------+\n|           204730241| 204730241|         null|      null|     null|            null|     null|      null| University of Paris| university of paris|    null|https://www.aup.edu/|http://en.wikiped...| null|       null|          null|    null|         FR|   2.343333|   48.84861|   6232|    170325|          165165|      3415062|[university of pa...|       [www.aup.edu]|\n|1320697193_grid.4...|1320697193|grid.471046.0|      null|   Q62621|0000000106715048|05gg0gh87|      null|          Canon Inc.|canon||canon inc|...|    null|http://canon.jp/|...|http://en.wikiped...| null|      Tokyo|          null|    null|         FR|  -1.624552| 48.1325569|   7138|     70036|           70007|       915384|[canon, canon inc...|[canon.jp, global...|\n|            72090969|  72090969|         null|      null|     null|            null|     null|      null|           Bell Labs|           bell labs|    null|http://www.bell-l...|http://en.wikiped...| null|       null|          null|    null|         US|  -71.09401| 42.3603859|   6344|     57761|           55994|      2389111|         [bell labs]| [www.bell-labs.com]|\n|1306287861_grid.5...|1306287861|grid.508713.8|      null|  Q183275|0000000122938380|0234cd281|      null|          Mitsubishi|mitsubishi||mitsu...|    null|http://www.mitsub...|http://en.wikiped...| null|      Tokyo|          null|    null|         JP| 139.808853|   35.68408|   7224|     51641|           51461|       830631|[mitsubishi, mits...|[www.mitsubishi.c...|\n|1293612202_grid.4...|1293612202|grid.481782.0|      null|Q30273407|            null|05p0pbv75|      null|              Toyota|toyota||toyota ag...|    null|http://www.toyota...|http://en.wikiped...| null|   Safenwil|          null|    null|         US|  -95.36219| 29.7511616|   7529|     47660|           47342|       641509|[toyota, toyota a...|[www.toyota-globa...|\n|             9217761|   9217761|         null|      null|     null|            null|     null|      null|Westinghouse Elec...|westinghouse elec...|    null|http://www.westin...|http://en.wikiped...| null|       null|          null|    null|         US|  -79.78011|   40.43646|   7529|     37557|           37303|       460384|[westinghouse ele...|[www.westinghouse...|\n|19268510_grid.472...|  19268510|grid.472821.a|      null|Q28974281|            null|04d3djg48|      null|            Qualcomm|            qualcomm|    null|https://www.qualc...|http://en.wikiped...| null|Farnborough|          null|    null|         US|  -117.1957|    32.8952|   7743|     37137|           36892|       709987|          [qualcomm]|  [www.qualcomm.com]|\n|            78570951|  78570951|         null|      null|     null|            null|     null|      null|Monash University...|monash university...|    null|                null|http://en.wikiped...| null|       null|          null|    null|         AU|    145.134|     -37.91|   7787|     36571|           35949|       968776|[monash universit...|                null|\n|           115475287| 115475287|         null|      null|     null|            null|     null|      null|Oklahoma State Un...|oklahoma state un...|    null|http://go.okstate...|http://en.wikiped...| null|       null|          null|    null|         US|  -97.08083|   36.13222|   7604|     35813|           35196|       770320|[oklahoma state u...|    [go.okstate.edu]|\n|1309191912_grid.4...|1309191912|grid.419178.2|      null| Q1187093|0000000106617229|03eqttr49|      null|Research Triangle...|research triangle...|     RTP| http://www.rtp.org/|http://en.wikiped...| null|     Durham|North Carolina|    null|         US|  -78.86278|   35.90806|   7436|     34844|           34452|      1288744|[research triangl...|       [www.rtp.org]|\n|1306339040_grid.2...|1306339040|grid.28287.37|      null|   Q52618|0000000121810895|05a7rhx54|      null|            Ericsson|ericson||ericsson...|    null|http://www.ericss...|http://en.wikiped...| null|      Kista|          null|    null|         SE|   17.95499|   59.40567|   7833|     34654|           34419|       507958|[ericson, ericsso...|[www.ericsson.com...|\n|1326427960_grid.4...|1326427960|grid.475296.b|      null|Q30268063|            null|00wdsp051|      null|Fred Hutchinson C...|cape town hvtn im...|    CHIL|http://www.chil.o...|http://en.wikiped...| null|  Cape Town|          null|    null|         ZA| 18.4238224|  -33.92478|   7127|     31242|           30747|      1746457|[cape town hvtn i...|[www.chil.org.za,...|\n|            56067802|  56067802|         null|      null|     null|            null|     null|      null|University of Rennes|university of rennes|    null|                null|http://en.wikiped...| null|       null|          null|    null|         FR|   -1.68449|   48.10804|   8152|     30128|           29208|       593994|[university of re...|                null|\n|          2738502077|2738502077|         null|      null|     null|            null|     null|      null|               Nokia|               nokia|    null|http://www.nokia....|http://en.wikiped...| null|       null|          null|    null|         FI|    24.7566|   60.22471|   7814|     27926|           27773|       603288|             [nokia]|     [www.nokia.com]|\n|          2279609970|2279609970|         null|      null|     null|            null|     null|      null| university of lille| university of lille|    null|                null|http://en.wikiped...| null|       null|          null|    null|         FR| 2.33826232|   46.63728|   8414|     27284|           26684|       414080|[university of li...|                null|\n|1288702032_grid.4...|1288702032|grid.488641.7|      null| Q1937182|0000000107273536|05p70jq59|      null|Ministry of Educa...|ministere de ledu...|    null|http://www.educat...|http://en.wikiped...| null| Wellington|          null|    null|         NZ| 174.778778|-41.2756157|   8668|     26081|           25896|       354365|[ministere de led...|[www.education.go...|\n|1310053265_grid.4...|1310053265|grid.464688.0|      null| Q3495316|0000000123007844|0001ke483|      null|St George's Hospital|st george s hospi...|    null|http://www.stgeor...|http://en.wikiped...| null|     London|          null|    null|         GB|    -0.1757|    51.4267|   7869|     24452|           24326|       876545|[st george s hosp...|[www.stgeorges.nh...|\n|39854257_grid.474...|  39854257|grid.474748.c|      null|Q29124061|            null|04ccqwj03|      null| Mitsubishi Electric| mitsubishi electric|   MELCO|http://de.mitsubi...|http://en.wikiped...| null|   Ratingen|          null|    null|         DE|   6.866118| 51.2926445|   8470|     23954|           23609|       205056|[mitsubishi elect...|[de.mitsubishiele...|\n|142066694_grid.48...| 142066694|grid.481662.f|      null|Q30273357|            null|04wwsbd59|      null|Industrial Techno...|industrial techno...|    ITRI|http://www.itri.o...|http://en.wikiped...| null|   San Jose|    California|    null|         US|-121.927765|   37.39521|   8581|     23051|           22934|       286524|[industrial techn...|[www.itri.org.tw,...|\n|140025399_grid.46...| 140025399|grid.461671.3|      null|  Q224514|0000000405891084|03m2kj587|      null| Hochschule Hannover|fachhochschule ha...|     HsH|http://www.hs-han...|http://en.wikiped...| null|    Hanover|          null|    null|         DE|   9.724167|   52.35361|   8623|     21597|           21496|       347157|[fachhochschule h...|[www.hs-hannover....|\n|1290603121_grid.4...|1290603121|grid.475671.6|      null|Q30268380|            null|047bn1w15|      null|World Health Orga...|who||world health...|     WHO|http://www.who.in...|http://en.wikiped...| null|  Islamabad|          null|    null|         CH|    6.13417|   46.23222|   7512|     21092|           20884|       923493|[who, world healt...|[www.who.int, www...|\n|          2251713219|2251713219|         null|      null|     null|            null|     null|      null|Nippon Telegraph ...|nippon telegraph ...|    null|http://www.ntt.co...|http://en.wikiped...| null|       null|          null|    null|         JP| 139.808853|   35.68408|   8425|     20700|           20172|       301633|[nippon telegraph...|     [www.ntt.co.jp]|\n|2802905097_grid.4...|2802905097|grid.416526.2|      null| Q2945713|            null|03s3dhf22|      null|  St Mary's Hospital|centre hospitalie...|    null|http://www.smhc.q...|http://en.wikiped...| null|   Montreal|        Quebec|    null|         CA|  -73.62417|   45.49472|   8303|     20256|           20136|       485439|[centre hospitali...|  [www.smhc.qc.caen]|\n|318025780_grid.48...| 318025780|grid.481660.d|      null|Q30343831|            null|043xc2b47|      null|             Foxconn|foxconn||foxconn ...|    null|http://www.foxcon...|http://en.wikiped...| null|   San Jose|    California|    null|         US|-121.890228| 37.3512878|   8939|     20107|           20107|       133317|[foxconn, foxconn...|   [www.foxconn.com]|\n|            67826202|  67826202|         null|      null|     null|            null|     null|      null|Helsinki Universi...|helsinki universi...|    null|  http://www.tkk.fi/|http://en.wikiped...| null|       null|          null|    null|         FI|   24.82778|   60.18583|   8257|     19435|           18998|       537733|[helsinki univers...|        [www.tkk.fi]|\n|          1306430637|1306430637|         null|      null|     null|            null|     null|      null|St. Vincent's Hea...|st vincent s heal...|    null|http://www.stvhs....|http://en.wikiped...| null|       null|          null|    null|         US|  -86.78954| 33.5083923|   8433|     19093|           18950|       469231|[st vincent s hea...|     [www.stvhs.com]|\n|           918370745| 918370745|         null|      null|     null|            null|     null|      null|College of Health...|college of health...|    null|http://www.uob.ed...|http://en.wikiped...| null|       null|          null|    null|         BH|   50.57361|   26.21694|   8828|     18923|           18819|       244977|[college of healt...|[www.uob.edu.bhen...|\n|97429440_grid.8155.9|  97429440|  grid.8155.9|      null| Q1072029|0000000121755152|01se4f844| 100009878| University of Wales|prifysgol cymru||...|    null|http://www.wales....|http://en.wikiped...| null|    Cardiff|          null|    null|         GB|  -3.181384|   51.48543|   8256|     18585|           18482|       581733|[prifysgol cymru,...|   [www.wales.ac.uk]|\n|1297363086_grid.4...|1297363086|grid.415502.7|      null| Q3145237|            null|04skqfp25|      null|St. Michael's Hos...|hopital st michae...|    null|http://www.stmich...|http://en.wikiped...| null|    Toronto|       Ontario|    null|         CA|   -79.3775|    43.6532|   8355|     18558|           18462|       503378|[hopital st micha...|[www.stmichaelsho...|\n|           862296814| 862296814|         null|      null|     null|            null|     null|      null|Business Internat...|business internat...|    null|                null|http://en.wikiped...| null|       null|          null|    null|         US|  -74.00349| 40.7140541|   8738|     18400|           18387|       279573|[business interna...|                null|\n|36527812_grid.473...|  36527812|grid.473117.7|      null|Q28974293|            null|01jn7ba52|      null|         Halliburton|         halliburton|    null|http://www.hallib...|http://en.wikiped...| null|   Arbroath|          null|    null|         US|-95.3155441|   29.78918|   8890|     18124|           17912|       219219|       [halliburton]|[www.halliburton....|\n|           169238054| 169238054|         null|      null|     null|            null|     null|      null|Czechoslovak Acad...|czechoslovak acad...|    null|                null|http://en.wikiped...| null|       null|          null|    null|         CZ|  14.416667| 50.0833321|   8867|     17932|           17794|       239285|[czechoslovak aca...|                null|\n|           103775301| 103775301|         null|      null|     null|            null|     null|      null|          PetroChina|          petrochina|    null|http://www.petroc...|http://en.wikiped...| null|       null|          null|    null|         CN| 116.416367|   39.92855|   9412|     17504|           17495|        75838|        [petrochina]|[www.petrochina.c...|\n|          1293067938|1293067938|         null|      null|     null|            null|     null|      null|International Ins...|international ins...|    null|http://www.iimn.org/|http://en.wikiped...| null|       null|          null|    null|         US|  -93.09648|   44.94339|   8611|     17092|           16931|       420205|[international in...|      [www.iimn.org]|\n|           865419266| 865419266|         null|      null|     null|            null|     null|      null|Catholic Universi...|catholic universi...|    null|                null|http://en.wikiped...| null|       null|          null|    null|         BE|   4.612222| 50.6697235|   8339|     16707|           16472|       575720|[catholic univers...|                null|\n|1311921367_grid.4...|1311921367|grid.471110.2|      null|Q28971311|            null|02yh0k313|      null|Advanced Micro De...|advanced micro de...|     AMD|http://www.amd.co...|http://en.wikiped...| null|    Markham|       Ontario|    null|         US|-121.998764|  37.386673|   8471|     16658|           16622|       267927|[advanced micro d...|[www.amd.com, www...|\n|          2898336195|2898336195|         null|      null|     null|            null|     null|      null|Netherlands Cance...|netherlands cance...|    null|                null|                null| null|       null|          null|    null|         NL| 5.00276947| 52.3532181|   7907|     16602|           16472|       903792|[netherlands canc...|                null|\n|           193659739| 193659739|         null|      null|     null|            null|     null|      null|               Ciber|               ciber|    null|http://www.ciber....|http://en.wikiped...| null|       null|          null|    null|         US|-104.890518| 39.6012268|   8503|     16582|           16420|       410341|             [ciber]|     [www.ciber.com]|\n|1324925910_grid.4...|1324925910|grid.425213.3|      null| Q1143779|0000000122161532|054gk2851|      null| St Thomas' Hospital|hospital saint th...|    null|http://www.guysan...|http://en.wikiped...| null|     London|          null|    null|         GB|   -0.11891|    51.4991|   8495|     15710|           15618|       464063|[hospital saint t...|[www.guysandsttho...|\n|170726198_grid.10...| 170726198|grid.10822.39|      null| Q1263535|000000012149743X|00xa57a59|      null|University of Nov...|universidad de no...|    null|http://www.uns.ac...|http://en.wikiped...| null|   Novi Sad|          null|    null|         RS|   19.82861|   45.24214|   9435|     14295|           14106|       118415|[universidad de n...|[www.uns.ac.rs, w...|\n|          2948482138|2948482138|         null|      null|     null|            null|     null|      null|Fujifilm Holdings...|            fujifilm|    null|https://www.fujif...|https://en.wikipe...| null|       null|          null|    null|         JP| 139.808945|   35.68321|   9123|     14101|           14088|       122773|          [fujifilm]|  [www.fujifilm.com]|\n|            81082344|  81082344|         null|      null|     null|            null|     null|      null|     Science College|     science college|    null|                null|http://en.wikiped...| null|       null|          null|    null|         GB|-2.21251178| 54.5608864|   9449|     14090|           14032|       104123|   [science college]|                null|\n|             2388115|   2388115|         null|      null|     null|            null|     null|      null|Japan Atomic Ener...|japan atomic ener...|    null|                null|http://en.wikiped...| null|       null|          null|    null|         JP| 139.077271| 36.2816467|   9075|     13733|           13642|       160277|[japan atomic ene...|                null|\n|127558574_grid.10...| 127558574|grid.10760.30|      null|  Q902650|0000000111089942|00k01kt20|      null|                 DSM|dsm||dutch state ...|    null|http://www.dsm.co...|http://en.wikiped...| null|    Heerlen|          null|    null|         CH|   7.740793| 47.5396576|   8239|     13417|           13206|       323294|[dsm, dutch state...|[www.dsm.com, www...|\n|           119233137| 119233137|         null|      null|     null|            null|     null|      null|Nicolaus Copernic...|nicolaus copernic...|    null|http://www.umk.pl/en|http://en.wikiped...| null|       null|          null|    null|         PL|   18.57222|   53.01833|   9411|     13268|           13027|       129111|[nicolaus coperni...|      [www.umk.plen]|\n|          2738703131|2738703131|         null|      null|     null|            null|     null|      null|French Alternativ...|french alternativ...|    null|http://www.cea.fr...|http://en.wikiped...| null|       null|          null|    null|         FR| 2.33826232|   46.63728|   8621|     12837|           12705|       333030|[french alternati...| [www.cea.frenglish]|\n|            69234490|  69234490|         null|      null|     null|            null|     null|      null|Wellington Manage...|wellington manage...|    null|http://www.wellin...|http://en.wikiped...| null|       null|          null|    null|         US|  -71.05172|   42.35256|   8981|     12626|           12554|       246676|[wellington manag...|[www.wellington.com]|\n|           139179871| 139179871|         null|      null|     null|            null|     null|      null|       Union Carbide|       union carbide|    null|http://www.unionc...|http://en.wikiped...| null|       null|          null|    null|         US|  -95.62241| 29.7656269|   8574|     12485|           12459|       203626|     [union carbide]|[www.unioncarbide...|\n|            52119777|  52119777|         null|      null|     null|            null|     null|      null|   American Cyanamid|   american cyanamid|    null|                null|http://en.wikiped...| null|       null|          null|    null|         US|  -74.67691|   40.13878|   8780|     12461|           12420|       198434| [american cyanamid]|                null|\n|33375025_grid.472...|  33375025|grid.472764.4|      null|Q28971301|            null|05tw0wf88|      null|              Airbus|              airbus|    null|http://www.airbus...|http://en.wikiped...| null|  Bengaluru|     Karnataka|    null|         FR| 1.37002969|   43.61207|   9559|     12345|           12299|        71331|            [airbus]|[www.airbus.com, ...|\n+--------------------+----------+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+-----------+--------------+--------+-----------+-----------+-----------+-------+----------+----------------+-------------+--------------------+--------------------+\nonly showing top 50 rows\n\n57869\n4045\n+--------------------+----------+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+----------------+---------------+--------+-----------+----------+-----------+----------+-------+-------------+----------------+--------------------+--------------------+-----------+-------------+--------+---------------------+--------------------+--------------------+--------------------+-------------------+\n|               affId|     magId|       gridId|ringgoldId|  wikiIds|         isniIds|   rorIds|fundrefIds|                name|     normalizedNames|acronyms|                urls|        wikipageurls|email|            city|          state|postCode|countryCode|  latitude|  longitude|papercount|magrank|citationcount|paperFamilyCount|              affId1|               name1|ringgoldId1|      gridId1|  magId1|normalizedNamesArrAll|          urlsArrAll|  normalizedNamesAll|             urlsAll|           jaccname|\n+--------------------+----------+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+----------------+---------------+--------+-----------+----------+-----------+----------+-------+-------------+----------------+--------------------+--------------------+-----------+-------------+--------+---------------------+--------------------+--------------------+--------------------+-------------------+\n|       grid.498512.3|      null|grid.498512.3|      null|Q56585268|            null|01sxvbm95|      null|10X Genomics (Uni...|        10x genomics|    null|https://www.10xge...|                null| null|      Pleasanton|     California|    null|         US|  37.66166|-121.877016|      null|   null|         null|            null|              586806|        10X Genomics|     586806|         null|    null|       [10x genomics]|[www.10xgenomics....|        10x genomics| www.10xgenomics.com|                2.0|\n|       grid.460041.7|      null|grid.460041.7|      null|Q30260759|            null|03kvr9360|      null|181st Hospital of...|181st hospital of...|    null|http://www.gl181....|                null| null|          Guilin|           null|    null|         CN| 25.264363| 110.291831|      null|   null|         null|            null|              477284|181st Hospital of...|     477284|         null|    null| [181st hospital o...|     [www.gl181.com]|181st hospital of...|       www.gl181.com|                1.5|\n|       grid.476754.3|      null|grid.476754.3|      null|Q30269347|            null|05yjdg022|      null|BBB Therapeutics ...|    bbb therapeutics|    null|http://www.bbbthe...|                null| null|          Leiden|           null|    null|         NL| 52.168114|   4.464765|      null|   null|         null|            null|              497790|  2-BBB Medicines BV|     497790|         null|    null| [2bbb medicines b...|[www.2-bbb.com, w...|2bbb medicines bv...|www.2-bbb.com||ww...| 0.8333333333333333|\n|       grid.280939.9|      null|grid.280939.9|      null|Q18148644|            null|03ywwzv91|      null|        3C Institute|3c institute||3c ...| 3-C ISD|http://www.3cisd....|https://en.wikipe...| null|            Cary| North Carolina|    null|         US| 35.907945| -78.889225|      null|   null|         null|            null|              383454|        3C Institute|     383454|         null|    null| [3c institute, ce...|[www.3cisd.com, w...|3c institute||cen...|www.3cisd.com||ww...|               0.75|\n|       grid.450536.1|      null|grid.450536.1|      null| Q4645852|0000000122171386|00hm4yk03|      null|92nd Street Young...|92nd street y||92...| YM-YWHA|https://www.92y.org/|https://en.wikipe...| null|        New York|       New York|    null|         US|    40.783|   -73.9527|      null|   null|         null|            null|              156225|92nd Street Young...|     156225|         null|    null| [92nd street y, 9...|       [www.92y.org]|92nd street y||92...|         www.92y.org|                2.0|\n|       grid.483180.6|      null|grid.483180.6|      null|Q33121200|            null|01s3m0650|      null|Institute of Chem...|ichph||institute ...|   IChPh| http://chph.sci.am/|                null| null|         Yerevan|           null|    null|         AM| 40.202973|   44.54344|      null|   null|         null|            null|              230754|A B Nalbandyan In...|     230754|         null|    null| [a b nalbandyan i...|       [chph.sci.am]|a b nalbandyan in...|         chph.sci.am| 1.3333333333333333|\n|           136708864| 136708864|         null|      null|     null|            null|     null|      null|            ABN AMRO|            abn amro|    null|http://www.abnamr...|http://en.wikiped...| null|            null|           null|    null|         NL|  52.33701|    4.87488|       186|  13298|         4022|             168|                1185|            ABN AMRO|       1185|         null|    null| [abn amro, fortis...|   [www.abnamro.com]|abn amro||fortis ...|     www.abnamro.com|                1.5|\n|       grid.474928.4|      null|grid.474928.4|      null|Q30267770|            null|02p3be630|      null|ACCESS Health Int...|access health int...|    null| http://accessh.org/|                null| null|        New York|       New York|    null|         US| 40.779233| -73.961415|      null|   null|         null|            null|              560716|ACCESS Health Int...|     560716|         null|    null| [access health in...|       [accessh.org]|access health int...|         accessh.org|                2.0|\n|1338984714_grid.4...|1338984714|grid.423659.f|      null|  Q290718|            null|055kr0e44|      null|ADVA Optical Netw...|adva optical netw...|    null|http://www.advaop...|http://en.wikiped...| null|          Munich|           null|    null|         DE|48.1113243|  11.447998|       446|  12724|         2897|             436|grid.432353.0_541932|ADVA Optical Netw...|     541932|grid.432353.0|    null| [adva optical net...|[www.adva.com, ww...|adva optical netw...|www.adva.com||www...| 1.3333333333333333|\n|          1332341397|1332341397|         null|      null|     null|            null|     null|      null|               AECOM|               aecom|    null|http://www.aecom....|http://en.wikiped...| null|            null|           null|    null|         US|37.7851868|  -122.4043|      1634|  11529|        15689|            1617|grid.420742.7_102388|AECOM Technology ...|     102388|grid.420742.7|    null| [aecom, aecom nat...|[www.aecom.com, w...|aecom||aecom nati...|www.aecom.com||ww...|0.39999999999999997|\n|181235365_grid.47...| 181235365|grid.472733.6|      null|Q30263985|            null|017qkhg51|      null|     AES Corporation|aes||aes corporation|    null|http://www.aes.co...|http://en.wikiped...| null|           Larne|           null|    null|         US| 38.879837|  -77.11235|        41|  14981|          294|              41|  grid.467158.9_1308|            AES Corp|       1308|grid.467158.9|    null| [aes, aes corp, a...|       [www.aes.com]|aes||aes corp||ae...|         www.aes.com| 1.3333333333333333|\n|181235365_grid.47...| 181235365|grid.472733.6|      null|Q30263985|            null|017qkhg51|      null|     AES Corporation|aes||aes corporation|    null|http://www.aes.co...|http://en.wikiped...| null|           Larne|           null|    null|         US| 38.879837|  -77.11235|        41|  14981|          294|              41|grid.467158.9_452940|AES Energy Storag...|     452940|grid.467158.9|    null| [aes, aes corp, a...|[aesenergystorage...|aes||aes corp||ae...|aesenergystorage....| 0.7857142857142857|\n|882437043_grid.48...| 882437043|grid.481706.c|      null|Q30713551|            null|021wep716|      null|                AGCO|                agco|    null|http://www.agcoco...|http://en.wikiped...| null|         Helmond|           null|    null|         US|34.0138779|-84.1696548|      1009|  12163|         2937|            1009|grid.480023.d_355393|           AGCO Corp|     355393|grid.480023.d|    null| [agco, agco allis...|  [www.agcocorp.com]|agco||agco allis|...|    www.agcocorp.com|                1.1|\n|          1290442905|1290442905|         null|      null|     null|            null|     null|      null|AIDS Action Commi...|aids action commi...|    null| http://www.aac.org/|http://en.wikiped...| null|            null|           null|    null|         US|  42.32028|   -71.0995|        13|  16817|           15|              13|               20151|AIDS Action Commi...|      20151|         null|    null| [aids action comm...|       [www.aac.org]|aids action commi...|         www.aac.org|                2.0|\n|          1302733789|1302733789|         null|      null|     null|            null|     null|      null|AIDS Foundation o...|aids foundation o...|    null|http://www.aidsch...|http://en.wikiped...| null|            null|           null|    null|         US|  41.87841|   -87.6341|        38|  15252|          318|              38|              581923|AIDS Foundation o...|     581923|         null|    null| [afc, aids founda...|[www.aidschicago....|afc||aids foundat...| www.aidschicago.org|                1.5|\n|1328068280_grid.4...|1328068280|grid.422943.a|      null|Q20312965|            null|05kvxgx64|      null|The AIDS Support ...|the aids support ...|    TASO|http://www.tasoug...|https://en.wikipe...| null|         Kampala|           null|    null|         UG|  0.071668| 32.4803925|        85|  12825|         4503|              85|              151133|AIDS Support Orga...|     151133|         null|    null| [aids support org...|[www.tasouganda.org]|aids support orga...|  www.tasouganda.org| 1.3333333333333333|\n|       grid.451259.e|      null|grid.451259.e|      null|Q30338746|0000000404952455|00mv4xe50|      null|  Rio Tinto (Canada)|           rio tinto|    null|http://www.riotin...|                null| null|        Montreal|         Quebec|    null|         CA| 45.585316| -73.851565|      null|   null|         null|            null|86744641_grid.451...|         ALCAN, Inc.|      41760|grid.451259.e|86744641| [alcan, alcan alu...|[www.riotinto.com...|alcan||alcan alum...|www.riotinto.com|...|0.41025641025641024|\n|       grid.431955.f|      null|grid.431955.f|      null|Q30289802|            null|05qgpp431|      null|      Alcen (France)|               alcen|    null|http://www.alcen....|                null| null|           Paris|           null|    null|         FR| 48.872161|   2.307132|      null|   null|         null|            null|              556392|               ALCEN|     556392|         null|    null|              [alcen]|     [www.alcen.com]|               alcen|       www.alcen.com|                2.0|\n|       grid.468172.e|      null|grid.468172.e|      null|Q30264410|            null|00j1vsg87|      null|Australia & New Z...|anzbctg||australi...| ANZBCTG|https://www.anzbc...|                null| null|       Newcastle|New South Wales|    null|         AU|-32.928818| 151.789198|      null|   null|         null|            null|              544271|ANZ Breast Cancer...|     544271|         null|    null| [anz breast cance...|[mbr-bctg.newcast...|anz breast cancer...|mbr-bctg.newcastl...| 0.5333333333333333|\n|96845813_grid.470...|  96845813|grid.470123.3|      null| Q4146907|            null|05tp4xj78|      null|Vavilov State Opt...|institut doptique...|     SOI|http://www.npkgoi...|http://en.wikiped...| null|Saint Petersburg|           null|    null|         RU| 59.944036|  30.295466|      3032|  11074|        15933|            3019|              104723|AO Gosudarstvenny...|     104723|         null|    null| [ao gosudarstvenn...|[soi.spb.ru, soi....|ao gosudarstvenny...|soi.spb.ru||soi.s...| 0.4242424242424242|\n+--------------------+----------+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+----------------+---------------+--------+-----------+----------+-----------+----------+-------+-------------+----------------+--------------------+--------------------+-----------+-------------+--------+---------------------+--------------------+--------------------+--------------------+-------------------+\nonly showing top 20 rows\n\nimport org.apache.spark.sql.expressions.Window\nimport org.apache.spark.sql.functions._\n\u001b[1m\u001b[34mgrid_noRing\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string, magId: bigint ... 24 more fields]\n\u001b[1m\u001b[34mname_based_matchesall\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string, magId: bigint ... 32 more fields]\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=24"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=25"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=27"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=28"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=29"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616241862880_572146719",
   "id": "paragraph_1616241862880_572146719",
   "dateCreated": "2021-03-20T14:04:22+0200",
   "dateStarted": "2021-03-20T14:04:22+0200",
   "dateFinished": "2021-03-20T14:09:57+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\nval df2 = name_based_matchesall.select(countDistinct(\"ringgoldId1\"))\ndf2.show(false)\n\nval df22 = name_based_matchesall.select(countDistinct(\"ringgoldId\"))\ndf22.show(false)\n\nval df3 = name_based_matchesall.select(countDistinct(\"gridId\"))\ndf3.show(false)\n\nval df33 = name_based_matchesall.select(countDistinct(\"gridId1\"))\ndf33.show(false)\n\nval df4 = name_based_matchesall.select(countDistinct(\"magId\"))\ndf4.show(false)\n\nval df44 = name_based_matchesall.select(countDistinct(\"magId1\"))\ndf44.show(false)\n\nval double_Grids = name_based_matchesall.groupBy($\"gridId\")\n  .agg(count(\"gridId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Grids.count())\n\nval double_Mag = name_based_matchesall.groupBy($\"magId\")\n  .agg(count(\"magId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Mag.count())\n\n//double_Grids.show(false)\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T11:39:56+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console"
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "+---------------------------+\n|count(DISTINCT ringgoldId1)|\n+---------------------------+\n|3801                       |\n+---------------------------+\n\n+--------------------------+\n|count(DISTINCT ringgoldId)|\n+--------------------------+\n|0                         |\n+--------------------------+\n\n+----------------------+\n|count(DISTINCT gridId)|\n+----------------------+\n|3220                  |\n+----------------------+\n\n+-----------------------+\n|count(DISTINCT gridId1)|\n+-----------------------+\n|477                    |\n+-----------------------+\n\n+---------------------+\n|count(DISTINCT magId)|\n+---------------------+\n|1265                 |\n+---------------------+\n\n+----------------------+\n|count(DISTINCT magId1)|\n+----------------------+\n|228                   |\n+----------------------+\n\n137\n69\n\u001b[1m\u001b[34mdf2\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT ringgoldId1): bigint]\n\u001b[1m\u001b[34mdf22\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT ringgoldId): bigint]\n\u001b[1m\u001b[34mdf3\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT gridId): bigint]\n\u001b[1m\u001b[34mdf33\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT gridId1): bigint]\n\u001b[1m\u001b[34mdf4\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT magId): bigint]\n\u001b[1m\u001b[34mdf44\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT magId1): bigint]\n\u001b[1m\u001b[34mdouble_Grids\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [gridId: string, count: bigint]\n\u001b[1m\u001b[34mdouble_Mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache....\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=13"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=14"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=15"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=16"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=17"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=18"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=19"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=20"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616233196084_587612873",
   "id": "paragraph_1616233196084_587612873",
   "dateCreated": "2021-03-20T11:39:56+0200",
   "dateStarted": "2021-03-20T11:39:56+0200",
   "dateFinished": "2021-03-20T11:40:02+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\nname_based_matchesall\n       .filter($\"ringgoldId1\"=!=\"\" && !isnull($\"ringgoldId1\") && ($\"gridId\"===\"\" || isnull($\"gridId\")) ).show(true)",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T13:59:12+0200",
   "config": {},
   "settings": {
    "params": {},
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "+----------+----------+------+----------+-------+-------+------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+----+-----+--------+-----------+----------+-----------+----------+-------+-------------+----------------+--------------------+--------------------+-----------+-------------+----------+--------------------+--------------------+-------------------+\n|     affId|     magId|gridId|ringgoldId|wikiIds|isniIds|rorIds|fundrefIds|                name|     normalizedNames|acronyms|                urls|        wikipageurls|email|city|state|postCode|countryCode|  latitude|  longitude|papercount|magrank|citationcount|paperFamilyCount|              affId1|               name1|ringgoldId1|      gridId1|    magId1|  normalizedNamesAll|             urlsAll|           jaccname|\n+----------+----------+------+----------+-------+-------+------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+----+-----+--------+-----------+----------+-----------+----------+-------+-------------+----------------+--------------------+--------------------+-----------+-------------+----------+--------------------+--------------------+-------------------+\n| 136708864| 136708864|  null|      null|   null|   null|  null|      null|            ABN AMRO|            abn amro|    null|http://www.abnamr...|http://en.wikiped...| null|null| null|    null|         NL|  52.33701|    4.87488|       186|  13298|         4022|             168|                1185|            ABN AMRO|       1185|         null|      null|abn amro\\|\\|forti...|     www.abnamro.com|                1.5|\n|1332341397|1332341397|  null|      null|   null|   null|  null|      null|               AECOM|               aecom|    null|http://www.aecom....|http://en.wikiped...| null|null| null|    null|         US|37.7851868|  -122.4043|      1634|  11529|        15689|            1617|grid.420742.7_102388|AECOM Technology ...|     102388|grid.420742.7|      null|aecom\\|\\|aecom na...|www.aecom.com\\|\\|...|0.39999999999999997|\n|1290442905|1290442905|  null|      null|   null|   null|  null|      null|AIDS Action Commi...|aids action commi...|    null| http://www.aac.org/|http://en.wikiped...| null|null| null|    null|         US|  42.32028|   -71.0995|        13|  16817|           15|              13|               20151|AIDS Action Commi...|      20151|         null|      null|aids action commi...|         www.aac.org|                2.0|\n|1302733789|1302733789|  null|      null|   null|   null|  null|      null|AIDS Foundation o...|aids foundation o...|    null|http://www.aidsch...|http://en.wikiped...| null|null| null|    null|         US|  41.87841|   -87.6341|        38|  15252|          318|              38|              581923|AIDS Foundation o...|     581923|         null|      null|afc\\|\\|aids found...| www.aidschicago.org|                1.5|\n|1337766788|1337766788|  null|      null|   null|   null|  null|      null|  AOAC International|  aoac international|    null|http://www.aoac.org/|http://en.wikiped...| null|null| null|    null|         US| 39.102272|  -77.18183|        95|  14657|          357|              95|              309241|  AOAC International|     309241|         null|      null|aoac internationa...|        www.aoac.org| 1.3333333333333333|\n|  67626646|  67626646|  null|      null|   null|   null|  null|      null|               ARINC|               arinc|    null|http://www.arinc....|http://en.wikiped...| null|null| null|    null|         US|  41.91874|   -73.9813|       255|  12960|         2742|             253|              148961|               ARINC|     148961|         null|      null|aeronautical radi...|       www.arinc.com|                1.5|\n|1283814494|1283814494|  null|      null|   null|   null|  null|      null|    AT&T Corporation|    at t corporation|    null| http://www.att.com/|http://en.wikiped...| null|null| null|    null|         US|   40.7139|-74.0039139|      3271|   9321|        71160|            3249|1283103587_grid.4...|                AT&T|       1587|grid.431860.8|1283103587|american telegrap...|www.att.com\\|\\|in...|0.37681159420289856|\n| 909018346| 909018346|  null|      null|   null|   null|  null|      null|AXA Equitable Lif...|axa equitable lif...|    null|http://www.axa-eq...|http://en.wikiped...| null|null| null|    null|         US|   40.7139|  -74.00349|        40|  14638|          671|              39|              149275|AXA Equitable Lif...|     149275|         null|      null|axa equitable lif...|www.axa-equitable...|                1.5|\n|2948539688|2948539688|  null|      null|   null|   null|  null|      null|              AbbVie|              abbvie|    null|https://www.abbvi...|https://en.wikipe...| null|null| null|    null|         US|40.1139374|  -89.15877|      3068|  10678|        47209|            3043|grid.431072.3_359181|          AbbVie Inc|     359181|grid.431072.3|      null|abbvie\\|\\|abbvie inc|      www.abbvie.com|                1.5|\n|   9618033|   9618033|  null|      null|   null|   null|  null|      null|Abu Dhabi Company...|abu dhabi company...|    null| http://www.adco.ae/|http://en.wikiped...| null|null| null|    null|         AE|  24.46918|   54.37173|       122|  14127|          906|             120|               62736|Abu Dhabi Company...|      62736|         null|      null|abu dhabi company...|www.adco.ae\\|\\|ww...| 0.8333333333333333|\n| 883101408| 883101408|  null|      null|   null|   null|  null|      null|Geneva Academy of...|geneva academy of...|    null|http://www.geneva...|http://en.wikiped...| null|null| null|    null|         CH|  46.20833|    6.14275|       113|  14642|          186|             113|              172507|Academie de droit...|     172507|         null|      null|academie de droit...|www.adh-geneve.ch...| 0.8333333333333333|\n|  84886197|  84886197|  null|      null|   null|   null|  null|      null|             AdaCore|             adacore|    null|http://www.adacor...|http://en.wikiped...| null|null| null|    null|         US|  40.73117|  -73.99445|       229|  13735|          448|             227|              393318|             AdaCore|     393318|         null|      null|             adacore|     www.adacore.com|                2.0|\n| 182313166| 182313166|  null|      null|   null|   null|  null|      null|     Addax Petroleum|     addax petroleum|    null|http://www.addaxp...|http://en.wikiped...| null|null| null|    null|         CH|  46.19126|    6.16136|        68|  15136|           81|              68|              218791|     Addax Petroleum|     218791|         null|      null|     addax petroleum|www.addaxpetroleu...|                2.0|\n|1297905751|1297905751|  null|      null|   null|   null|  null|      null|Adhiparasakthi En...|adhiparasakthi en...|    null|http://adhiparasa...|http://en.wikiped...| null|null| null|    null|         IN|  12.43692|   79.82198|       367|  13152|         2839|             366|              211286|Adhiparasakthi En...|     211286|         null|      null|adhiparasakthi en...|adhiparasakthi.in...| 1.3333333333333333|\n|  60381969|  60381969|  null|      null|   null|   null|  null|      null|     Ross University|     ross university|    null|http://www.rossu....|http://pt.wikiped...| null|null| null|    null|         US|40.4665947|  -74.44112|       694|  12400|         6395|             693|               33324|Adtalem Global Ed...|      33324|         null|      null|adtalem global ed...|www.adtalem.com\\|...| 0.5833333333333333|\n| 809911590| 809911590|  null|      null|   null|   null|  null|      null|  Aerojet Rocketdyne|  aerojet rocketdyne|    null|http://www.rocket...|http://en.wikiped...| null|null| null|    null|         US| 38.630867|-121.200287|      2019|  10797|        19273|            1974|              115138|  Aerojet Rocketdyne|     115138|         null|      null|aerojet rocketdyn...|www.aerojet.com\\|...| 0.8333333333333333|\n| 137520241| 137520241|  null|      null|   null|   null|  null|      null|     Aethlon Medical|     aethlon medical|    null|http://www.aethlo...|http://www.sec.go...| null|null| null|    null|         US|   32.7178|  -117.1579|        21|  15557|          437|              21| grid.434831.9_17447| Aethlon Medical Inc|      17447|grid.434831.9|      null|aethlon medical\\|...|www.aethlonmedica...|                1.5|\n|1326851569|1326851569|  null|      null|   null|   null|  null|      null|        Varian, Inc.|          varian inc|    null|http://www.varian...|http://en.wikiped...| null|null| null|    null|         US|37.4187851|-122.145645|       382|  12558|         7251|             379|  grid.422638.9_6426|Agilent Technolog...|       6426|grid.422638.9|      null|agilent\\|\\|agilen...|www.agilent.comho...|0.25757575757575757|\n| 336847307| 336847307|  null|      null|   null|   null|  null|      null|Ahlcon Internatio...|ahlcon internatio...|    null|http://www.ahlcon...|http://en.wikiped...| null|null| null|    null|         IN|28.6432056|   77.11578|         4|  18035|            1|               4|              226406|Ahlcon Internatio...|     226406|         null|      null|ahlcon internatio...|www.ahlconinterna...|                2.0|\n| 128800392| 128800392|  null|      null|   null|   null|  null|      null|Akshaya College o...|akshaya college o...|    null|http://www.acetcb...|http://en.wikiped...| null|null| null|    null|         IN|     10.81|   77.01111|       132|  14302|          628|             132|              495663|Akshaya College o...|     495663|         null|      null|acet\\|\\|akshaya c...|  www.acetcbe.edu.in|                1.5|\n+----------+----------+------+----------+-------+-------+------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+----+-----+--------+-----------+----------+-----------+----------+-------+-------------+----------------+--------------------+--------------------+-----------+-------------+----------+--------------------+--------------------+-------------------+\nonly showing top 20 rows\n\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=21"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=22"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=23"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616241552633_1864053604",
   "id": "paragraph_1616241552633_1864053604",
   "dateCreated": "2021-03-20T13:59:12+0200",
   "dateStarted": "2021-03-20T13:59:12+0200",
   "dateFinished": "2021-03-20T13:59:12+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\n\n\n \n\n val ring_matchesAll =   name_based_matchesall\n       .filter($\"ringgoldId1\"=!=\"\" && !isnull($\"ringgoldId1\") && ($\"grid\"===\"\" || isnull($\"grid\")) ).cache()\n\n//name_matchesAll.show(false)\n\nval window = Window.partitionBy(\"gridId\").orderBy(\"jaccname\")\n\nval dist_rows = name_matchesAll.withColumn(\"row_num\", row_number().over(window))\n  .filter($\"row_num\" === 1)\n  .drop(\"row_num\").cache()\n\nprintln(dist_rows.count())\nval df2 = dist_rows.select(countDistinct(\"ringgoldId1\"))\ndf2.show(false)\nval df3 = dist_rows.select(countDistinct(\"gridId\"))\ndf3.show(false)\nval df4 = dist_rows.select(countDistinct(\"magId\"))\ndf4.show(false)\n\ndist_rows.show(true)\n\nval double_Grids = dist_rows.groupBy($\"gridId\")\n  .agg(count(\"gridId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Grids.count())\ndouble_Grids.show(false)\n\n        //.coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/name_based_matchesall.csv\")\n        \n /*\nval ids2drop = dist_rows.select(\"affId\").union(dist_rows.select(\"affId1\").distinct())\nprintln(ids2drop.count())\n\nprintln(institutionsdf.count())\nval newInsitutions = institutionsdf.join(ids2drop,ids2drop(\"affId\") === institutionsdf(\"affId\"), \"leftanti\"). \nselect($\"affId\", $\"magId\",$\"gridId\",$\"ringgoldId\",$\"wikiIds\",$\"isniIds\" ,$\"rorIds\",$\"fundrefIds\", $\"name\", $\"normalizedNames\",$\"acronyms\", $\"urls\", $\"countryCode\", $\"papercount\")\n                      \nprintln(newInsitutions.count())\n\ndist_rows.\nselect(concat($\"affId\", lit(\"_\"), $\"affId1\").as(\"affId\"), $\"magId\",$\"gridId\",$\"ringgoldId1\",$\"wikiIds\",$\"isniIds\" ,$\"rorIds\",$\"fundrefIds\", $\"name\", $\"normalizedNamesAll\",\n       $\"acronyms\", $\"urlsAll\", $\"countryCode\", $\"papercount\").show(true)\n\nval  newInsitutions_alldf =  newInsitutions.union(dist_rows.\nselect(concat($\"affId\", lit(\"_\"), $\"affId1\").as(\"affId\"), $\"magId\",$\"gridId\",$\"ringgoldId1\",$\"wikiIds\",$\"isniIds\" ,$\"rorIds\",$\"fundrefIds\", $\"name\", $\"normalizedNamesAll\",\n       $\"acronyms\", $\"urlsAll\", $\"countryCode\", $\"papercount\")).cache()\n       \n       println(newInsitutions_alldf.count())\n       newInsitutions_alldf.show(true)\n       \n       newInsitutions_alldf.coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/PKGInstitutions.csv\")\n       \n/*\nval newInsitutions = institutionsdf.join(name_based_matchesall.as(\"df2\"),institutionsdf(\"affId\")=== $\"df2.affId\",\"inner\")\n        .select(  ($\"df2.affId\"||\"ringgoldId1\").as(\"affId\"), $\"df2.magId\",$\"df2.gridId\",$\"df2.ringgoldId1\",$\"df2.wikiIds\",$\"df2.isniIds\" ,$\"df2.rorIds\",$\"df2.fundrefIds\", $\"df2.name\", $\"df2.normalizedNames\",\n                    $\"df2.acronyms\", $\"df2.urls\",$\"df2.wikipageurls\",$\"df2.email\", $\"df2.city\",$\"df2.state\",$\"df2.postCode\",$\"df2.countryCode\", \n                  $\"df2.latitude\",$\"df2.longitude\",$\"df2.papercount\",$\"df2.magrank\",$\"df2.citationcount\",$\"df2.paperFamilyCount\",\n                      $\"df1.name\".as(\"affId1\"), $\"df1.name\".as(\"name1\"), $\"df1.ringgoldId\".as(\"ringgoldId1\"), $\"df1.countryCode\".as(\"countryCode1\"),\n              array_join(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\"), \"\\\\|\\\\|\").as(\"normalizedNamesAll\"),\n                array_join(array_union($\"df1.urlsArr\",$\"df2.urlsArr\"), \"\\\\|\\\\|\").as(\"urlsAll\"), \n                ((size(array_intersect($\"df1.urlsArr\",$\"df2.urlsArr\")) / size(array_union($\"df1.urlsArr\",$\"df2.urlsArr\")))+\n                (size(array_intersect($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")) / size(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")))).as(\"jaccname\")\n         //, ($\"jaccurl\"+$\"jaccname\").as(\"jacc\")\n                \n                ).filter($\"df1.ringgoldId\"=!=\"\" && !isnull($\"df1.ringgoldId\") && $\"df2.countryCode\" === $\"df1.countryCode\").cache()\n                \ndist_rows.orderBy($\"paperCount\" desc)\n        .show(50)\n*/",
   "user": "anonymous",
   "dateUpdated": "2021-03-19T18:12:53+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console",
        "chart": {
         "series": [
          {
           "type": "Line",
           "x": {
            "column": "affId",
            "index": 0.0
           },
           "y": {
            "column": "ringgoldId1",
            "index": 3.0
           }
          }
         ]
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "6323\n603662\n597339\n+--------------------+----------+-------------+-----------+--------------------+----------------+--------------------+----------+--------------------+--------------------+--------+--------------------+-----------+----------+\n|               affId|     magId|       gridId|ringgoldId1|             wikiIds|         isniIds|              rorIds|fundrefIds|                name|  normalizedNamesAll|acronyms|             urlsAll|countryCode|papercount|\n+--------------------+----------+-------------+-----------+--------------------+----------------+--------------------+----------+--------------------+--------------------+--------+--------------------+-----------+----------+\n|grid.411491.8_194024|      null|grid.411491.8|     194024|           Q30253946|            null|           02s7c9e98|      null|Fourth Affiliated...|fourth affiliated...|    null|1809300272.pool3-...|         CN|      null|\n|grid.418020.f_223007|      null|grid.418020.f|     223007|           Q30281550|            null|           02f09jf04|      null|Fertility Medical...|embriofert clinic...|    null|fertility.com.br\\...|         BR|      null|\n|grid.434030.0_482922|      null|grid.434030.0|     482922|           Q30256374|            null|           00e4m3f78|      null|Hood Laboratories...|e benson hood lab...|    null|    www.hoodlabs.com|         US|      null|\n|grid.434575.4_gri...|      null|grid.434575.4|      70242|Q30256767||Q30292220|            null|02tarpq30||05raz7j17|      null|General Electric ...|ge global researc...|      GE|www.ge.comde\\|\\|w...|         DE|      null|\n|grid.441654.6_577829|      null|grid.441654.6|     577829|           Q30293956|            null|           04jyjz861|      null|Centro Universitá...|centro universita...|    null|   www.modulo.edu.br|         BR|      null|\n| grid.452768.a_72339|      null|grid.452768.a|      72339|           Q30296410|            null|           02gxnzq82|      null|Unified Szent Ist...|delpesti centrumk...|    null|www.eszszk.hu\\|\\|...|         HU|      null|\n| grid.470634.2_16800|      null|grid.470634.2|      16800|           Q30265652|            null|           02yp1e416|      null|Hospital General ...|general universit...|    null|castellon.san.gva...|         ES|      null|\n| grid.473695.a_28883|      null|grid.473695.a|      28883|           Q19604466|0000000459093539|           03hm0sm79|      null|National Council ...|national council ...|   NCAER|       www.ncaer.org|         IN|      null|\n|2802114251_grid.4...|2802114251|grid.474224.3|     468454|            Q7425634|            null|           033wpmv83|      null|Water Security Ag...|saskatchewan wate...|    null|        www.wsask.ca|         CA|        42|\n|grid.484150.c_577491|      null|grid.484150.c|     577491|           Q33121909|            null|           00j9jer02|      null|Foundation for Al...|foundation for al...|    null|         fare.org.au|         AU|      null|\n|grid.490280.7_547648|      null|grid.490280.7|     547648|           Q50036812|            null|           02f4m9w39|      null|Lake Huron Medica...|lake huron medica...|    LHMC| www.mylakehuron.com|         US|      null|\n|grid.492557.8_370452|      null|grid.492557.8|     370452|           Q50039359|            null|           00zma5460|      null|Instituto Naciona...|inhmt\\|\\|inspi\\|\\...|   INSPI|www.inh.gob.ec\\|\\...|         EC|      null|\n|grid.493065.d_485097|      null|grid.493065.d|     485097|           Q50039964|            null|           052414247|      null|Centre for Studie...|center for studie...|    CSEF|         www.csef.it|         IT|      null|\n|grid.496776.d_574466|      null|grid.496776.d|     574466|           Q39055111|            null|           00npz5r87|      null| Office for Students| office for students|     OfS|www.officeforstud...|         GB|      null|\n|grid.501180.d_577708|      null|grid.501180.d|     577708|           Q61931070|            null|           009rrgv92|      null| Egg Industry Center|egg industry cent...|     EIC|www.eggindustryce...|         US|      null|\n|grid.501900.d_585629|      null|grid.501900.d|     585629|           Q61931635|            null|           020p1sa64|      null|L.V. Prasad Film ...|l v prasad film t...|    LVPA|www.prasadacademy...|         IN|      null|\n|grid.417159.f_526793|      null|grid.417159.f|     526793|           Q30281186|            null|           0007tes83|      null|   Tominaga hospital|tominaga byoin\\|\\...|    null|  www.tominaga.or.jp|         JP|      null|\n|grid.419286.0_123467|      null|grid.419286.0|     123467|           Q30282082|            null|           0457d9w72|      null|National Cancer C...|georgian national...|    NACC|      www.onc.org.ge|         GE|      null|\n|grid.423605.6_576284|      null|grid.423605.6|     576284|           Q30284430|            null|           03sm30m06|      null|Raincoast Conserv...|raincoast conserv...|    null|   www.raincoast.org|         CA|      null|\n|2800297018_grid.4...|2800297018|grid.424027.7|       1655|            Q5105606|0000000110894923|           02w7rbf39|      null|Christian Michels...|chr michelsen ins...|     CMI|          www.cmi.no|         NO|        32|\n+--------------------+----------+-------------+-----------+--------------------+----------------+--------------------+----------+--------------------+--------------------+--------+--------------------+-----------+----------+\nonly showing top 20 rows\n\n600507\n+-------------+-----+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+----------+--------------------+-----------+----------+\n|        affId|magId|       gridId|ringgoldId|  wikiIds|         isniIds|   rorIds|fundrefIds|                name|     normalizedNames|  acronyms|                urls|countryCode|papercount|\n+-------------+-----+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+----------+--------------------+-----------+----------+\n|grid.282237.e| null|grid.282237.e|      null|Q30253499|            null|02ccwf677|      null|Proportional Tech...|proportional tech...|       PTI|http://www.propor...|         US|      null|\n|grid.292707.9| null|grid.292707.9|      null|Q30253589|            null|01wpkc438|      null|Canadian Foundati...|canadian foundati...|     CFISU|http://www.cfisu.ca/|         CA|      null|\n|grid.294071.9| null|grid.294071.9|      null| Q3152656|0000000091999374|031z68d90|      null|Institut Universi...|institut universi...|      IUGM|http://www.iugm.q...|         CA|      null|\n|grid.300821.8| null|grid.300821.8|      null|Q30253622|            null|057e34m22|      null|University of Mas...|umass donahue ins...|      null|http://www.donahu...|         US|      null|\n|grid.410314.3| null|grid.410314.3|      null|Q29122885|            null|01vnxev61|      null|      Bayer (Canada)|               bayer|      null|http://www.bayer.ca/|         CA|      null|\n|grid.410750.7| null|grid.410750.7|      null|Q30253764|            null|05jtcqr88|      null|Thermo Fisher Sci...|fei company||ther...|      null|https://www.therm...|         CN|      null|\n|grid.413164.5| null|grid.413164.5|      null|Q30254185|            null|05bhd7f62|      null|  458th Hospital PLA|458th hospital pl...|      null|http://www.458hos...|         CN|      null|\n|grid.414422.5| null|grid.414422.5|      null|Q30280028|            null|009nscf91|      null|Centre Hospitalie...|centre hospitalie...|      null|https://www.chuma...|         MA|      null|\n|grid.414838.2| null|grid.414838.2|      null|Q16576090|            null|03n85hy63|      null|Hospital Militar ...|hospital militar ...|      null|http://hmcarlosar...|         VE|      null|\n|grid.415331.1| null|grid.415331.1|      null|Q30280433|            null|00ajg8537|      null|Gaziantep Onkoloj...|gaziantep onkoloj...|      null|http://gul6.bim.g...|         TR|      null|\n|grid.416095.f| null|grid.416095.f|      null|Q30280765|            null|000vvpv33|      null|Social Insurance ...|social insurance ...|      null|http://yokohama.j...|         JP|      null|\n|grid.416746.6| null|grid.416746.6|      null|Q30280993|            null|03j7t7330|      null|St. Joseph's Chil...|st josephs childr...|      null|https://baycare.o...|         US|      null|\n|grid.417487.9| null|grid.417487.9|      null|Q30281340|            null|045mbap50|      null|Twin Star Medical...|   twin star medical|      null|http://www.twinst...|         US|      null|\n|grid.417576.6| null|grid.417576.6|      null|Q28974637|            null|01w8r0j67|      null|      Abbott (Spain)|              abbott|      null|http://www.abbott...|         ES|      null|\n|grid.419549.4| null|grid.419549.4|      null|Q28974622|000000012202540X|05p330p21|      null|Shell (United Kin...|royal dutch shell...|      null|http://www.shell....|         GB|      null|\n|grid.420164.5| null|grid.420164.5|      null|Q30282402|            null|016sds817|      null|Tyrolean Cancer R...|tcri||tiroler kre...|TCRI||TKFI| http://www.tcri.at/|         AT|      null|\n|grid.420585.e| null|grid.420585.e|      null|Q30282627|            null|040ktyf25|      null|JP Laboratories (...|     jp laboratories|      null|http://www.jplabs...|         US|      null|\n|grid.420588.3| null|grid.420588.3|      null| Q5127353|            null|028ca6f22|      null|   Clark Planetarium|   clark planetarium|      null|http://clarkplane...|         US|      null|\n|grid.420601.1| null|grid.420601.1|      null|Q30282641|            null|04ffs2p40|      null|Aspire Health Par...|aspire health par...|      null|https://aspirehea...|         US|      null|\n|grid.421475.1| null|grid.421475.1|      null|Q30283150|            null|02d7h9t50|      null|Consad (United St...|              consad|      null|https://www.consa...|         US|      null|\n+-------------+-----+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+----------+--------------------+-----------+----------+\nonly showing top 20 rows\n\n\u001b[1m\u001b[34mids2drop\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string]\n\u001b[1m\u001b[34mnewInsitutions\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [affId: string, magId: bigint ... 12 more fields]\n\u001b[1m\u001b[34mnewInsitutions_alldf\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string, magId: bigint ... 12 more fields]\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=617"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=618"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=620"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=621"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=622"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=623"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=624"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=625"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616170373191_1079240944",
   "id": "paragraph_1616170373191_1079240944",
   "dateCreated": "2021-03-19T18:12:53+0200",
   "dateStarted": "2021-03-19T18:12:53+0200",
   "dateFinished": "2021-03-19T18:12:57+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\nimport org.apache.spark.sql.expressions.Window\nimport org.apache.spark.sql.functions._\n\nval mag_nomatch = newInsitutions_alldf\n.filter(\n    ($\"gridId\"===\"\" || isnull($\"gridId\")) \n        && \n   $\"magId\"=!=0 && !isnull($\"magId\") \n        && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\")) \n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\nmag_nomatch.show(50)\nprintln(mag_nomatch.count())\n\nval name_based_matchesall = newInsitutions_alldf.as(\"df1\").join(mag_nomatch.as(\"df2\"),  \n    arrays_overlap($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\") && $\"df1.affId\" =!=$\"df2.affId\" \n            && arrays_overlap($\"df1.urlsArr\",$\"df2.urlsArr\")\n    , \"inner\")\n        .orderBy($\"df1.name\")\n        .cache()\n\nprintln(name_based_matchesall.count())\nname_based_matchesall.show(true)\n\n\n val name_matchesAll =   name_based_matchesall\n        .select(     $\"df2.affId\", $\"df2.magId\",$\"df2.gridId\",$\"df2.ringgoldId\",$\"df2.wikiIds\",$\"df2.isniIds\" ,$\"df2.rorIds\",$\"df2.fundrefIds\", $\"df2.name\", $\"df2.normalizedNames\",\n                    $\"df2.acronyms\", $\"df2.urls\",$\"df2.wikipageurls\",$\"df2.email\", $\"df2.city\",$\"df2.state\",$\"df2.postCode\",$\"df2.countryCode\", \n                  $\"df2.latitude\",$\"df2.longitude\",$\"df2.papercount\",$\"df2.magrank\",$\"df2.citationcount\",$\"df2.paperFamilyCount\",\n                      $\"df1.affId\".as(\"affId1\"), $\"df1.name\".as(\"name1\"), $\"df1.ringgoldId\".as(\"ringgoldId1\"), $\"df1.countryCode\".as(\"countryCode1\"),\n              array_join(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\"), \"\\\\|\\\\|\").as(\"normalizedNamesAll\"),\n                array_join(array_union($\"df1.urlsArr\",$\"df2.urlsArr\"), \"\\\\|\\\\|\").as(\"urlsAll\"), \n                ((size(array_intersect($\"df1.urlsArr\",$\"df2.urlsArr\")) / size(array_union($\"df1.urlsArr\",$\"df2.urlsArr\")))+\n                (size(array_intersect($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")) / size(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")))).as(\"jaccname\")\n         //, ($\"jaccurl\"+$\"jaccname\").as(\"jacc\")\n                \n                ).filter($\"df1.ringgoldId\"=!=\"\" && !isnull($\"df1.ringgoldId\") && $\"df2.countryCode\" === $\"df1.countryCode\").cache()\n\n//name_matchesAll.show(false)\n\nval window = Window.partitionBy(\"gridId\").orderBy(\"jaccname\")\n\nval dist_rows = name_matchesAll.withColumn(\"row_num\", row_number().over(window))\n  .filter($\"row_num\" === 1)\n  .drop(\"row_num\").cache()\n\nprintln(dist_rows.count())\nval df2 = dist_rows.select(countDistinct(\"ringgoldId1\"))\ndf2.show(false)\nval df3 = dist_rows.select(countDistinct(\"gridId\"))\ndf3.show(false)\nval df4 = dist_rows.select(countDistinct(\"magId\"))\ndf4.show(false)\n\ndist_rows.show(true)\n\nval double_Grids = dist_rows.groupBy($\"gridId\")\n  .agg(count(\"gridId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Grids.count())\ndouble_Grids.show(false)\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-19T19:08:23+0200",
   "config": {},
   "settings": {
    "params": {},
    "forms": {}
   },
   "results": {
    "code": "ERROR",
    "msg": [
     {
      "type": "TEXT",
      "data": "\u001b[33mwarning: \u001b[0mthere was one feature warning; for details, enable `:setting -feature' or `:replay -feature'\n+----------+----------+------+----------+-------+-------+------+----------+--------------------+--------------------+--------+--------------------+-----------+----------+\n|     affId|     magId|gridId|ringgoldId|wikiIds|isniIds|rorIds|fundrefIds|                name|     normalizedNames|acronyms|                urls|countryCode|papercount|\n+----------+----------+------+----------+-------+-------+------+----------+--------------------+--------------------+--------+--------------------+-----------+----------+\n| 204730241| 204730241|  null|      null|   null|   null|  null|      null| University of Paris| university of paris|    null|https://www.aup.edu/|         FR|    170325|\n|  72090969|  72090969|  null|      null|   null|   null|  null|      null|           Bell Labs|           bell labs|    null|http://www.bell-l...|         US|     57761|\n|   9217761|   9217761|  null|      null|   null|   null|  null|      null|Westinghouse Elec...|westinghouse elec...|    null|http://www.westin...|         US|     37557|\n|  78570951|  78570951|  null|      null|   null|   null|  null|      null|Monash University...|monash university...|    null|                null|         AU|     36571|\n| 115475287| 115475287|  null|      null|   null|   null|  null|      null|Oklahoma State Un...|oklahoma state un...|    null|http://go.okstate...|         US|     35813|\n|  56067802|  56067802|  null|      null|   null|   null|  null|      null|University of Rennes|university of rennes|    null|                null|         FR|     30128|\n|2738502077|2738502077|  null|      null|   null|   null|  null|      null|               Nokia|               nokia|    null|http://www.nokia....|         FI|     27926|\n|2279609970|2279609970|  null|      null|   null|   null|  null|      null| university of lille| university of lille|    null|                null|         FR|     27284|\n|2251713219|2251713219|  null|      null|   null|   null|  null|      null|Nippon Telegraph ...|nippon telegraph ...|    null|http://www.ntt.co...|         JP|     20700|\n|  67826202|  67826202|  null|      null|   null|   null|  null|      null|Helsinki Universi...|helsinki universi...|    null|  http://www.tkk.fi/|         FI|     19435|\n|1306430637|1306430637|  null|      null|   null|   null|  null|      null|St. Vincent's Hea...|st vincent s heal...|    null|http://www.stvhs....|         US|     19093|\n| 918370745| 918370745|  null|      null|   null|   null|  null|      null|College of Health...|college of health...|    null|http://www.uob.ed...|         BH|     18923|\n| 862296814| 862296814|  null|      null|   null|   null|  null|      null|Business Internat...|business internat...|    null|                null|         US|     18400|\n| 169238054| 169238054|  null|      null|   null|   null|  null|      null|Czechoslovak Acad...|czechoslovak acad...|    null|                null|         CZ|     17932|\n| 103775301| 103775301|  null|      null|   null|   null|  null|      null|          PetroChina|          petrochina|    null|http://www.petroc...|         CN|     17504|\n|1293067938|1293067938|  null|      null|   null|   null|  null|      null|International Ins...|international ins...|    null|http://www.iimn.org/|         US|     17092|\n| 865419266| 865419266|  null|      null|   null|   null|  null|      null|Catholic Universi...|catholic universi...|    null|                null|         BE|     16707|\n|2898336195|2898336195|  null|      null|   null|   null|  null|      null|Netherlands Cance...|netherlands cance...|    null|                null|         NL|     16602|\n| 193659739| 193659739|  null|      null|   null|   null|  null|      null|               Ciber|               ciber|    null|http://www.ciber....|         US|     16582|\n|2948482138|2948482138|  null|      null|   null|   null|  null|      null|Fujifilm Holdings...|            fujifilm|    null|https://www.fujif...|         JP|     14101|\n|  81082344|  81082344|  null|      null|   null|   null|  null|      null|     Science College|     science college|    null|                null|         GB|     14090|\n|   2388115|   2388115|  null|      null|   null|   null|  null|      null|Japan Atomic Ener...|japan atomic ener...|    null|                null|         JP|     13733|\n| 119233137| 119233137|  null|      null|   null|   null|  null|      null|Nicolaus Copernic...|nicolaus copernic...|    null|http://www.umk.pl/en|         PL|     13268|\n|2738703131|2738703131|  null|      null|   null|   null|  null|      null|French Alternativ...|french alternativ...|    null|http://www.cea.fr...|         FR|     12837|\n|  69234490|  69234490|  null|      null|   null|   null|  null|      null|Wellington Manage...|wellington manage...|    null|http://www.wellin...|         US|     12626|\n| 139179871| 139179871|  null|      null|   null|   null|  null|      null|       Union Carbide|       union carbide|    null|http://www.unionc...|         US|     12485|\n|  52119777|  52119777|  null|      null|   null|   null|  null|      null|   American Cyanamid|   american cyanamid|    null|                null|         US|     12461|\n|1315085146|1315085146|  null|      null|   null|   null|  null|      null|Universidade Fede...|universidade fede...|    null|                null|         BR|     12141|\n| 103315594| 103315594|  null|      null|   null|   null|  null|      null|Phillips Petroleu...|phillips petroleu...|    null|                null|         US|     11955|\n|1321572752|1321572752|  null|      null|   null|   null|  null|      null|Mount Sinai St. L...|mount sinai st lu...|    null|http://mountsinai...|         US|     11671|\n| 909457707| 909457707|  null|      null|   null|   null|  null|      null|The Hertz Corpora...|the hertz corpora...|    null|https://www.hertz...|         US|     11338|\n|1336942987|1336942987|  null|      null|   null|   null|  null|      null|National Presto I...|national presto i...|    null|http://www.gopres...|         US|     11073|\n| 818668190| 818668190|  null|      null|   null|   null|  null|      null|European Atomic E...|european atomic e...|    null|http://www.eurato...|         GB|     11009|\n| 181037475| 181037475|  null|      null|   null|   null|  null|      null|Law School Admiss...|law school admiss...|    null|http://www.lsac.org/|         US|     10907|\n| 202438577| 202438577|  null|      null|   null|   null|  null|      null|               Mobil|               mobil|    null|http://www.mobil....|         US|     10856|\n|  26005898|  26005898|  null|      null|   null|   null|  null|      null|UPRRP College of ...|uprrp college of ...|    null|http://natsci.upr...|         PR|     10692|\n|1328046515|1328046515|  null|      null|   null|   null|  null|      null|    Sun Microsystems|    sun microsystems|    null| http://www.sun.com/|         US|     10451|\n| 184895075| 184895075|  null|      null|   null|   null|  null|      null|                Metz|                metz|    null| http://www.metz.de/|         DE|     10285|\n|  98525489|  98525489|  null|      null|   null|   null|  null|      null|                SIDI|                sidi|    null|http://www.sidisp...|         IT|     10282|\n| 182512959| 182512959|  null|      null|   null|   null|  null|      null|            Magister|            magister|    null|                null|       null|     10004|\n| 866987647| 866987647|  null|      null|   null|   null|  null|      null|Medical Universit...|medical universit...|    null|     http://umed.pl/|         PL|      9604|\n|  62804640|  62804640|  null|      null|   null|   null|  null|      null|              ODESSA|              odessa|    null|                null|       null|      9328|\n|2949033070|2949033070|  null|      null|   null|   null|  null|      null|       Medtronic plc|           medtronic|    null|https://www.medtr...|         IE|      9183|\n|1330063522|1330063522|  null|      null|   null|   null|  null|      null|   Johnson & Johnson|     johnson johnson|    null| http://www.jnj.com/|         US|      9068|\n|  98985681|  98985681|  null|      null|   null|   null|  null|      null| University of Natal| university of natal|    null|                null|         ZA|      9026|\n| 152134324| 152134324|  null|      null|   null|   null|  null|      null|     Schering-Plough|     schering plough|    null|http://www.scheri...|         US|      8973|\n|2746051580|2746051580|  null|      null|   null|   null|  null|      null|PSL Research Univ...|psl research univ...|    null|http://www.psl.eu/en|         FR|      8929|\n|   3412056|   3412056|  null|      null|   null|   null|  null|      null|               Sanyo|               sanyo|    null|http://www.panaso...|         JP|      8860|\n| 868244695| 868244695|  null|      null|   null|   null|  null|      null|Central Universit...|central universit...|    null|                null|       null|      8829|\n|2252135952|2252135952|  null|      null|   null|   null|  null|      null|Petersburg Nuclea...|petersburg nuclea...|    null|                null|         US|      8582|\n+----------+----------+------+----------+-------+-------+------+----------+--------------------+--------------------+--------+--------------------+-----------+----------+\nonly showing top 50 rows\n\n4408\norg.apache.spark.sql.AnalysisException: cannot resolve '`df1.normalizedNamesArr`' given input columns: [df1.acronyms, df2.acronyms, df1.affId, df2.affId, df1.countryCode, df2.countryCode, df1.fundrefIds, df2.fundrefIds, df1.gridId, df2.gridId, df1.isniIds, df2.isniIds, df1.magId, df2.magId, df1.name, df2.name, df1.normalizedNames, df2.normalizedNames, df1.papercount, df2.papercount, df1.ringgoldId, df2.ringgoldId, df1.rorIds, df2.rorIds, df1.urls, df2.urls, df1.wikiIds, df2.wikiIds];;\n'Join Inner, ((arrays_overlap('df1.normalizedNamesArr, 'df2.normalizedNamesArr) AND NOT (affId#90522 = affId#178786)) AND arrays_overlap('df1.urlsArr, 'df2.urlsArr))\n:- SubqueryAlias df1\n:  +- Union\n:     :- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, countryCode#90539, papercount#90543L]\n:     :  +- Join LeftAnti, (affId#91541 = affId#90522)\n:     :     :- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, wikiPageUrls#90534, email#90535, city#90536, state#90537, postCode#90538, countryCode#90539, longitude#90540, latitude#90541, magRank#90542L, paperCount#90543L, paperFamilyCount#90544L, citationCount#90545L, ... 2 more fields]\n:     :     :  +- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, wikiPageUrls#90534, email#90535, city#90536, state#90537, postCode#90538, countryCode#90539, longitude#90540, latitude#90541, magRank#90542L, paperCount#90543L, paperFamilyCount#90544L, citationCount#90545L, split(normalizedNames#90531, \\|\\|, -1) AS normalizedNamesArr#90570]\n:     :     :     +- Relation[affId#90522,magId#90523L,gridId#90524,ringgoldId#90525,wikiIds#90526,isniIds#90527,rorIds#90528,fundrefIds#90529,name#90530,normalizedNames#90531,acronyms#90532,urls#90533,wikiPageUrls#90534,email#90535,city#90536,state#90537,postCode#90538,countryCode#90539,longitude#90540,latitude#90541,magRank#90542L,paperCount#90543L,paperFamilyCount#90544L,citationCount#90545L] csv\n:     :     +- Union\n:     :        :- Project [affId#91541]\n:     :        :  +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:     :        :     +- Filter (row_num#142055 = 1)\n:     :        :        +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 8 more fields]\n:     :        :           +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n:     :        :              +- Window [row_number() windowspecdefinition(gridId#91543, jaccname#141087 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS row_num#142055], [gridId#91543], [jaccname#141087 ASC NULLS FIRST]\n:     :        :                 +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:     :        :                    +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:     :        :                       +- Filter ((NOT (ringgoldId#90525 = ) AND NOT isnull(ringgoldId#90525)) AND (countryCode#91558 = countryCode#90539))\n:     :        :                          +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n:     :        :                             +- Sort [name#90530 ASC NULLS FIRST], true\n:     :        :                                +- Join Inner, ((arrays_overlap(normalizedNamesArr#90570, normalizedNamesArr#91540) AND NOT (affId#90522 = affId#91541)) AND arrays_overlap(urlsArr#90596, urlsArr#91539))\n:     :        :                                   :- SubqueryAlias df1\n:     :        :                                   :  +- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, wikiPageUrls#90534, email#90535, city#90536, state#90537, postCode#90538, countryCode#90539, longitude#90540, latitude#90541, magRank#90542L, paperCount#90543L, paperFamilyCount#90544L, citationCount#90545L, ... 2 more fields]\n:     :        :                                   :     +- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, wikiPageUrls#90534, email#90535, city#90536, state#90537, postCode#90538, countryCode#90539, longitude#90540, latitude#90541, magRank#90542L, paperCount#90543L, paperFamilyCount#90544L, citationCount#90545L, split(normalizedNames#90531, \\|\\|, -1) AS normalizedNamesArr#90570]\n:     :        :                                   :        +- Relation[affId#90522,magId#90523L,gridId#90524,ringgoldId#90525,wikiIds#90526,isniIds#90527,rorIds#90528,fundrefIds#90529,name#90530,normalizedNames#90531,acronyms#90532,urls#90533,wikiPageUrls#90534,email#90535,city#90536,state#90537,postCode#90538,countryCode#90539,longitude#90540,latitude#90541,magRank#90542L,paperCount#90543L,paperFamilyCount#90544L,citationCount#90545L] csv\n:     :        :                                   +- SubqueryAlias df2\n:     :        :                                      +- Sort [paperCount#91562L DESC NULLS LAST], true\n:     :        :                                         +- Filter ((NOT (gridId#91543 = ) AND NOT isnull(gridId#91543)) AND ((ringgoldId#91544 = ) OR isnull(ringgoldId#91544)))\n:     :        :                                            +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, ... 2 more fields]\n:     :        :                                               +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, split(normalizedNames#91550, \\|\\|, -1) AS normalizedNamesArr#91540]\n:     :        :                                                  +- Relation[affId#91541,magId#91542L,gridId#91543,ringgoldId#91544,wikiIds#91545,isniIds#91546,rorIds#91547,fundrefIds#91548,name#91549,normalizedNames#91550,acronyms#91551,urls#91552,wikiPageUrls#91553,email#91554,city#91555,state#91556,postCode#91557,countryCode#91558,longitude#91559,latitude#91560,magRank#91561L,paperCount#91562L,paperFamilyCount#91563L,citationCount#91564L] csv\n:     :        +- Deduplicate [affId1#141081]\n:     :           +- Project [affId1#141081]\n:     :              +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:     :                 +- Filter (row_num#142055 = 1)\n:     :                    +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 8 more fields]\n:     :                       +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n:     :                          +- Window [row_number() windowspecdefinition(gridId#91543, jaccname#141087 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS row_num#142055], [gridId#91543], [jaccname#141087 ASC NULLS FIRST]\n:     :                             +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:     :                                +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:     :                                   +- Filter ((NOT (ringgoldId#90525 = ) AND NOT isnull(ringgoldId#90525)) AND (countryCode#91558 = countryCode#90539))\n:     :                                      +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n:     :                                         +- Sort [name#90530 ASC NULLS FIRST], true\n:     :                                            +- Join Inner, ((arrays_overlap(normalizedNamesArr#90570, normalizedNamesArr#91540) AND NOT (affId#90522 = affId#91541)) AND arrays_overlap(urlsArr#90596, urlsArr#91539))\n:     :                                               :- SubqueryAlias df1\n:     :                                               :  +- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, wikiPageUrls#90534, email#90535, city#90536, state#90537, postCode#90538, countryCode#90539, longitude#90540, latitude#90541, magRank#90542L, paperCount#90543L, paperFamilyCount#90544L, citationCount#90545L, ... 2 more fields]\n:     :                                               :     +- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, wikiPageUrls#90534, email#90535, city#90536, state#90537, postCode#90538, countryCode#90539, longitude#90540, latitude#90541, magRank#90542L, paperCount#90543L, paperFamilyCount#90544L, citationCount#90545L, split(normalizedNames#90531, \\|\\|, -1) AS normalizedNamesArr#90570]\n:     :                                               :        +- Relation[affId#90522,magId#90523L,gridId#90524,ringgoldId#90525,wikiIds#90526,isniIds#90527,rorIds#90528,fundrefIds#90529,name#90530,normalizedNames#90531,acronyms#90532,urls#90533,wikiPageUrls#90534,email#90535,city#90536,state#90537,postCode#90538,countryCode#90539,longitude#90540,latitude#90541,magRank#90542L,paperCount#90543L,paperFamilyCount#90544L,citationCount#90545L] csv\n:     :                                               +- SubqueryAlias df2\n:     :                                                  +- Sort [paperCount#91562L DESC NULLS LAST], true\n:     :                                                     +- Filter ((NOT (gridId#91543 = ) AND NOT isnull(gridId#91543)) AND ((ringgoldId#91544 = ) OR isnull(ringgoldId#91544)))\n:     :                                                        +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, ... 2 more fields]\n:     :                                                           +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, split(normalizedNames#91550, \\|\\|, -1) AS normalizedNamesArr#91540]\n:     :                                                              +- Relation[affId#91541,magId#91542L,gridId#91543,ringgoldId#91544,wikiIds#91545,isniIds#91546,rorIds#91547,fundrefIds#91548,name#91549,normalizedNames#91550,acronyms#91551,urls#91552,wikiPageUrls#91553,email#91554,city#91555,state#91556,postCode#91557,countryCode#91558,longitude#91559,latitude#91560,magRank#91561L,paperCount#91562L,paperFamilyCount#91563L,citationCount#91564L] csv\n:     +- Project [concat(affId#91541, _, affId1#141081) AS affId#168785, magId#91542L, gridId#91543, ringgoldId1#141083, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNamesAll#141085, acronyms#91551, urlsAll#141086, countryCode#91558, papercount#91562L]\n:        +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:           +- Filter (row_num#142055 = 1)\n:              +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 8 more fields]\n:                 +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n:                    +- Window [row_number() windowspecdefinition(gridId#91543, jaccname#141087 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS row_num#142055], [gridId#91543], [jaccname#141087 ASC NULLS FIRST]\n:                       +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:                          +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n:                             +- Filter ((NOT (ringgoldId#90525 = ) AND NOT isnull(ringgoldId#90525)) AND (countryCode#91558 = countryCode#90539))\n:                                +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n:                                   +- Sort [name#90530 ASC NULLS FIRST], true\n:                                      +- Join Inner, ((arrays_overlap(normalizedNamesArr#90570, normalizedNamesArr#91540) AND NOT (affId#90522 = affId#91541)) AND arrays_overlap(urlsArr#90596, urlsArr#91539))\n:                                         :- SubqueryAlias df1\n:                                         :  +- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, wikiPageUrls#90534, email#90535, city#90536, state#90537, postCode#90538, countryCode#90539, longitude#90540, latitude#90541, magRank#90542L, paperCount#90543L, paperFamilyCount#90544L, citationCount#90545L, ... 2 more fields]\n:                                         :     +- Project [affId#90522, magId#90523L, gridId#90524, ringgoldId#90525, wikiIds#90526, isniIds#90527, rorIds#90528, fundrefIds#90529, name#90530, normalizedNames#90531, acronyms#90532, urls#90533, wikiPageUrls#90534, email#90535, city#90536, state#90537, postCode#90538, countryCode#90539, longitude#90540, latitude#90541, magRank#90542L, paperCount#90543L, paperFamilyCount#90544L, citationCount#90545L, split(normalizedNames#90531, \\|\\|, -1) AS normalizedNamesArr#90570]\n:                                         :        +- Relation[affId#90522,magId#90523L,gridId#90524,ringgoldId#90525,wikiIds#90526,isniIds#90527,rorIds#90528,fundrefIds#90529,name#90530,normalizedNames#90531,acronyms#90532,urls#90533,wikiPageUrls#90534,email#90535,city#90536,state#90537,postCode#90538,countryCode#90539,longitude#90540,latitude#90541,magRank#90542L,paperCount#90543L,paperFamilyCount#90544L,citationCount#90545L] csv\n:                                         +- SubqueryAlias df2\n:                                            +- Sort [paperCount#91562L DESC NULLS LAST], true\n:                                               +- Filter ((NOT (gridId#91543 = ) AND NOT isnull(gridId#91543)) AND ((ringgoldId#91544 = ) OR isnull(ringgoldId#91544)))\n:                                                  +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, ... 2 more fields]\n:                                                     +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, split(normalizedNames#91550, \\|\\|, -1) AS normalizedNamesArr#91540]\n:                                                        +- Relation[affId#91541,magId#91542L,gridId#91543,ringgoldId#91544,wikiIds#91545,isniIds#91546,rorIds#91547,fundrefIds#91548,name#91549,normalizedNames#91550,acronyms#91551,urls#91552,wikiPageUrls#91553,email#91554,city#91555,state#91556,postCode#91557,countryCode#91558,longitude#91559,latitude#91560,magRank#91561L,paperCount#91562L,paperFamilyCount#91563L,citationCount#91564L] csv\n+- SubqueryAlias df2\n   +- Sort [paperCount#178807L DESC NULLS LAST], true\n      +- Filter (((((gridId#178788 = ) OR isnull(gridId#178788)) AND NOT (magId#178787L = cast(0 as bigint))) AND NOT isnull(magId#178787L)) AND ((ringgoldId#178789 = ) OR isnull(ringgoldId#178789)))\n         +- Union\n            :- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, countryCode#178803, papercount#178807L]\n            :  +- Join LeftAnti, (affId#91541 = affId#178786)\n            :     :- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, wikiPageUrls#178798, email#178799, city#178800, state#178801, postCode#178802, countryCode#178803, longitude#178804, latitude#178805, magRank#178806L, paperCount#178807L, paperFamilyCount#178808L, citationCount#178809L, ... 2 more fields]\n            :     :  +- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, wikiPageUrls#178798, email#178799, city#178800, state#178801, postCode#178802, countryCode#178803, longitude#178804, latitude#178805, magRank#178806L, paperCount#178807L, paperFamilyCount#178808L, citationCount#178809L, split(normalizedNames#178795, \\|\\|, -1) AS normalizedNamesArr#90570]\n            :     :     +- Relation[affId#178786,magId#178787L,gridId#178788,ringgoldId#178789,wikiIds#178790,isniIds#178791,rorIds#178792,fundrefIds#178793,name#178794,normalizedNames#178795,acronyms#178796,urls#178797,wikiPageUrls#178798,email#178799,city#178800,state#178801,postCode#178802,countryCode#178803,longitude#178804,latitude#178805,magRank#178806L,paperCount#178807L,paperFamilyCount#178808L,citationCount#178809L] csv\n            :     +- Union\n            :        :- Project [affId#91541]\n            :        :  +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n            :        :     +- Filter (row_num#142055 = 1)\n            :        :        +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 8 more fields]\n            :        :           +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n            :        :              +- Window [row_number() windowspecdefinition(gridId#91543, jaccname#141087 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS row_num#142055], [gridId#91543], [jaccname#141087 ASC NULLS FIRST]\n            :        :                 +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n            :        :                    +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n            :        :                       +- Filter ((NOT (ringgoldId#178789 = ) AND NOT isnull(ringgoldId#178789)) AND (countryCode#91558 = countryCode#178803))\n            :        :                          +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n            :        :                             +- Sort [name#178794 ASC NULLS FIRST], true\n            :        :                                +- Join Inner, ((arrays_overlap(normalizedNamesArr#90570, normalizedNamesArr#91540) AND NOT (affId#178786 = affId#91541)) AND arrays_overlap(urlsArr#90596, urlsArr#91539))\n            :        :                                   :- SubqueryAlias df1\n            :        :                                   :  +- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, wikiPageUrls#178798, email#178799, city#178800, state#178801, postCode#178802, countryCode#178803, longitude#178804, latitude#178805, magRank#178806L, paperCount#178807L, paperFamilyCount#178808L, citationCount#178809L, ... 2 more fields]\n            :        :                                   :     +- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, wikiPageUrls#178798, email#178799, city#178800, state#178801, postCode#178802, countryCode#178803, longitude#178804, latitude#178805, magRank#178806L, paperCount#178807L, paperFamilyCount#178808L, citationCount#178809L, split(normalizedNames#178795, \\|\\|, -1) AS normalizedNamesArr#90570]\n            :        :                                   :        +- Relation[affId#178786,magId#178787L,gridId#178788,ringgoldId#178789,wikiIds#178790,isniIds#178791,rorIds#178792,fundrefIds#178793,name#178794,normalizedNames#178795,acronyms#178796,urls#178797,wikiPageUrls#178798,email#178799,city#178800,state#178801,postCode#178802,countryCode#178803,longitude#178804,latitude#178805,magRank#178806L,paperCount#178807L,paperFamilyCount#178808L,citationCount#178809L] csv\n            :        :                                   +- SubqueryAlias df2\n            :        :                                      +- Sort [paperCount#91562L DESC NULLS LAST], true\n            :        :                                         +- Filter ((NOT (gridId#91543 = ) AND NOT isnull(gridId#91543)) AND ((ringgoldId#91544 = ) OR isnull(ringgoldId#91544)))\n            :        :                                            +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, ... 2 more fields]\n            :        :                                               +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, split(normalizedNames#91550, \\|\\|, -1) AS normalizedNamesArr#91540]\n            :        :                                                  +- Relation[affId#91541,magId#91542L,gridId#91543,ringgoldId#91544,wikiIds#91545,isniIds#91546,rorIds#91547,fundrefIds#91548,name#91549,normalizedNames#91550,acronyms#91551,urls#91552,wikiPageUrls#91553,email#91554,city#91555,state#91556,postCode#91557,countryCode#91558,longitude#91559,latitude#91560,magRank#91561L,paperCount#91562L,paperFamilyCount#91563L,citationCount#91564L] csv\n            :        +- Deduplicate [affId1#141081]\n            :           +- Project [affId1#141081]\n            :              +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n            :                 +- Filter (row_num#142055 = 1)\n            :                    +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 8 more fields]\n            :                       +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n            :                          +- Window [row_number() windowspecdefinition(gridId#91543, jaccname#141087 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS row_num#142055], [gridId#91543], [jaccname#141087 ASC NULLS FIRST]\n            :                             +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n            :                                +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n            :                                   +- Filter ((NOT (ringgoldId#178789 = ) AND NOT isnull(ringgoldId#178789)) AND (countryCode#91558 = countryCode#178803))\n            :                                      +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n            :                                         +- Sort [name#178794 ASC NULLS FIRST], true\n            :                                            +- Join Inner, ((arrays_overlap(normalizedNamesArr#90570, normalizedNamesArr#91540) AND NOT (affId#178786 = affId#91541)) AND arrays_overlap(urlsArr#90596, urlsArr#91539))\n            :                                               :- SubqueryAlias df1\n            :                                               :  +- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, wikiPageUrls#178798, email#178799, city#178800, state#178801, postCode#178802, countryCode#178803, longitude#178804, latitude#178805, magRank#178806L, paperCount#178807L, paperFamilyCount#178808L, citationCount#178809L, ... 2 more fields]\n            :                                               :     +- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, wikiPageUrls#178798, email#178799, city#178800, state#178801, postCode#178802, countryCode#178803, longitude#178804, latitude#178805, magRank#178806L, paperCount#178807L, paperFamilyCount#178808L, citationCount#178809L, split(normalizedNames#178795, \\|\\|, -1) AS normalizedNamesArr#90570]\n            :                                               :        +- Relation[affId#178786,magId#178787L,gridId#178788,ringgoldId#178789,wikiIds#178790,isniIds#178791,rorIds#178792,fundrefIds#178793,name#178794,normalizedNames#178795,acronyms#178796,urls#178797,wikiPageUrls#178798,email#178799,city#178800,state#178801,postCode#178802,countryCode#178803,longitude#178804,latitude#178805,magRank#178806L,paperCount#178807L,paperFamilyCount#178808L,citationCount#178809L] csv\n            :                                               +- SubqueryAlias df2\n            :                                                  +- Sort [paperCount#91562L DESC NULLS LAST], true\n            :                                                     +- Filter ((NOT (gridId#91543 = ) AND NOT isnull(gridId#91543)) AND ((ringgoldId#91544 = ) OR isnull(ringgoldId#91544)))\n            :                                                        +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, ... 2 more fields]\n            :                                                           +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, split(normalizedNames#91550, \\|\\|, -1) AS normalizedNamesArr#91540]\n            :                                                              +- Relation[affId#91541,magId#91542L,gridId#91543,ringgoldId#91544,wikiIds#91545,isniIds#91546,rorIds#91547,fundrefIds#91548,name#91549,normalizedNames#91550,acronyms#91551,urls#91552,wikiPageUrls#91553,email#91554,city#91555,state#91556,postCode#91557,countryCode#91558,longitude#91559,latitude#91560,magRank#91561L,paperCount#91562L,paperFamilyCount#91563L,citationCount#91564L] csv\n            +- Project [concat(affId#91541, _, affId1#141081) AS affId#168785, magId#91542L, gridId#91543, ringgoldId1#141083, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNamesAll#141085, acronyms#91551, urlsAll#141086, countryCode#91558, papercount#91562L]\n               +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n                  +- Filter (row_num#142055 = 1)\n                     +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 8 more fields]\n                        +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n                           +- Window [row_number() windowspecdefinition(gridId#91543, jaccname#141087 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS row_num#142055], [gridId#91543], [jaccname#141087 ASC NULLS FIRST]\n                              +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n                                 +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 7 more fields]\n                                    +- Filter ((NOT (ringgoldId#178789 = ) AND NOT isnull(ringgoldId#178789)) AND (countryCode#91558 = countryCode#178803))\n                                       +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikipageurls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, latitude#91560, longitude#91559, papercount#91562L, magrank#91561L, citationcount#91564L, paperFamilyCount#91563L, ... 9 more fields]\n                                          +- Sort [name#178794 ASC NULLS FIRST], true\n                                             +- Join Inner, ((arrays_overlap(normalizedNamesArr#90570, normalizedNamesArr#91540) AND NOT (affId#178786 = affId#91541)) AND arrays_overlap(urlsArr#90596, urlsArr#91539))\n                                                :- SubqueryAlias df1\n                                                :  +- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, wikiPageUrls#178798, email#178799, city#178800, state#178801, postCode#178802, countryCode#178803, longitude#178804, latitude#178805, magRank#178806L, paperCount#178807L, paperFamilyCount#178808L, citationCount#178809L, ... 2 more fields]\n                                                :     +- Project [affId#178786, magId#178787L, gridId#178788, ringgoldId#178789, wikiIds#178790, isniIds#178791, rorIds#178792, fundrefIds#178793, name#178794, normalizedNames#178795, acronyms#178796, urls#178797, wikiPageUrls#178798, email#178799, city#178800, state#178801, postCode#178802, countryCode#178803, longitude#178804, latitude#178805, magRank#178806L, paperCount#178807L, paperFamilyCount#178808L, citationCount#178809L, split(normalizedNames#178795, \\|\\|, -1) AS normalizedNamesArr#90570]\n                                                :        +- Relation[affId#178786,magId#178787L,gridId#178788,ringgoldId#178789,wikiIds#178790,isniIds#178791,rorIds#178792,fundrefIds#178793,name#178794,normalizedNames#178795,acronyms#178796,urls#178797,wikiPageUrls#178798,email#178799,city#178800,state#178801,postCode#178802,countryCode#178803,longitude#178804,latitude#178805,magRank#178806L,paperCount#178807L,paperFamilyCount#178808L,citationCount#178809L] csv\n                                                +- SubqueryAlias df2\n                                                   +- Sort [paperCount#91562L DESC NULLS LAST], true\n                                                      +- Filter ((NOT (gridId#91543 = ) AND NOT isnull(gridId#91543)) AND ((ringgoldId#91544 = ) OR isnull(ringgoldId#91544)))\n                                                         +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, ... 2 more fields]\n                                                            +- Project [affId#91541, magId#91542L, gridId#91543, ringgoldId#91544, wikiIds#91545, isniIds#91546, rorIds#91547, fundrefIds#91548, name#91549, normalizedNames#91550, acronyms#91551, urls#91552, wikiPageUrls#91553, email#91554, city#91555, state#91556, postCode#91557, countryCode#91558, longitude#91559, latitude#91560, magRank#91561L, paperCount#91562L, paperFamilyCount#91563L, citationCount#91564L, split(normalizedNames#91550, \\|\\|, -1) AS normalizedNamesArr#91540]\n                                                               +- Relation[affId#91541,magId#91542L,gridId#91543,ringgoldId#91544,wikiIds#91545,isniIds#91546,rorIds#91547,fundrefIds#91548,name#91549,normalizedNames#91550,acronyms#91551,urls#91552,wikiPageUrls#91553,email#91554,city#91555,state#91556,postCode#91557,countryCode#91558,longitude#91559,latitude#91560,magRank#91561L,paperCount#91562L,paperFamilyCount#91563L,citationCount#91564L] csv\n\n  at org.apache.spark.sql.catalyst.analysis.package$AnalysisErrorAt.failAnalysis(package.scala:42)\n  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$$nestedInanonfun$checkAnalysis$1$2.applyOrElse(CheckAnalysis.scala:143)\n  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$$nestedInanonfun$checkAnalysis$1$2.applyOrElse(CheckAnalysis.scala:140)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformUp$2(TreeNode.scala:333)\n  at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:72)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:333)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformUp$1(TreeNode.scala:330)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$mapChildren$1(TreeNode.scala:399)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:237)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapChildren(TreeNode.scala:397)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapChildren(TreeNode.scala:350)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:330)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformUp$1(TreeNode.scala:330)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$mapChildren$1(TreeNode.scala:399)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:237)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapChildren(TreeNode.scala:397)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapChildren(TreeNode.scala:350)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:330)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformUp$1(TreeNode.scala:330)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$mapChildren$1(TreeNode.scala:399)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:237)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapChildren(TreeNode.scala:397)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapChildren(TreeNode.scala:350)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:330)\n  at org.apache.spark.sql.catalyst.plans.QueryPlan.$anonfun$transformExpressionsUp$1(QueryPlan.scala:106)\n  at org.apache.spark.sql.catalyst.plans.QueryPlan.$anonfun$mapExpressions$1(QueryPlan.scala:118)\n  at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:72)\n  at org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpression$1(QueryPlan.scala:118)\n  at org.apache.spark.sql.catalyst.plans.QueryPlan.recursiveTransform$1(QueryPlan.scala:129)\n  at org.apache.spark.sql.catalyst.plans.QueryPlan.recursiveTransform$1(QueryPlan.scala:130)\n  at org.apache.spark.sql.catalyst.plans.QueryPlan.$anonfun$mapExpressions$4(QueryPlan.scala:139)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:237)\n  at org.apache.spark.sql.catalyst.plans.QueryPlan.mapExpressions(QueryPlan.scala:139)\n  at org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpressionsUp(QueryPlan.scala:106)\n  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis$1(CheckAnalysis.scala:140)\n  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis$1$adapted(CheckAnalysis.scala:92)\n  at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:177)\n  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis(CheckAnalysis.scala:92)\n  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis$(CheckAnalysis.scala:89)\n  at org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:130)\n  at org.apache.spark.sql.catalyst.analysis.Analyzer.$anonfun$executeAndCheck$1(Analyzer.scala:156)\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$.markInAnalyzer(AnalysisHelper.scala:201)\n  at org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:153)\n  at org.apache.spark.sql.execution.QueryExecution.$anonfun$analyzed$1(QueryExecution.scala:68)\n  at org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:111)\n  at org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$1(QueryExecution.scala:133)\n  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:764)\n  at org.apache.spark.sql.execution.QueryExecution.executePhase(QueryExecution.scala:133)\n  at org.apache.spark.sql.execution.QueryExecution.analyzed$lzycompute(QueryExecution.scala:68)\n  at org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:66)\n  at org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:58)\n  at org.apache.spark.sql.Dataset$.$anonfun$ofRows$1(Dataset.scala:91)\n  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:764)\n  at org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:89)\n  at org.apache.spark.sql.Dataset.org$apache$spark$sql$Dataset$$withPlan(Dataset.scala:3646)\n  at org.apache.spark.sql.Dataset.join(Dataset.scala:1078)\n  ... 160 elided\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=664"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=665"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=666"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616173703973_559203620",
   "id": "paragraph_1616173703973_559203620",
   "dateCreated": "2021-03-19T19:08:23+0200",
   "dateStarted": "2021-03-19T19:08:23+0200",
   "dateFinished": "2021-03-19T19:08:25+0200",
   "status": "ERROR"
  },
  {
   "text": "%spark\nval normStr = udf[String, String]((e: String) => {\n    if (e != null) {\n        e.toLowerCase()\n                //.replaceAll(\"[ <>:´,’./\\\\'\\\\\\\";(){}!@#$%^&+‐–*\\\\\\\\-]+\", \"\")\n                .replaceAll(\"\\\"\", \"\")\n                .trim()\n    } else e;\n\n})\n\nspark.udf.register(\"normStr\", normStr)\n\nval normArrStr = udf[Seq[String], Seq[String]]((e: Seq[String]) => {\n    if (e != null) {\n    e.map(_.toLowerCase().replaceAll(\"\\\"\", \"\").trim());\n    /*\n     for ( i <- 0 to (e.length - 1)) {\n         e(i) = e(i);\n      }\n        for ( r <- 0 to (e.length - 1)) {\n            e(r) = e(r).toLowerCase()\n                    //.replaceAll(\"[ <>:´,’./\\\\'\\\\\\\";(){}!@#$%^&+‐–*\\\\\\\\-]+\", \"\")\n                    .replaceAll(\"\\\"\", \"\")\n                    .trim();\n        }\n*/\n    } else e;\n\n})\n\nspark.udf.register(\"normStr\", normStr)",
   "user": "anonymous",
   "dateUpdated": "2021-02-13T11:14:49+0200",
   "config": {},
   "settings": {
    "params": {},
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {},
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1613207689723_822054878",
   "id": "paragraph_1613207689723_822054878",
   "dateCreated": "2021-02-13T11:14:49+0200",
   "dateStarted": "2021-02-13T11:14:49+0200",
   "dateFinished": "2021-02-13T11:14:50+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\nimport org.apache.spark.sql.functions.countDistinct;\nimport org.apache.spark.storage.StorageLevel;\n\nval WIKI_HOME = \"/media/ometaxas/nvme/datasets/WikiData/dump\"\n\nval wikidatadf = spark.read.parquet(s\"file://$WIKI_HOME\")\n\nval countriesWIKIdf = wikidatadf\n        .withColumn(\"label_en\", normArrStr($\"labels\".getItem(\"en\")))\n        .withColumn(\"ISO3166_2codeValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P297')\"))\n        .withColumn(\"ISO3166_2Codes\", expr(\"TRANSFORM (ISO3166_2codeValue, x -> x.mainSnak.dataValue.value)\"))\n        .withColumn(\"ISO3166_2Code\", normStr(element_at(col(\"ISO3166_2Codes\"), 1)))\n        .withColumn(\"ISO3166_3codeValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P298')\"))\n        .withColumn(\"ISO3166_3Codes\", expr(\"TRANSFORM (ISO3166_3codeValue, x -> x.mainSnak.dataValue.value)\"))\n        .withColumn(\"ISO3166_3Code\", normStr(element_at(col(\"ISO3166_3Codes\"), 1)))\n\n        .withColumn(\"instanceofsVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P31')\"))\n        .withColumn(\"instanceofs\", expr(\"TRANSFORM (instanceofsVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"))\n        .withColumn(\"isCountry\", array_contains(col(\"instanceofs\"), \"Q6256\"))\n\n        .filter($\"isCountry\")\n        .select($\"id\", $\"label_en\", $\"ISO3166_2Code\", $\"ISO3166_3Code\")\n\n        .persist(StorageLevel.DISK_ONLY)\n\ncountriesWIKIdf.show(10)\ncountriesWIKIdf.printSchema\nprintln(\"Wikidata cnt:\" + countriesWIKIdf.count())\ncountriesWIKIdf.write.parquet(s\"$WIKI_HOME/countries_wikidata.parquet\")\n//countriesWIKIdf.write.json(s\"$WIKI_HOME/countries_wikidata.json\")\n",
   "user": "anonymous",
   "dateUpdated": "2021-02-01T18:47:14+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Table"
       }
      }
     }
    },
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=15"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=16"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=17"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=18"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=19"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=20"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=21"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1612198034352_154797580",
   "id": "paragraph_1612198034352_154797580",
   "dateCreated": "2021-02-01T18:47:14+0200",
   "dateStarted": "2021-02-01T18:47:14+0200",
   "dateFinished": "2021-02-01T19:03:57+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\n//Q1987282\n\nimport org.apache.spark.sql.types._\nimport org.apache.commons.lang.StringUtils\nimport java.lang.Integer.parseInt\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.apache.spark.sql.functions.concat_ws;\nimport org.apache.spark.sql.functions.countDistinct;\nimport org.apache.spark.storage.StorageLevel;\n\n/*\nhttps://www.wikidata.org/wiki/Q7099189\nhttps://www.wikidata.org/wiki/Q84938768\nhttps://www.wikidata.org/wiki/Q56649916\n\n */\nval WIKI_HOME = \"/media/ometaxas/nvme/datasets/WikiData/dump\"\n\nval COUNTRY_HOME = \"/media/ometaxas/nvme/datasets/WikiData/dump\"\n\nval wikidatadf = spark.read.parquet(s\"file://$WIKI_HOME\")\n\n\nval notFound = wikidatadf.filter($\"id\" === \"Q1987282\" || $\"id\" === \"Q7099189\" ||$\"id\" === \"Q84938768\" || $\"id\" === \"Q56649916\").cache()\n\n\nnotFound.write.json(s\"$WIKI_HOME/notFound.json\")\n",
   "user": "anonymous",
   "dateUpdated": "2021-02-13T10:31:39+0200",
   "config": {},
   "settings": {
    "params": {},
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=1"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=2"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1613205099072_284948852",
   "id": "paragraph_1613205099072_284948852",
   "dateCreated": "2021-02-13T10:31:39+0200",
   "dateStarted": "2021-02-13T10:31:39+0200",
   "dateFinished": "2021-02-13T10:48:10+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\nnotFound.coalesce(1).write.json(s\"$WIKI_HOME/notFoundAll.json\")",
   "user": "anonymous",
   "dateUpdated": "2021-02-13T11:23:05+0200",
   "config": {},
   "settings": {
    "params": {},
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=27"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1613208185888_2066259568",
   "id": "paragraph_1613208185888_2066259568",
   "dateCreated": "2021-02-13T11:23:05+0200",
   "dateStarted": "2021-02-13T11:23:05+0200",
   "dateFinished": "2021-02-13T11:23:06+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\n    \n//notFound.show(10)\n\n\nval COUNTRY_HOME = \"/media/ometaxas/nvme/datasets/WikiData/dump\"\n\n//val wikidatadf = spark.read.parquet(s\"file://$WIKI_HOME\")\n\nval countriesWIKIdf = spark.read.parquet(s\"$COUNTRY_HOME/countries_wikidata.parquet\")\n\n\nval aaa =  notFound.withColumn(\"labels_en\",normStr($\"labels\".getItem(\"en\")))\n        .withColumn(\"labels_fr\", normStr($\"labels\".getItem(\"fr\")))\n        .withColumn(\"labels_de\", normStr($\"labels\".getItem(\"de\")))\n        .withColumn(\"labels_es\", normStr($\"labels\".getItem(\"es\")))\n        \n        .withColumn(\"aliases_en\", normArrStr($\"aliases\".getItem(\"en\")))\n        //.withColumn(\"aliases_en\", normArrStr($\"aliases_en1\"))\n        \n        .withColumn(\"aliases_fr\", normArrStr($\"aliases\".getItem(\"fr\")))\n        //.withColumn(\"aliases_fr\", normArrStr($\"aliases_fr1\"))\n        \n        .withColumn(\"aliases_de\", normArrStr($\"aliases\".getItem(\"de\")))\n        //.withColumn(\"aliases_de\", normArrStr($\"aliases_de1\"))\n        \n        .withColumn(\"aliases_es\", normArrStr($\"aliases\".getItem(\"es\")))\n        //.withColumn(\"aliases_es\", normArrStr($\"aliases_es1\"))\n        \n        .withColumn(\"existence_mag\", expr(\"exists(claims, x -> x.mainSnak.property = 'P6366')\")) //has MAG_ID\n        .withColumn(\"existence_org\", expr(\"exists(claims, x ->  x.mainSnak.property = 'P2427'  OR x.mainSnak.property = 'P3500'   OR x.mainSnak.property = 'P6782'   OR x.mainSnak.property = 'P213' )\")) // has either GRID or Ringgold\n        .withColumn(\"is_research_article_flag\", expr(\"exists(claims, x -> x.mainSnak.property = 'P31' and x.mainSnak.dataValue.value = 'Q13442814')\")) //Is Scholarly Article \n\n        .withColumn(\"instanceofsVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P31')\"))\n        .withColumn(\"instanceofs\", expr(\"TRANSFORM (instanceofsVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"))\n        //.withColumn(\"instanceofids\",get_json_object($\"instanceofarr\", \"$.id\").alias(\"instanceof.id\")) // only the first id\n        //.withColumn(\"instanceof\",concat_ws(\",\",col(\"instanceofarr\")))\n        //.withColumn(\"instanceofid\",get_json_object($\"instanceof\", \"$.id\").alias(\"instanceof.id\")) // only the first id\n\n        .withColumn(\"countriesVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P17')\"))\n        .withColumn(\"countryId\", element_at(expr(\"TRANSFORM (countriesVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"), 1))\n\n        .withColumn(\"subsidiaryVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P355')\"))\n        .withColumn(\"subsidiaries\", expr(\"TRANSFORM (subsidiaryVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"))\n\n        .withColumn(\"parentVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P749')\"))\n        .withColumn(\"parents\", expr(\"TRANSFORM (subsidiaryVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"))\n\n        .withColumn(\"WebPageValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P856')\"))\n        .withColumn(\"WebPage\", normStr(element_at(expr(\"TRANSFORM (WebPageValue, x -> x.mainSnak.dataValue.value)\"), 1))) //Official WEB Site\n\n\n        .withColumn(\"MAG_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P6366')\"))\n        .withColumn(\"MAG_ID\", normStr(element_at(expr(\"TRANSFORM (MAG_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n        //.withColumn(\"MAGID\",concat_ws(\",\",col(\"MAGIDsarr\")))\n\n        .withColumn(\"RINGGOLD_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P3500')\"))\n        .withColumn(\"RINGGOLD_ID\", normStr(element_at(expr(\"TRANSFORM (RINGGOLD_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n        //.withColumn(\"RINGGOLDIds\",concat_ws(\",\",col(\"RINGGOLDIdsarr\")))\n\n        .withColumn(\"ROR_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P6782')\"))\n        .withColumn(\"ROR_ID\", normStr(element_at(expr(\"TRANSFORM (ROR_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n\n        .withColumn(\"ISNI_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P213')\"))\n        .withColumn(\"ISNI_ID\", normStr(element_at(expr(\"TRANSFORM (ISNI_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n\n        .withColumn(\"GRID_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P2427')\"))\n        .withColumn(\"GRID_ID\", normStr(element_at(expr(\"TRANSFORM (GRID_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n\n\n        .withColumn(\"CR_FUNDER_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P3153')\"))\n        .withColumn(\"CR_FUNDER_ID\", normStr(element_at(expr(\"TRANSFORM (CR_FUNDER_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n        //.withColumn(\"ISO3166_3Code\",  element_at(col(\"ISO3166_3Codes\"),1))\n\n\n        //.filter($\"existence_org\" === true && $\"typ\" === \"item\" && $\"is_research_article_flag\" === false)\n        //.join(broadcast(countriesWIKIdf), countriesWIKIdf(\"Id\") === $\"countryId\", \"outer\")\n        .select(wikidatadf(\"id\"), $\"existence_mag\", $\"existence_org\", $\"MAG_ID\", $\"CR_FUNDER_ID\", $\"GRID_ID\", $\"ISNI_ID\", $\"ROR_ID\", $\"RINGGOLD_ID\", $\"WebPage\", $\"parents\"\n            , $\"subsidiaries\", $\"countryId\", $\"labels_en\", $\"labels_es\", $\"labels_fr\", $\"labels_de\", $\"aliases_en\", $\"aliases_es\", $\"aliases_de\", $\"aliases_fr\")\n            //, $\"ISO3166_3Code\", $\"ISO3166_2Code\")\n        .show(10)\n",
   "user": "anonymous",
   "dateUpdated": "2021-02-13T11:17:25+0200",
   "config": {},
   "settings": {
    "params": {},
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=20"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=21"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=22"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=23"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=24"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=25"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=26"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1613207845918_1943403592",
   "id": "paragraph_1613207845918_1943403592",
   "dateCreated": "2021-02-13T11:17:25+0200",
   "dateStarted": "2021-02-13T11:17:25+0200",
   "dateFinished": "2021-02-13T11:17:28+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\n//Process WIKIDATA parquet files \n\nimport org.apache.spark.sql.types._\nimport org.apache.commons.lang.StringUtils\nimport java.lang.Integer.parseInt\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.apache.spark.sql.functions.concat_ws;\nimport org.apache.spark.sql.functions.countDistinct;\nimport org.apache.spark.storage.StorageLevel;\n\nval WIKI_HOME = \"/media/ometaxas/nvme/datasets/WikiData/dump\"\n\nval COUNTRY_HOME = \"/media/ometaxas/nvme/datasets/WikiData/dump\"\n\nval wikidatadf = spark.read.parquet(s\"file://$WIKI_HOME\")\n\nval countriesWIKIdf = spark.read.parquet(s\"$COUNTRY_HOME/countries_wikidata.parquet\")\n//  /part-00000-02658916-9459-424b-822a-4344eec93163-c000.snappy.parquet\n\n//\"claims\":[{\"id\":\"Q43469437$1DB22FAF-5063-4CD2-A681-5E1585E343C7\",\n// \"mainSnak\":{\"typ\":\"value\",\"property\":\"P356\",\"dataType\":\"external-id\",\"dataValue\":{\"typ\":\"string\",\"value\":\"\\\"10.1111/J.1464-5491.2009.02743.X\\\"\"}}/\n\n//wikidatadf.show(40)\n//wikidatadf.filter($\"aliases\"===\"P356\").show(20)\n\n\n//val wikipropdf = wikidatadf.filter($\"typ\"===\"property\")\n//.persist(StorageLevel.DISK_ONLY)\n\n\n//println(\"poperties cnt:\" + wikipropdf.count())\n\n/* Properties \nMAG_Id: P6366\nGRID_ID: P2427\nRinggold ID: P3500\nROR: P6782\nISNI: P213\nCrossRefFunder: P3153\n\nCountry: P17\nOfficial WEB Site: P856\n    language of work or name: P407\nparent Org: P749\nChildren(subsidiary): P355\n\nInstance_Of: P31\nscholarly article: Q13442814\nOfficialName: P1448\n\n\n*/\nval magWIKIdf = wikidatadf\n        //.withColumn(\"label_lng\", map_keys($\"labels\").getItem(0))\n        //.withColumn(\"label\", map_values($\"labels\").getItem(0))\n        //.withColumn(\"existence_flag\", expr(\"exists(claims, x -> x.id = 'Q27721769$8226B15F-37DE-4BEF-8F8F-80D442DFDDA9')\"))\n        //.withColumn(\"existence_flag\", expr(\"exists(claims, x -> x.mainSnak.property = 'P356' and x.mainSnak.dataValue.value = '\\\"10.1111/J.1464-5491.2009.02743.X\\\"')\"))\n\n        .withColumn(\"labels_en\",normStr($\"labels\".getItem(\"en\")))\n        .withColumn(\"labels_fr\", normStr($\"labels\".getItem(\"fr\")))\n        .withColumn(\"labels_de\", normStr($\"labels\".getItem(\"de\")))\n        .withColumn(\"labels_es\", normStr($\"labels\".getItem(\"es\")))\n        \n        .withColumn(\"aliases_en\", normArrStr($\"aliases\".getItem(\"en\")))\n        //.withColumn(\"aliases_en\", normArrStr($\"aliases_en1\"))\n        \n        .withColumn(\"aliases_fr\", normArrStr($\"aliases\".getItem(\"fr\")))\n        //.withColumn(\"aliases_fr\", normArrStr($\"aliases_fr1\"))\n        \n        .withColumn(\"aliases_de\", normArrStr($\"aliases\".getItem(\"de\")))\n        //.withColumn(\"aliases_de\", normArrStr($\"aliases_de1\"))\n        \n        .withColumn(\"aliases_es\", normArrStr($\"aliases\".getItem(\"es\")))\n        //.withColumn(\"aliases_es\", normArrStr($\"aliases_es1\"))\n        \n        .withColumn(\"existence_mag\", expr(\"exists(claims, x -> x.mainSnak.property = 'P6366')\")) //has MAG_ID\n        .withColumn(\"existence_org\", expr(\"exists(claims, x ->  x.mainSnak.property = 'P2427'  OR x.mainSnak.property = 'P3500'   OR x.mainSnak.property = 'P6782'   OR x.mainSnak.property = 'P213' )\")) // has either GRID or Ringgold\n        .withColumn(\"is_research_article_flag\", expr(\"exists(claims, x -> x.mainSnak.property = 'P31' and x.mainSnak.dataValue.value = 'Q13442814')\")) //Is Scholarly Article \n\n        .withColumn(\"instanceofsVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P31')\"))\n        .withColumn(\"instanceofs\", expr(\"TRANSFORM (instanceofsVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"))\n        //.withColumn(\"instanceofids\",get_json_object($\"instanceofarr\", \"$.id\").alias(\"instanceof.id\")) // only the first id\n        //.withColumn(\"instanceof\",concat_ws(\",\",col(\"instanceofarr\")))\n        //.withColumn(\"instanceofid\",get_json_object($\"instanceof\", \"$.id\").alias(\"instanceof.id\")) // only the first id\n\n        .withColumn(\"countriesVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P17')\"))\n        .withColumn(\"countryId\", element_at(expr(\"TRANSFORM (countriesVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"), 1))\n\n        .withColumn(\"subsidiaryVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P355')\"))\n        .withColumn(\"subsidiaries\", expr(\"TRANSFORM (subsidiaryVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"))\n\n        .withColumn(\"parentVal\", expr(\"filter(claims, x -> x.mainSnak.property = 'P749')\"))\n        .withColumn(\"parents\", expr(\"TRANSFORM (subsidiaryVal, x -> get_json_object(x.mainSnak.dataValue.value,\\\"$.id\\\"))\"))\n\n        .withColumn(\"WebPageValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P856')\"))\n        .withColumn(\"WebPage\", normStr(element_at(expr(\"TRANSFORM (WebPageValue, x -> x.mainSnak.dataValue.value)\"), 1))) //Official WEB Site\n\n\n        .withColumn(\"MAG_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P6366')\"))\n        .withColumn(\"MAG_ID\", normStr(element_at(expr(\"TRANSFORM (MAG_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n        //.withColumn(\"MAGID\",concat_ws(\",\",col(\"MAGIDsarr\")))\n\n        .withColumn(\"RINGGOLD_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P3500')\"))\n        .withColumn(\"RINGGOLD_ID\", normStr(element_at(expr(\"TRANSFORM (RINGGOLD_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n        //.withColumn(\"RINGGOLDIds\",concat_ws(\",\",col(\"RINGGOLDIdsarr\")))\n\n        .withColumn(\"ROR_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P6782')\"))\n        .withColumn(\"ROR_ID\", normStr(element_at(expr(\"TRANSFORM (ROR_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n\n        .withColumn(\"ISNI_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P213')\"))\n        .withColumn(\"ISNI_ID\", normStr(element_at(expr(\"TRANSFORM (ISNI_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n\n        .withColumn(\"GRID_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P2427')\"))\n        .withColumn(\"GRID_ID\", normStr(element_at(expr(\"TRANSFORM (GRID_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n\n\n        .withColumn(\"CR_FUNDER_IDsValue\", expr(\"filter(claims, x -> x.mainSnak.property = 'P3153')\"))\n        .withColumn(\"CR_FUNDER_ID\", normStr(element_at(expr(\"TRANSFORM (CR_FUNDER_IDsValue, x -> x.mainSnak.dataValue.value)\"), 1)))\n        //.withColumn(\"ISO3166_3Code\",  element_at(col(\"ISO3166_3Codes\"),1))\n\n\n        .filter($\"existence_org\" === true && $\"typ\" === \"item\" && $\"is_research_article_flag\" === false)\n        .join(broadcast(countriesWIKIdf), countriesWIKIdf(\"Id\") === $\"countryId\", \"outer\")\n        .select(wikidatadf(\"id\"), $\"existence_mag\", $\"existence_org\", $\"MAG_ID\", $\"CR_FUNDER_ID\", $\"GRID_ID\", $\"ISNI_ID\", $\"ROR_ID\", $\"RINGGOLD_ID\", $\"WebPage\", $\"parents\"\n            , $\"subsidiaries\", $\"countryId\", $\"labels_en\", $\"labels_es\", $\"labels_fr\", $\"labels_de\", $\"aliases_en\", $\"aliases_es\", $\"aliases_de\", $\"aliases_fr\", $\"ISO3166_3Code\"\n            , $\"ISO3166_2Code\")\n        .persist(StorageLevel.DISK_ONLY)\n\nmagWIKIdf.show(10)\nmagWIKIdf.printSchema\nprintln(\"Wikidata cnt:\" + magWIKIdf.count())\n// Wikidata cnt:303856\n/*\nval doisdf = magWIKIdf.select(\"instanceofid\").distinct()\ndoisdf.show(false)\n//8321\n\nval df2 = magWIKIdf.select(countDistinct(\"instanceofid\"))\ndf2.show(false)\n*/\nmagWIKIdf.write.parquet(s\"$WIKI_HOME/wiki_orgs.parquet\")\n//magWIKIdf.write.json(s\"$WIKI_HOME/org_wikidata.json\")\n//&& $\"type\"===\"item\"\n//.pers\n\n//.withColumn(\"existence_flag\", expr(\"exists(claims, x -> x.mainSnak.property = 'P356')\"))\n//.withColumn(\"table_row\", expr(\"TRANSFORM (table_row, x -> named_struct('DATE', x.DATE))\")\n//.selectExpr(\"exists(claims, x -> x.id = 'Q27721769$8226B15F-37DE-4BEF-8F8F-80D442DFDDA9') AS existence_flag\")\n//.select($\"id\", $\"typ\", $\"labels\", $\"labels\".getItem(\"en\"),$\"label\", $\"label_lng\", $\"aliases\".getItem(\"en\")\n//, $\"existence_flag\"\n//)\n\n\n//df.withColumn(\"table_row\", expr(\"TRANSFORM (table_row, x -> named_struct('DATE', x.DATE))\")\n//v\n//val filteredDataframe = dataframe.select(expr(\"filter(your_array, your_struct -> your_struct.propertyToFilterOn == 1)\").as(\"filtered_arrays\"))\n\n// filteredDataframe.select(expr(\"transform(filtered_arrays, your_struct -> struct(concat(your_struct.someProperty, '_', your_struct.someOtherProperty))\"))\n\n\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-02-02T14:23:39+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console"
       }
      }
     }
    },
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=85"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=86"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=87"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=88"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=89"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=90"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1612268619865_827122014",
   "id": "paragraph_1612268619865_827122014",
   "dateCreated": "2021-02-02T14:23:39+0200",
   "dateStarted": "2021-02-02T14:23:39+0200",
   "dateFinished": "2021-02-02T14:40:27+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\nval orgWIKIdf = spark.read.parquet(s\"$WIKI_HOME/org_wikidata.parquet\")\n.select($\"id\", $\"existence_mag\", $\"existence_org\", $\"CR_FUNDER_ID\", $\"GRID_ID\", $\"ISNI_ID\", $\"ROR_ID\", $\"RINGGOLD_ID\", $\"WebPage\", $\"parents\"\n            , $\"subsidiaries\", $\"countryId\", $\"labels_en\", $\"labels_es\", $\"labels_fr\", $\"labels_de\", \n            normArrStr($\"aliases_en\").as(\"aliases_en\"), normArrStr($\"aliases_es\").as(\"aliases_es\"), normArrStr($\"aliases_de\").as(\"aliases_de\"), normArrStr($\"aliases_fr\").as(\"aliases_fr\")\n           , $\"ISO3166_3Code\"    , $\"ISO3166_2Code\")      \n        .write.parquet(s\"$WIKI_HOME/wiki_orgs.parquet\")\n\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-02-02T11:43:40+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console",
        "table": {
         "visibleRow": 5.0
        }
       }
      }
     }
    },
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=83"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=84"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1612259020259_351838420",
   "id": "paragraph_1612259020259_351838420",
   "dateCreated": "2021-02-02T11:43:40+0200",
   "dateStarted": "2021-02-02T11:43:40+0200",
   "dateFinished": "2021-02-02T11:43:42+0200",
   "status": "FINISHED"
  },
  {
   "settings": {
    "params": {},
    "forms": {}
   },
   "apps": [],
   "status": "READY",
   "text": "%spark\nval WIKI_HOME = \"/media/ometaxas/nvme/datasets/WikiData/dump\"\n\nval wikidatadf = spark.read.parquet(s\"file://$WIKI_HOME/dump\")\n\nval stanfordRec = wikidatadf.filter($\"id\" === \"Q41506\").cache()\n\nstanfordRec.printSchema()\n\nstanfordRec.write.json(s\"$WIKI_HOME/stanford.json\")",
   "id": "",
   "config": {}
  },
  {
   "text": "%spark\nval WIKI_HOME = \"/media/ometaxas/nvme/datasets/WikiData/dump\"\n\nval wikidatadf = spark.read.parquet(s\"$WIKI_HOME/fos_org_wikidata.parquet\")\n\nval stanfordRec = wikidatadf.filter($\"id\" === \"Q41506\").cache()\n\nstanfordRec.printSchema()\n\nstanfordRec.write.json(s\"$WIKI_HOME/stanford.json\")\n",
   "user": "anonymous",
   "dateUpdated": "2021-01-29T14:15:27+0200",
   "config": {},
   "settings": {
    "params": {},
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=68"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=69"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1611922527020_2111019732",
   "id": "paragraph_1611922527020_2111019732",
   "dateCreated": "2021-01-29T14:15:27+0200",
   "dateStarted": "2021-01-29T14:15:27+0200",
   "dateFinished": "2021-01-29T14:15:35+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\nval WIKI_HOME = \"/media/ometaxas/nvme/datasets/WikiData\"\n\nval wikidata_org_fos_df = spark.read.parquet(s\"$WIKI_HOME/fos_org_wikidata.parquet\")\n\nval orgs = wikidata_org_fos_df.filter($\"existence_org\" === true).cache()\nprintln(\"orgs cnt:\" + orgs.count())\n\norgs.show(false)\n\n//val stanforddf = wikidata_org_fos_df.filter($\"id\" === \"Q41506\").select($\"instanceofarr\", $\"instanceof\", $\"instanceofid\").cache()\n\n//stanforddf.show(1, false)\n",
   "user": "anonymous",
   "dateUpdated": "2021-01-28T12:14:47+0200",
   "config": {},
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console"
       }
      }
     }
    },
    "forms": {}
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=36"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=37"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=38"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1611828887149_1026356218",
   "id": "paragraph_1611828887149_1026356218",
   "dateCreated": "2021-01-28T12:14:47+0200",
   "dateStarted": "2021-01-28T12:14:47+0200",
   "dateFinished": "2021-01-28T12:15:01+0200",
   "status": "FINISHED"
  }
 ],
 "name": "Zeppelin Notebook",
 "id": "",
 "noteParams": {},
 "noteForms": {},
 "angularObjects": {},
 "config": {
  "isZeppelinNotebookCronEnable": false,
  "looknfeel": "default",
  "personalizedMode": "false"
 },
 "info": {}
}