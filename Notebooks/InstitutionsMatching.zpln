{
 "paragraphs": [
  {
   "text": "%spark.conf\n# It is strongly recommended to set SPARK_HOME explictly instead of using the embedded spark of Zeppelin. As the function of embedded spark of Zeppelin is limited and can only run in local mode.\nSPARK_HOME /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2\n#com.github.haifengl:smile-scala_2.12:2.5.3,com.databricks:spark-xml_2.12:0.10.0,com.github.mrpowers:spark-stringmetric_2.12:0.3.0\n#spark.jars /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2/plugins/rapids-4-spark_2.12-0.3.0.jar, /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2/plugins/cudf-0.17-cuda10-1.jar\n\n#spark.sql.warehouse.dir /home/ometaxas/Programs/zeppelin-0.9.0-preview2-bin-all/spark-warehouse\n\nspark.serializer org.apache.spark.serializer.KryoSerializer\nspark.kryoserializer.buffer.max 1000M\nspark.driver.memory 95g\nspark.driver.maxResultSize 5g \n\n#spark.rapids.sql.concurrentGpuTasks=2\n#spark.rapids.sql.enabled true\n#spark.rapids.memory.pinnedPool.size 2G \n\n#spark.plugins com.nvidia.spark.SQLPlugin \n\n#spark.locality.wait 0s \n#spark.sql.files.maxPartitionBytes 512m \n#spark.sql.shuffle.partitions 100 \n#spark.executor.resource.gpu.amount=1\n\n\nSPARK_LOCAL_DIRS /media/ometaxas/nvme/spark\n#, /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2/tmp\n                                             \n# /home/ometaxas/Programs/spark-3.0.1-bin-hadoop3.2/tmp,/media/datadisk/Datasets/Spark\n#,/media/datadisk/Datasets/Spark \n#/media/datadisk/Datasets/Spark\n\n# set executor memrory 110g\n# spark.executor.memory  60g\n\n\n# set executor number to be 6\n# spark.executor.instances  6\n\n\n# Uncomment the following line if you want to use yarn-cluster mode (It is recommended to use yarn-cluster mode after Zeppelin 0.8, as the driver will run on the remote host of yarn cluster which can mitigate memory pressure of zeppelin server)\n# master yarn-cluster\n\n# Uncomment the following line if you want to use yarn-client mode (It is not recommended to use it after 0.8. Because it would launch the driver in the same host of zeppelin server which will increase memory pressure of zeppelin server)\n# master yarn-client\n\n# Uncomment the following line to enable HiveContext, and also put hive-site.xml under SPARK_CONF_DIR\n# zeppelin.spark.useHiveContext true\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T16:23:27+0200",
   "config": {
    "editorSetting": {
     "language": "scala",
     "editOnDblClick": false,
     "completionKey": "TAB",
     "completionSupport": true
    },
    "colWidth": 12.0,
    "editorMode": "ace/mode/scala",
    "fontSize": 9.0,
    "results": {},
    "enabled": true
   },
   "settings": {
    "params": {},
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": []
   },
   "apps": [],
   "runtimeInfos": {},
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616250207617_1894678080",
   "id": "paragraph_1616250207617_1894678080",
   "dateCreated": "2021-03-20T16:23:27+0200",
   "dateStarted": "2021-03-20T16:23:27+0200",
   "dateFinished": "2021-03-20T16:23:27+0200",
   "status": "FINISHED"
  },
  {
   "title": "Read Initial file",
   "text": "%spark\nimport org.apache.spark.sql.types._\nimport org.apache.spark.sql.functions.countDistinct;\n\nval ORGS_HOME = \"/media/ometaxas/nvme/datasets/institutions\"\n\n/*\naffId: string (nullable = true)\n |-- magId: long (nullable = true)\n |-- gridId: string (nullable = true)\n |-- ringgoldId: string (nullable = true)\n |-- wikiIds: string (nullable = true)\n |-- isniIds: string (nullable = true)\n |-- rorIds: string (nullable = true)\n |-- fundrefIds: string (nullable = true)\n |-- name: string (nullable = true)\n |-- normalizedNames: string (nullable = true)\n |-- acronyms: string (nullable = true)\n |-- urls: string (nullable = true)\n |-- wikiPageUrls: string (nullable = true)\n |-- email: string (nullable = true)\n |-- city: string (nullable = true)\n |-- state: string (nullable = true)\n |-- postCode: string (nullable = true)\n |-- countryCode: string (nullable = true)\n |-- longitude: double (nullable = true)\n |-- latitude: double (nullable = true)\n |-- magRank: long (nullable = true)\n |-- paperCount: integer (nullable = true)\n |-- paperFamilyCount: integer (nullable = true)\n |-- citationCount: integer (nullable = true)\n */\nval institutionsTsvFilename = \"AffiliationsExtended.tsv\" \n                              \nval institutionsSchema = new StructType().\n                add(\"affId\", StringType, true).\n                add(\"magId\", LongType, false).\n                add(\"gridId\", StringType, true).                \n                add(\"ringgoldId\", StringType, true).\n                add(\"wikiIds\",StringType, true).\n                add(\"isniIds\",StringType, true).\n                add(\"rorIds\",StringType, true).\n                add(\"fundrefIds\", StringType, true).\n                add(\"name\", StringType, true).\n                add(\"normalizedNames\", StringType, true).\n                add(\"acronyms\", StringType, true).\n                add(\"urls\", StringType, true).\n                add(\"wikiPageUrls\", StringType, true).\n                add(\"email\", StringType, true).\n                add(\"city\", StringType, true).\n                add(\"state\", StringType, true).\n                add(\"postCode\", StringType, true).\n                add(\"countryCode\", StringType, true).\n                add(\"longitude\", DoubleType, true).\n                add(\"latitude\", DoubleType, true).\n                add(\"magRank\", LongType, false).\n                add(\"paperCount\", LongType, false).\n                add(\"paperFamilyCount\", LongType, false).\n                add(\"citationCount\", LongType, false)\n\n                \nval institutionsdf = spark.read.options(Map(\"sep\"->\"\\t\", \"header\"-> \"false\")).\n                schema(institutionsSchema).\n                csv(s\"file://$ORGS_HOME/$institutionsTsvFilename\")\n    .withColumn(\"normalizedNamesArr\", split(col(\"normalizedNames\"),\"\\\\|\\\\|\"))\n    .withColumn(\"urlsArr\", split(regexp_replace(col(\"urls\"),\"(https?\\\\://)|/\",\"\"),\"\\\\|\\\\|\"))\n    .withColumn(\"wikiPageUrlsArr\", split(col(\"wikiPageUrls\"),\"\\\\|\\\\|\"))\n        .withColumn(\"acronymsArr\", split(col(\"acronyms\"),\"\\\\|\\\\|\"))\n.withColumn(\"fundrefIdsArr\", split(col(\"fundrefIds\"),\"\\\\|\\\\|\"))\n.withColumn(\"rorIdsArr\", split(col(\"rorIds\"),\"\\\\|\\\\|\"))\n.withColumn(\"wikiIdsArr\", split(col(\"wikiIds\"),\"\\\\|\\\\|\"))        \n.withColumn(\"wikiPageUrlsArr\", split(col(\"wikiPageUrls\"),\"\\\\|\\\\|\"))\n        .cache()\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T17:34:32+0200",
   "config": {
    "title": true
   },
   "settings": {
    "params": {},
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "import org.apache.spark.sql.types._\nimport org.apache.spark.sql.functions.countDistinct\n\u001b[1m\u001b[34mORGS_HOME\u001b[0m: \u001b[1m\u001b[32mString\u001b[0m = /media/ometaxas/nvme/datasets/institutions\n\u001b[1m\u001b[34minstitutionsTsvFilename\u001b[0m: \u001b[1m\u001b[32mString\u001b[0m = AffiliationsExtended.tsv\n\u001b[1m\u001b[34minstitutionsSchema\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.types.StructType\u001b[0m = StructType(StructField(affId,StringType,true), StructField(magId,LongType,false), StructField(gridId,StringType,true), StructField(ringgoldId,StringType,true), StructField(wikiIds,StringType,true), StructField(isniIds,StringType,true), StructField(rorIds,StringType,true), StructField(fundrefIds,StringType,true), StructField(name,StringType,true), StructField(normalizedNames,StringType,true), StructField(acronyms,StringType,true), StructField(url...\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {},
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616254472674_761382821",
   "id": "paragraph_1616254472674_761382821",
   "dateCreated": "2021-03-20T17:34:32+0200",
   "dateStarted": "2021-03-20T17:34:32+0200",
   "dateFinished": "2021-03-20T17:34:32+0200",
   "status": "FINISHED"
  },
  {
   "title": "Analyze problematic cases",
   "text": "%spark\n/*\ninstitutionsdf\n.filter( \n    //($\"normalizedNames\".contains(\"rio tinto\")    &&  $\"urls\".contains(\"riotinto.com\"))//            ||\n              array_contains($\"normalizedNamesArr\",\"university of paris\") ||\n    array_contains($\"normalizedNamesArr\",\"canon\") ||  \n    array_contains($\"normalizedNamesArr\",\"university of paris\") ||\n    array_contains($\"normalizedNamesArr\",\"oklahoma state university\") ||\n    array_contains($\"normalizedNamesArr\",\"rio tinto\") ||\n    array_contains($\"normalizedNamesArr\",\"mitsubishi electric\") ||\n    array_contains($\"normalizedNamesArr\",\"toyota\") ||\n    array_contains($\"normalizedNamesArr\",\"university of rennes\")  ||\n        array_contains($\"normalizedNamesArr\",\"world health organization\") \n            )\n        .show()\n        //.select(     $\"affId\", $\"magId\",$\"gridId\",$\"ringgoldId\",$\"wikiIds\",$\"rorIds\",$\"name\",$\"normalizedNames\",$\"urls\",$\"countryCode\", $\"wikiPageUrls\")\n//.coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/uniofParis.csv\")\n   //cases.coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/cases2.csv\")\n*/\n /*\nval unMatchedMAG = institutionsdf\n.filter(\n    ($\"gridId\"===\"\" || isnull($\"gridId\"))\n     && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\"))        \n        &&  $\"magId\"=!=0 && !isnull($\"magId\")\n        \n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\n\nunMatchedMAG.show(50)\nprintln(unMatchedMAG.count())\n*/\n\nval rin_grid = institutionsdf\n.filter(($\"gridId\"===\"\" || isnull($\"gridId\")) && \n        $\"ringgoldId\"=!=\"\" && !isnull($\"ringgoldId\") \n//&&  $\"magId\"=!=0 && !isnull($\"magId\")\n        &&  $\"wikiIds\"=!=\"\" && !isnull($\"wikiIds\")\n    //&& ($\"wikiIds\"===\"\" || isnull($\"wikiIds\"))\n        )\n        .cache()\n\nprintln(rin_grid.count())\nrin_grid.show(20)\n\n\n\n\nval grid_noRing = institutionsdf\n.filter(\n    $\"gridId\"=!=\"\" && !isnull($\"gridId\") \n        //&& \n   //$\"magId\"=!=0 && !isnull($\"magId\") \n        && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\")) \n            )        \n        //.orderBy($\"paperCount\" desc)\n        .cache()\ngrid_noRing.show(true)\nprintln(grid_noRing.count())\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T16:55:35+0200",
   "config": {
    "title": true,
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Table",
        "table": {
         "visibleRow": 3.0
        },
        "chart": {
         "series": [
          {
           "type": "Line",
           "x": {
            "column": "affId",
            "index": 0.0
           },
           "y": {
            "column": "ringgoldId",
            "index": 3.0
           }
          }
         ]
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "50708\n+----------------+---------+------+----------+--------------------+----------------+------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+---------------+-----------+----------+-----------+---------+--------+-------+----------+----------------+-------------+--------------------+--------------------+--------------------+\n|           affId|    magId|gridId|ringgoldId|             wikiIds|         isniIds|rorIds|fundrefIds|                name|     normalizedNames|acronyms|                urls|        wikiPageUrls|email|           city|      state|  postCode|countryCode|longitude|latitude|magRank|paperCount|paperFamilyCount|citationCount|  normalizedNamesArr|             urlsArr|     wikiPageUrlsArr|\n+----------------+---------+------+----------+--------------------+----------------+------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+---------------+-----------+----------+-----------+---------+--------+-------+----------+----------------+-------------+--------------------+--------------------+--------------------+\n|930273567_100342|930273567|  null|    100342|             Q181554|0000000406205779|  null|      null|        Hempel Group|hempel||hempel a ...|    null|http://www.hempel...|http://en.wikiped...| null|         Lyngby|       null|      2800|         DK| 12.52827|55.79253|  14324|        84|              83|         1284|[hempel, hempel a...|[www.hempel.comen...|[http://en.wikipe...|\n|          102563|     null|  null|    102563|           Q67082390|0000000406309308|  null|      null|      Vermont School|      vermont school|    null|www.vermont.south...|                null| null|    Southampton|Southampton|  SO16 7LT|         GB|     null|    null|   null|      null|            null|         null|    [vermont school]|[www.vermont.sout...|                null|\n|          102624|     null|  null|    102624|             Q198745|0000000406312558|  null|      null|United Church of ...|eglise unie du ca...|    null|www.united-church.ca|                null| null|        Toronto|         ON|   M8X 2Y4|         CA|     null|    null|   null|      null|            null|         null|[eglise unie du c...|[www.united-churc...|                null|\n|            1056|     null|  null|      1056|            Q3054418|0000000403670704|  null|      null|Parliament of Sou...|parlament von sou...|    null|www.parliament.sa...|                null| null|       Adelaide|         SA|      5001|         AU|     null|    null|   null|      null|            null|         null|[parlament von so...|[www.parliament.s...|                null|\n|          108394|     null|  null|    108394|Q99285312||Q99285313|0000000406487569|  null|      null|Lesley University...|lesley university...|    null|www.lesley.edu/gr...|                null| null|        Netanya|    Central|     42160|         IL|     null|    null|   null|      null|            null|         null|[lesley universit...|[www.lesley.edugr...|                null|\n|          109902|     null|  null|    109902|            Q7165322|0000000403755396|  null|      null|Pentucket Regiona...|pentucket regiona...|    null|        www.prsd.org|                null| null|   West Newbury|         MA|01985-1897|         US|     null|    null|   null|      null|            null|         null|[pentucket region...|      [www.prsd.org]|                null|\n|          110695|     null|  null|    110695|            Q7987595|000000040382008X|  null|      null|Western Autistic ...|western autistic ...|    null|www.westaut.vic.e...|                null| null|        Niddrie|        VIC|      3042|         AU|     null|    null|   null|      null|            null|         null|[western autistic...|[www.westaut.vic....|                null|\n| 55648288_112151| 55648288|  null|    112151|            Q6041530|0000000105958152|  null|      null|Instituto Superio...|instituto industr...|    null|http://www.isel.p...|http://en.wikiped...| null|         Lisboa|     Lisboa|  1959-007|         PT| -9.11667|38.75583|  11094|      2131|            2076|        24699|[instituto indust...|[www.isel.pt, www...|[http://en.wikipe...|\n|          112801|     null|  null|    112801|           Q12798067|0000000403998582|  null|      null|Osnovna Sola Dani...|danila kumar elem...|    null|www.os-danilekuma...|                null| null|      Ljubljana|       null|      1113|         SI|     null|    null|   null|      null|            null|         null|[danila kumar ele...|[www.os-danilekum...|                null|\n|          113511|     null|  null|    113511|             Q738582|0000000404063965|  null|      null|Kluane National P...|kluane national p...|    null|www.pc.gc.ca/eng/...|                null| null|Haines Junction|         YT|   Y0B 1L0|         CA|     null|    null|   null|      null|            null|         null|[kluane national ...|[www.pc.gc.caengp...|                null|\n|          113708|     null|  null|    113708|             Q203403|0000000098085671|  null|      null|  City of Saint John|city of saint joh...|    null|    www.saintjohn.ca|                null| null|     Saint John|         NB|   E2L 4L1|         CA|     null|    null|   null|      null|            null|         null|[city of saint jo...|  [www.saintjohn.ca]|                null|\n|          114757|     null|  null|    114757|           Q99287186|0000000404216749|  null|      null|Irbid National Un...|irbid national un...|    null|      www.inu.edu.jo|                null| null|          Irbid|       null|      null|         JO|     null|    null|   null|      null|            null|         null|[irbid national u...|    [www.inu.edu.jo]|                null|\n|          115373|     null|  null|    115373|           Q16147530|0000000090025172|  null|      null|Oklahoma Corporat...|oklahoma corporat...|    null| www.occ.state.ok.us|                null| null|  Oklahoma City|         OK|73152-2000|         US|     null|    null|   null|      null|            null|         null|[oklahoma corpora...|[www.occ.state.ok...|                null|\n|          116470|     null|  null|    116470|          Q100993941|0000000404377809|  null|      null|Pace University -...|pace university p...|    null|www.pace.edu/abou...|                null| null|  Pleasantville|         NY|     10570|         US|     null|    null|   null|      null|            null|         null|[pace university ...|[www.pace.eduabou...|                null|\n|          119183|     null|  null|    119183|           Q28223201|0000000403678108|  null|      null|University of Zam...|university of zam...|    null|medicine.unza.zm|...|                null| null|         Lusaka|     Lusaka|      null|         ZM|     null|    null|   null|      null|            null|         null|[university of za...|[medicine.unza.zm...|                null|\n|          121152|     null|  null|    121152|           Q86026697|0000000403819695|  null|      null|Queen's Universit...|queens university...|    null|   www.qub.ac.uk/mgt|                null| null|        Belfast|    Belfast|   BT7 1NN|         GB|     null|    null|   null|      null|            null|         null|[queens universit...|  [www.qub.ac.ukmgt]|                null|\n|          122014|     null|  null|    122014|           Q99287175|0000000403873384|  null|      null|B and B Universit...|b and b universit...|    null|bbucjm.com||www.b...|                null| null|   New Kingston|       null|        10|         JM|     null|    null|   null|      null|            null|         null|[b and b universi...|[bbucjm.com, www....|                null|\n|          122089|     null|  null|    122089|            Q6051134|0000000403883750|  null|      null|International Ins...|iib||internationa...|    null|      www.iib.com.ua|                null| null|           Kiev|       null|     03113|         UA|     null|    null|   null|      null|            null|         null|[iib, internation...|    [www.iib.com.ua]|                null|\n|          123674|     null|  null|    123674|             Q684800|0000000404013140|  null|      null|International Com...|cij||comision int...|    null|         www.icj.org|                null| null|         Geneva|     Geneva|      1211|         CH|     null|    null|   null|      null|            null|         null|[cij, comision in...|       [www.icj.org]|                null|\n|          123751|     null|  null|    123751|          Q101028588|0000000404018988|  null|      null|Washington Univer...|washington univer...|    null|    artsci.wustl.edu|                null| null|       St Louis|         MO|63130-4899|         US|     null|    null|   null|      null|            null|         null|[washington unive...|  [artsci.wustl.edu]|                null|\n+----------------+---------+------+----------+--------------------+----------------+------+----------+--------------------+--------------------+--------+--------------------+--------------------+-----+---------------+-----------+----------+-----------+---------+--------+-------+----------+----------------+-------------+--------------------+--------------------+--------------------+\nonly showing top 20 rows\n\n+-------------+-----+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+----------+--------------------+--------------------+-----+--------------+-------------+--------+-----------+-----------+---------+-------+----------+----------------+-------------+--------------------+--------------------+--------------------+\n|        affId|magId|       gridId|ringgoldId|  wikiIds|         isniIds|   rorIds|fundrefIds|                name|     normalizedNames|  acronyms|                urls|        wikiPageUrls|email|          city|        state|postCode|countryCode|  longitude| latitude|magRank|paperCount|paperFamilyCount|citationCount|  normalizedNamesArr|             urlsArr|     wikiPageUrlsArr|\n+-------------+-----+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+----------+--------------------+--------------------+-----+--------------+-------------+--------+-----------+-----------+---------+-------+----------+----------------+-------------+--------------------+--------------------+--------------------+\n|grid.282237.e| null|grid.282237.e|      null|Q30253499|            null|02ccwf677|      null|Proportional Tech...|proportional tech...|       PTI|http://www.propor...|                null| null|       Houston|        Texas|    null|         US| -95.388437|29.687341|   null|      null|            null|         null|[proportional tec...|[www.proportional...|                null|\n|grid.292707.9| null|grid.292707.9|      null|Q30253589|            null|01wpkc438|      null|Canadian Foundati...|canadian foundati...|     CFISU|http://www.cfisu.ca/|                null| null|        Ottawa|      Ontario|    null|         CA| -75.702792|45.412415|   null|      null|            null|         null|[canadian foundat...|      [www.cfisu.ca]|                null|\n|grid.294071.9| null|grid.294071.9|      null| Q3152656|0000000091999374|031z68d90|      null|Institut Universi...|institut universi...|      IUGM|http://www.iugm.q...|                null| null|      Montreal|       Quebec|    null|         CA| -73.623713|45.491105|   null|      null|            null|         null|[institut univers...|    [www.iugm.qc.ca]|                null|\n|grid.300821.8| null|grid.300821.8|      null|Q30253622|            null|057e34m22|      null|University of Mas...|umass donahue ins...|      null|http://www.donahu...|                null| null|        Hadley|Massachusetts|    null|         US| -72.546288|42.364902|   null|      null|            null|         null|[umass donahue in...|[www.donahue.umas...|                null|\n|grid.410314.3| null|grid.410314.3|      null|Q29122885|            null|01vnxev61|      null|      Bayer (Canada)|               bayer|      null|http://www.bayer.ca/|http://en.wikiped...| null|   Mississauga|      Ontario|    null|         CA|  -79.59124|43.666091|   null|      null|            null|         null|             [bayer]|      [www.bayer.ca]|[http://en.wikipe...|\n|grid.410750.7| null|grid.410750.7|      null|Q30253764|            null|05jtcqr88|      null|Thermo Fisher Sci...|fei company||ther...|      null|https://www.therm...|https://en.wikipe...| null|      Shanghai|         null|    null|         CN| 121.588336|31.190599|   null|      null|            null|         null|[fei company, the...|[www.thermoscient...|[https://en.wikip...|\n|grid.413164.5| null|grid.413164.5|      null|Q30254185|            null|05bhd7f62|      null|  458th Hospital PLA|458th hospital pl...|      null|http://www.458hos...|                null| null|     Guangzhou|         null|    null|         CN| 113.312755| 23.13157|   null|      null|            null|         null|[458th hospital p...|[www.458hospital....|                null|\n|grid.414422.5| null|grid.414422.5|      null|Q30280028|            null|009nscf91|      null|Centre Hospitalie...|centre hospitalie...|      null|https://www.chuma...|                null| null|     Marrakesh|         null|    null|         MA|  -7.995839|31.663427|   null|      null|            null|         null|[centre hospitali...|[www.chumarrakech...|                null|\n|grid.414838.2| null|grid.414838.2|      null|Q16576090|            null|03n85hy63|      null|Hospital Militar ...|hospital militar ...|      null|http://hmcarlosar...|                null| null|       Caracas|         null|    null|         VE| -66.938855|10.497892|   null|      null|            null|         null|[hospital militar...|[hmcarlosarvelo.m...|                null|\n|grid.415331.1| null|grid.415331.1|      null|Q30280433|            null|00ajg8537|      null|Gaziantep Onkoloj...|gaziantep onkoloj...|      null|http://gul6.bim.g...|                null| null|     Gaziantep|         null|    null|         TR|  37.371895|37.072312|   null|      null|            null|         null|[gaziantep onkolo...|[gul6.bim.gantep....|                null|\n|grid.416095.f| null|grid.416095.f|      null|Q30280765|            null|000vvpv33|      null|Social Insurance ...|social insurance ...|      null|http://yokohama.j...|                null| null|      Yokohama|         null|    null|         JP| 139.643895|35.440947|   null|      null|            null|         null|[social insurance...|[yokohama.jcho.go...|                null|\n|grid.416746.6| null|grid.416746.6|      null|Q30280993|            null|03j7t7330|      null|St. Joseph's Chil...|st josephs childr...|      null|https://baycare.o...|                null| null|         Tampa|      Florida|    null|         US| -82.490853|27.982615|   null|      null|            null|         null|[st josephs child...|   [baycare.orgsjch]|                null|\n|grid.417487.9| null|grid.417487.9|      null|Q30281340|            null|045mbap50|      null|Twin Star Medical...|   twin star medical|      null|http://www.twinst...|                null| null|   Minneapolis|    Minnesota|    null|         US| -93.259063|44.970891|   null|      null|            null|         null| [twin star medical]|[www.twinstarmedi...|                null|\n|grid.417576.6| null|grid.417576.6|      null|Q28974637|            null|01w8r0j67|      null|      Abbott (Spain)|              abbott|      null|http://www.abbott...|https://en.wikipe...| null|        Madrid|         null|    null|         ES|  -3.670681|40.493957|   null|      null|            null|         null|            [abbott]|[www.abbott.esind...|[https://en.wikip...|\n|grid.419187.2| null|grid.419187.2|      null|Q30282032|            null|03sqq2g46|      null|Retina Foundation...|retina foundation...|      null|http://retinafoun...|                null| null|        Dallas|        Texas|    null|         US| -96.769163|32.879492|   null|      null|            null|         null|[retina foundatio...|[retinafoundation...|                null|\n|grid.419277.e| null|grid.419277.e|      null|Q30282075|0000000107400996|026a3nk20|      null|Sitaram Bhartia I...|sitaram bhartia i...|      null|http://www.sitara...|                null| null|     New Delhi|         null|    null|         IN|  77.184646|28.537983|   null|      null|            null|         null|[sitaram bhartia ...|[www.sitarambhart...|                null|\n|grid.419549.4| null|grid.419549.4|      null|Q28974622|000000012202540X|05p330p21|      null|Shell (United Kin...|royal dutch shell...|      null|http://www.shell....|https://en.wikipe...| null|        London|         null|    null|         GB|  -0.119485|51.509508|   null|      null|            null|         null|[royal dutch shel...|   [www.shell.co.uk]|[https://en.wikip...|\n|grid.420164.5| null|grid.420164.5|      null|Q30282402|            null|016sds817|      null|Tyrolean Cancer R...|tcri||tiroler kre...|TCRI||TKFI| http://www.tcri.at/|                null| null|     Innsbruck|         null|    null|         AT|  11.382692|47.260848|   null|      null|            null|         null|[tcri, tiroler kr...|       [www.tcri.at]|                null|\n|grid.420585.e| null|grid.420585.e|      null|Q30282627|            null|040ktyf25|      null|JP Laboratories (...|     jp laboratories|      null|http://www.jplabs...|                null| null|     Middlesex|   New Jersey|    null|         US| -74.489425|40.571076|   null|      null|            null|         null|   [jp laboratories]|    [www.jplabs.com]|                null|\n|grid.420588.3| null|grid.420588.3|      null| Q5127353|            null|028ca6f22|      null|   Clark Planetarium|   clark planetarium|      null|http://clarkplane...|https://en.wikipe...| null|Salt Lake City|         Utah|    null|         US|-111.903376|40.766613|   null|      null|            null|         null| [clark planetarium]|[clarkplanetarium...|[https://en.wikip...|\n+-------------+-----+-------------+----------+---------+----------------+---------+----------+--------------------+--------------------+----------+--------------------+--------------------+-----+--------------+-------------+--------+-----------+-----------+---------+-------+----------+----------------+-------------+--------------------+--------------------+--------------------+\nonly showing top 20 rows\n\n53461\n\u001b[1m\u001b[34mrin_grid\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string, magId: bigint ... 25 more fields]\n\u001b[1m\u001b[34mgrid_noRing\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string, magId: bigint ... 25 more fields]\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=31"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=32"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=33"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=34"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616252135687_113900305",
   "id": "paragraph_1616252135687_113900305",
   "dateCreated": "2021-03-20T16:55:35+0200",
   "dateStarted": "2021-03-20T16:55:35+0200",
   "dateFinished": "2021-03-20T16:55:36+0200",
   "status": "FINISHED"
  },
  {
   "title": "Name based matching on GRID - Ringgold",
   "text": "%spark\n\nimport org.apache.spark.sql.functions._\n\nval grid_noRing = institutionsdf\n.filter(\n    ($\"gridId\"=!=\"\" && !isnull($\"gridId\") \n     && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\")))    \n            //||    ($\"magId\"=!=0 && !isnull($\"magId\") \n        //&& ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\"))\n        //&& ($\"gridId\"===\"\" || isnull($\"gridId\"))) \n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\n//grid_noRing.show(50)\nprintln(grid_noRing.count())\n\nval name_based_matchesall = institutionsdf.filter($\"gridId\"===\"\" || isnull($\"gridId\") ).as(\"df1\").join(broadcast(grid_noRing.as(\"df2\")),  \n    arrays_overlap($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\") && $\"df1.affId\" =!=$\"df2.affId\" \n            && arrays_overlap($\"df1.urlsArr\",$\"df2.urlsArr\") \n&& $\"df2.countryCode\" === $\"df1.countryCode\"\n    , \"inner\")\n .select( $\"df2.affId\".as(\"affId2\"), $\"df1.ringgoldId\".as(\"ringgoldId\"),$\"df2.gridId\".as(\"gridId\"),\n     when($\"df2.magId\"=!=0 && !isnull($\"df2.magId\"),$\"df2.magId\").otherwise($\"df1.magId\").as(\"magId\"),     \n     $\"df1.affId\".as(\"affId1\"),  $\"df2.name\".as(\"name\"), $\"df1.name\".as(\"name1\"),   \n     \n             array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\").as(\"normalizedNamesArr\"),\n            array_union($\"df1.urlsArr\",$\"df2.urlsArr\").as(\"urlsArr\"),\n            array_union($\"df1.wikiPageUrlsArr\",$\"df2.wikiPageUrlsArr\").as(\"wikiPageUrlsArr\"),\n            array_union($\"df1.acronymsArr\",$\"df2.acronymsArr\").as(\"acronymsArr\"),\n        array_union($\"df1.fundrefIdsArr\",$\"df2.fundrefIdsArr\").as(\"fundrefIdsArr\"),\n        array_union($\"df1.rorIdsArr\",$\"df2.rorIdsArr\").as(\"rorIdsArr\"),\n        array_union($\"df1.wikiIdsArr\",$\"df2.wikiIdsArr\").as(\"wikiIdsArr\"),\n     when($\"df2.email\"=!=0 && !isnull($\"df2.email\"),$\"df2.email\").otherwise($\"df1.email\").as(\"email\"),\n     when($\"df2.city\"=!=0 && !isnull($\"df2.city\"),$\"df2.city\").otherwise($\"df1.city\").as(\"city\"),\n     when($\"df2.state\"=!=0 && !isnull($\"df2.state\"),$\"df2.state\").otherwise($\"df1.state\").as(\"state\"),\n     $\"df2.countryCode\".as(\"countryCode\"),\n     when($\"df2.postCode\"=!=0 && !isnull($\"df2.postCode\"),$\"df2.postCode\").otherwise($\"df1.postCode\").as(\"postCode\"),\n     when($\"df2.latitude\"=!=0 && !isnull($\"df2.latitude\"),$\"df2.latitude\").otherwise($\"df1.latitude\").as(\"latitude\"),\n     when($\"df2.longitude\"=!=0 && !isnull($\"df2.longitude\"),$\"df2.longitude\").otherwise($\"df1.longitude\").as(\"longitude\"),\n     when($\"df2.papercount\"=!=0 && !isnull($\"df2.papercount\"),$\"df2.papercount\").otherwise($\"df1.papercount\").as(\"papercount\"),\n     when($\"df2.citationcount\"=!=0 && !isnull($\"df2.citationcount\"),$\"df2.citationcount\").otherwise($\"df1.citationcount\").as(\"citationcount\"),\n     when($\"df2.paperFamilyCount\"=!=0 && !isnull($\"df2.paperFamilyCount\"),$\"df2.paperFamilyCount\").otherwise($\"df1.paperFamilyCount\").as(\"paperFamilyCount\"),\n     when($\"df2.magrank\"=!=0 && !isnull($\"df2.magrank\"),$\"df2.magrank\").otherwise($\"df1.magrank\").as(\"magrank\"),\n              //array_join(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\"), \"||\").as(\"normalizedNamesAll\"),\n              //  array_join(array_union($\"df1.urlsArr\",$\"df2.urlsArr\"), \"||\").as(\"urlsAll\"), \n                ((size(array_intersect($\"df1.urlsArr\",$\"df2.urlsArr\")) / size(array_union($\"df1.urlsArr\",$\"df2.urlsArr\")))+\n                (size(array_intersect($\"df1.wikiPageUrlsArr\",$\"df2.wikiPageUrlsArr\")) / size(array_union($\"df1.wikiPageUrlsArr\",$\"df2.wikiPageUrlsArr\")))+\n                (size(array_intersect($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")) / size(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")))).as(\"jaccard\")\n         //, ($\"jaccurl\"+$\"jaccname\").as(\"jacc\")\n                \n                )\n        .orderBy($\"df2.name\")\n        .cache()\n\nprintln(name_based_matchesall.count())\nname_based_matchesall.show(false)\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T18:13:57+0200",
   "config": {
    "title": true
   },
   "settings": {
    "params": {},
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "\u001b[33mwarning: \u001b[0mthere was one feature warning; for details, enable `:setting -feature' or `:replay -feature'\n53461\n2913\n+------------------------+----------+-------------+----------+------+------------------------------------------------------------+----------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+---------------+-----------+-------------+---------+----------+-----+-------------------+-------------+-----------+----------+----------+-----------+----------+-------------+----------------+-------+------------------+\n|affId2                  |ringgoldId|gridId       |magId     |affId1|name                                                        |name1                                                           |normalizedNamesArr                                                                                                                                                                                                                          |urlsArr                                                      |wikiPageUrlsArr|acronymsArr|fundrefIdsArr|rorIdsArr|wikiIdsArr|email|city               |state        |countryCode|postCode  |latitude  |longitude  |papercount|citationcount|paperFamilyCount|magrank|jaccard           |\n+------------------------+----------+-------------+----------+------+------------------------------------------------------------+----------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+---------------+-----------+-------------+---------+----------+-----+-------------------+-------------+-----------+----------+----------+-----------+----------+-------------+----------------+-------+------------------+\n|grid.498512.3           |586806    |grid.498512.3|null      |586806|10X Genomics (United States)                                |10X Genomics                                                    |[10x genomics]                                                                                                                                                                                                                              |[www.10xgenomics.com]                                        |null           |null       |null         |null     |null      |null |Pleasanton         |null         |US         |94566-3111|37.66166  |-121.877016|null      |null         |null            |null   |3.0               |\n|grid.460041.7           |477284    |grid.460041.7|null      |477284|181st Hospital of Chinese People's Liberation Army          |181st Hospital of Chinese People's Liberation Army              |[181st hospital of chinese peoples liberation army, peoples liberation army joint logistic support force 924th hospital]                                                                                                                    |[www.gl181.com]                                              |null           |null       |null         |null     |null      |null |Guilin             |Guangxi      |CN         |541004    |25.264363 |110.291831 |null      |null         |null            |null   |2.5               |\n|grid.280939.9           |383454    |grid.280939.9|null      |383454|3C Institute                                                |3C Institute                                                    |[3c institute, center for research in emotional and social health, 3c institute for social development, communication cooperation and confidence]                                                                                           |[www.3cisd.com, www.cresh.org]                               |null           |null       |null         |null     |null      |null |Durham             |NC           |US         |27713     |35.907945 |-78.889225 |null      |null         |null            |null   |1.75              |\n|grid.450536.1           |156225    |grid.450536.1|null      |156225|92nd Street Young Men's and Young Women's Hebrew Association|92nd Street Young Men's and Young Women's Hebrew Association    |[92nd street y, 92nd street young mens and young womens hebrew association, 92y]                                                                                                                                                            |[www.92y.org]                                                |null           |null       |null         |null     |null      |null |New York           |NY           |US         |10128-1612|40.783    |-73.9527   |null      |null         |null            |null   |3.0               |\n|2800430505_grid.491739.1|525643    |grid.491739.1|2800430505|525643|AAB College                                                 |Kolegji AAB                                                     |[aab college, kolegji aab, aab university]                                                                                                                                                                                                  |[aab-edu.net]                                                |null           |null       |null         |null     |null      |null |Prishtina          |Prishtina    |XK         |10000     |42.6394   |21.1103    |58        |42           |58              |15340  |2.6666666666666665|\n|grid.497914.6           |578857    |grid.497914.6|null      |578857|AARNet (Australia)                                          |Academic and Research Network                                   |[aarnet, academic and research network, australias academic and research network]                                                                                                                                                           |[www.aarnet.edu.au]                                          |null           |null       |null         |null     |null      |null |Chatswood          |NSW          |AU         |2067      |-33.79766 |151.179172 |null      |null         |null            |null   |2.3333333333333335|\n|grid.474928.4           |560716    |grid.474928.4|null      |560716|ACCESS Health International                                 |ACCESS Health International                                     |[access health international]                                                                                                                                                                                                               |[accessh.org]                                                |null           |null       |null         |null     |null      |null |New York           |NY           |US         |10028     |40.779233 |-73.961415 |null      |null         |null            |null   |3.0               |\n|grid.506729.f           |503112    |grid.506729.f|null      |503112|AGC Interpane (Germany)                                     |Interpane Glas Industrie AG                                     |[interpane glas industrie ag, agc interpane, interpane]                                                                                                                                                                                     |[www.interpane.com]                                          |null           |null       |null         |null     |null      |null |Lauenforde         |Niedersachsen|DE         |37697     |51.666466 |9.38864    |null      |null         |null            |null   |2.3333333333333335|\n|grid.498027.0           |551985    |grid.498027.0|null      |551985|ALP Technologies (United Kingdom)                           |Alp Technologies                                                |[alp technologies]                                                                                                                                                                                                                          |[www.alp-technologies.com]                                   |null           |null       |null         |null     |null      |null |London             |London       |GB         |E17 6BX   |51.591956 |-0.039164  |null      |null         |null            |null   |3.0               |\n|grid.481971.2           |504348    |grid.481971.2|null      |504348|ARC Centre of Excellence for Electromaterials Science       |ARC Centre of Excellence for Electromaterials Science           |[arc centre of excellence for electromaterials science, aces, australian research council centre of excellence for electromaterials science]                                                                                                |[www.electromaterials.edu.au]                                |null           |null       |null         |null     |null      |null |North Wollongong   |NSW          |AU         |2500      |-34.409488|150.878195 |null      |null         |null            |null   |2.3333333333333335|\n|grid.498007.2           |576312    |grid.498007.2|null      |576312|ARK Foundation                                              |ARK Foundation                                                  |[ark foundation]                                                                                                                                                                                                                            |[arkfoundationbd.org]                                        |null           |null       |null         |null     |null      |null |Dhaka              |null         |BD         |1212      |23.783322 |90.394103  |null      |null         |null            |null   |3.0               |\n|grid.455146.7           |314587    |grid.455146.7|null      |314587|ASE Holdings (United States)                                |ASE Holdings                                                    |[aerospace systems engineering, ase holdings]                                                                                                                                                                                               |[www.aseholdings.com]                                        |null           |null       |null         |null     |null      |null |Saint Paul         |MN           |US         |55107     |44.943288 |-93.076045 |null      |null         |null            |null   |2.5               |\n|grid.476841.8           |18720     |grid.476841.8|null      |18720 |ASST Melegnano e della Martesana                            |Aziende Socio Sanitarie Territoriale Melegnano e della Martesana|[asst melegnano e della martesana, azienda ospedaliera di melegnano, aziende socio sanitarie territoriale melegnano e della martesana, regional health care and social agency of melegnano and of martesana, ospedale di vizzolo predabissi]|[www.asst-melegnano-martesana.it]                            |null           |null       |null         |null     |null      |null |Vizzolo Predabissi |Lombardia    |IT         |20070     |45.359061 |9.340538   |null      |null         |null            |null   |2.2               |\n|327656168_grid.422532.0 |148784    |grid.422532.0|327656168 |148784|ASTM International                                          |ASTM International                                              |[american society for testing and materials, astm international, a s t m, american society for testing of materials, american society of testing materials, astm, sociedad americana para pruebas de materiales]                            |[www.astm.org]                                               |null           |null       |null         |null     |null      |null |West Conshohocken  |PA           |US         |19428-2959|40.0692062|-75.30886  |86        |345          |86              |14562  |2.2857142857142856|\n|198412221_grid.418861.2 |54601     |grid.418861.2|198412221 |54601 |ATOMKI                                                      |Magyar Tudomanyos Akademia Atommagkutato Intezet                |[institute for nuclear research, magyar tudomanyos akademia atommagkutato intezet, mta atomki, atomki, atommagkutato intezete]                                                                                                              |[www.atomki.hu, www.atomki.mta.hu, w3.atomki.huindex_en.html]|null           |null       |null         |null     |null      |null |Debrecen           |Hajdú-Bihar  |HU         |4001      |47.6401062|21.6267185 |1402      |21491        |1388            |10074  |1.7333333333333334|\n|grid.494004.d           |39993     |grid.494004.d|null      |39993 |AWO Bundesverband                                           |AWO Bundesverband eV                                            |[arbeiterwohlfahrt, awo bundesverband ev, german federation of workers welfare associations, arbeiterwohlfahrt bundesverband, awo, awo bundesverband]                                                                                       |[www.awo.org]                                                |null           |null       |null         |null     |null      |null |Berlin             |Berlin       |DE         |10961     |52.4952533|13.3984602 |null      |null         |null            |null   |2.1666666666666665|\n|grid.427949.5           |484460    |grid.427949.5|null      |484460|Abilities In Motion                                         |Abilities in Motion                                             |[abilities in motion, aim, berks county center for independent living]                                                                                                                                                                      |[www.abilitiesinmotion.org]                                  |null           |null       |null         |null     |null      |null |Reading            |PA           |US         |19601-3304|40.338666 |-75.927807 |null      |null         |null            |null   |2.6666666666666665|\n|grid.509016.b           |5664      |grid.509016.b|null      |5664  |Acacia Research Corporation (United States)                 |Acacia Research Corporation                                     |[acacia research corporation]                                                                                                                                                                                                               |[www.acaciaresearch.com]                                     |null           |null       |null         |null     |null      |null |Irvine             |CA           |US         |92614-2503|33.67836  |-117.83785 |null      |null         |null            |null   |3.0               |\n|1311099166_grid.482250.9|111184    |grid.482250.9|1311099166|111184|Academia Sinica Institute of Astronomy and Astrophysics     |Institute of Astronomy and Astrophysics Academia Sinica         |[institute of astronomy and astrophysics academia sinica, academia sinica institute of astronomy and astrophysics, asiaa, institute of astronomy and astrophysics]                                                                          |[www.asiaa.sinica.edu.tw]                                    |null           |null       |null         |null     |null      |null |Taiepei            |null         |TW         |null      |25.0225277|121.53817  |1212      |30412        |1144            |10840  |2.25              |\n|grid.499614.7           |568349    |grid.499614.7|null      |568349|Academic Health Science Network North East and North Cumbria|Academic Health Science Network North East and North Cumbria    |[academic health science network north east and north cumbria, ahsn nenc]                                                                                                                                                                   |[www.ahsn-nenc.org.uk]                                       |null           |null       |null         |null     |null      |null |Newcastle upon Tyne|null         |GB         |NE4 5PL   |54.976134 |-1.644613  |null      |null         |null            |null   |3.0               |\n+------------------------+----------+-------------+----------+------+------------------------------------------------------------+----------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+---------------+-----------+-------------+---------+----------+-----+-------------------+-------------+-----------+----------+----------+-----------+----------+-------------+----------------+-------+------------------+\nonly showing top 20 rows\n\nimport org.apache.spark.sql.functions._\n\u001b[1m\u001b[34mgrid_noRing\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string, magId: bigint ... 29 more fields]\n\u001b[1m\u001b[34mname_based_matchesall\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId2: string, ringgoldId: string ... 24 more fields]\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=54"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=56"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=57"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=58"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=59"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616256837345_763743374",
   "id": "paragraph_1616256837345_763743374",
   "dateCreated": "2021-03-20T18:13:57+0200",
   "dateStarted": "2021-03-20T18:13:57+0200",
   "dateFinished": "2021-03-20T18:18:59+0200",
   "status": "FINISHED"
  },
  {
   "title": "Analyze Matched data",
   "text": "%spark\n\n\nval df22 = name_based_matchesall.select(countDistinct(\"ringgoldId\"))\ndf22.show(false)\n\nval df3 = name_based_matchesall.select(countDistinct(\"gridId\"))\ndf3.show(false)\n\nval df4 = name_based_matchesall.select(countDistinct(\"magId\"))\ndf4.show(false)\n\nval double_Grids = name_based_matchesall.groupBy($\"gridId\")\n  .agg(count(\"gridId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Grids.count())\n\nval double_Mag = name_based_matchesall.groupBy($\"magId\")\n  .agg(count(\"magId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Mag.count())",
   "user": "anonymous",
   "dateUpdated": "2021-03-20T18:21:08+0200",
   "config": {
    "title": true,
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console"
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "+--------------------------+\n|count(DISTINCT ringgoldId)|\n+--------------------------+\n|2891                      |\n+--------------------------+\n\n+----------------------+\n|count(DISTINCT gridId)|\n+----------------------+\n|2885                  |\n+----------------------+\n\n+---------------------+\n|count(DISTINCT magId)|\n+---------------------+\n|583                  |\n+---------------------+\n\n25\n4\n\u001b[1m\u001b[34mdf22\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT ringgoldId): bigint]\n\u001b[1m\u001b[34mdf3\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT gridId): bigint]\n\u001b[1m\u001b[34mdf4\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT magId): bigint]\n\u001b[1m\u001b[34mdouble_Grids\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [gridId: string, count: bigint]\n\u001b[1m\u001b[34mdouble_Mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [magId: bigint, count: bigint]\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=60"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=61"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=62"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=63"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=64"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616257268979_1544547740",
   "id": "paragraph_1616257268979_1544547740",
   "dateCreated": "2021-03-20T18:21:08+0200",
   "dateStarted": "2021-03-20T18:21:08+0200",
   "dateFinished": "2021-03-20T18:21:12+0200",
   "status": "FINISHED"
  },
  {
   "title": "Merge Grid - Ringgold",
   "text": "%spark\nimport org.apache.spark.sql.expressions.Window\n\nval window = Window.partitionBy(\"gridId\").orderBy(\"jaccard\")\n\nval dist_rows = name_based_matchesall.withColumn(\"row_num\", row_number().over(window))\n  .filter($\"row_num\" === 1)\n  .drop(\"row_num\").cache()\n\nval double_Grids = dist_rows.groupBy($\"gridId\")\n  .agg(count(\"gridId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Grids.count())\n//double_Grids.show(false)\n \nval ids2drop = dist_rows.select($\"affId2\".as(\"affId\")).union(dist_rows.select($\"affId1\".as(\"affId\")).distinct())\nprintln(ids2drop.count())\n\nprintln(institutionsdf.count())\n\nval remainingInstitutions = institutionsdf.join(ids2drop,ids2drop(\"affId\") === institutionsdf(\"affId\"), \"leftanti\") \n.select( $\"affId\", $\"ringgoldId\",$\"gridId\",$\"magId\", $\"name\",\n           $\"normalizedNamesArr\",    $\"urlsArr\",     $\"wikiPageUrlsArr\",\n           $\"acronymsArr\",  $\"fundrefIdsArr\",  $\"rorIdsArr\",   $\"wikiIdsArr\",\n     $\"email\", $\"city\",  $\"state\",  $\"countryCode\",   $\"postCode\",   $\"latitude\",    $\"longitude\",\n     $\"papercount\",     $\"citationcount\",     $\"paperFamilyCount\",     $\"magrank\")\n//select($\"affId\", $\"magId\",$\"gridId\",$\"ringgoldId\",$\"wikiIds\",$\"isniIds\" ,$\"rorIds\",$\"fundrefIds\", $\"name\", $\"normalizedNames\",$\"acronyms\", $\"urls\", $\"countryCode\", $\"papercount\")\n                      \nprintln(remainingInstitutions.count())\n\nval mergedInstances = dist_rows\n.select( \n         concat(when($\"magId\"=!=0 && !isnull($\"magId\"),$\"magId\").otherwise(\"\")\n         ,when($\"gridId\"=!=\"\" && !isnull($\"gridId\"), concat(lit(\"_\"), $\"gridId\")).otherwise(\"\")\n         ,when($\"ringgoldId\"=!=\"\" && !isnull($\"ringgoldId\"), concat(lit(\"_\"), $\"ringgoldId\")).otherwise(\"\")) \n    .as(\"affId\"),         \n    $\"ringgoldId\",$\"gridId\",$\"magId\", $\"name\",\n           $\"normalizedNamesArr\",    $\"urlsArr\",     $\"wikiPageUrlsArr\",\n           $\"acronymsArr\",  $\"fundrefIdsArr\",  $\"rorIdsArr\",   $\"wikiIdsArr\",\n     $\"email\", $\"city\",  $\"state\",  $\"countryCode\",   $\"postCode\",   $\"latitude\",    $\"longitude\",\n     $\"papercount\",     $\"citationcount\",     $\"paperFamilyCount\",     $\"magrank\")\n//.show(true)\n\nval  newInstitutionsdf =  remainingInstitutions.union(mergedInstances).cache()\n       \n       println(newInstitutionsdf.count())\n       newInstitutionsdf.show(true)\n       \n     //  newInsitutionsdf.select($\"affId\", $\"magId\",$\"gridId\",$\"ringgoldId\",$\"wikiIds\",$\"isniIds\" ,$\"rorIds\",$\"fundrefIds\", $\"name\", $\"normalizedNames\",$\"acronyms\", $\"urls\", $\"countryCode\", $\"papercount\").coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/PKGInstitutions.csv\")",
   "user": "anonymous",
   "dateUpdated": "2021-03-21T16:51:10+0200",
   "config": {
    "title": true,
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console",
        "chart": {
         "series": [
          {
           "type": "Line",
           "x": {
            "column": "affId",
            "index": 0.0
           },
           "y": {
            "column": "latitude",
            "index": 17.0
           }
          }
         ]
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "0\n5765\n603662\n597897\n600782\n+-------------+----------+-------------+-----+--------------------+--------------------+--------------------+--------------------+------------+-------------+-----------+-----------+-----+--------------+-------------+-----------+--------+---------+-----------+----------+-------------+----------------+-------+\n|        affId|ringgoldId|       gridId|magId|                name|  normalizedNamesArr|             urlsArr|     wikiPageUrlsArr| acronymsArr|fundrefIdsArr|  rorIdsArr| wikiIdsArr|email|          city|        state|countryCode|postCode| latitude|  longitude|papercount|citationcount|paperFamilyCount|magrank|\n+-------------+----------+-------------+-----+--------------------+--------------------+--------------------+--------------------+------------+-------------+-----------+-----------+-----+--------------+-------------+-----------+--------+---------+-----------+----------+-------------+----------------+-------+\n|grid.282237.e|      null|grid.282237.e| null|Proportional Tech...|[proportional tec...|[www.proportional...|                null|       [PTI]|         null|[02ccwf677]|[Q30253499]| null|       Houston|        Texas|         US|    null|29.687341| -95.388437|      null|         null|            null|   null|\n|grid.292707.9|      null|grid.292707.9| null|Canadian Foundati...|[canadian foundat...|      [www.cfisu.ca]|                null|     [CFISU]|         null|[01wpkc438]|[Q30253589]| null|        Ottawa|      Ontario|         CA|    null|45.412415| -75.702792|      null|         null|            null|   null|\n|grid.294071.9|      null|grid.294071.9| null|Institut Universi...|[institut univers...|    [www.iugm.qc.ca]|                null|      [IUGM]|         null|[031z68d90]| [Q3152656]| null|      Montreal|       Quebec|         CA|    null|45.491105| -73.623713|      null|         null|            null|   null|\n|grid.300821.8|      null|grid.300821.8| null|University of Mas...|[umass donahue in...|[www.donahue.umas...|                null|        null|         null|[057e34m22]|[Q30253622]| null|        Hadley|Massachusetts|         US|    null|42.364902| -72.546288|      null|         null|            null|   null|\n|grid.410314.3|      null|grid.410314.3| null|      Bayer (Canada)|             [bayer]|      [www.bayer.ca]|[http://en.wikipe...|        null|         null|[01vnxev61]|[Q29122885]| null|   Mississauga|      Ontario|         CA|    null|43.666091|  -79.59124|      null|         null|            null|   null|\n|grid.410750.7|      null|grid.410750.7| null|Thermo Fisher Sci...|[fei company, the...|[www.thermoscient...|[https://en.wikip...|        null|         null|[05jtcqr88]|[Q30253764]| null|      Shanghai|         null|         CN|    null|31.190599| 121.588336|      null|         null|            null|   null|\n|grid.413164.5|      null|grid.413164.5| null|  458th Hospital PLA|[458th hospital p...|[www.458hospital....|                null|        null|         null|[05bhd7f62]|[Q30254185]| null|     Guangzhou|         null|         CN|    null| 23.13157| 113.312755|      null|         null|            null|   null|\n|grid.414422.5|      null|grid.414422.5| null|Centre Hospitalie...|[centre hospitali...|[www.chumarrakech...|                null|        null|         null|[009nscf91]|[Q30280028]| null|     Marrakesh|         null|         MA|    null|31.663427|  -7.995839|      null|         null|            null|   null|\n|grid.414838.2|      null|grid.414838.2| null|Hospital Militar ...|[hospital militar...|[hmcarlosarvelo.m...|                null|        null|         null|[03n85hy63]|[Q16576090]| null|       Caracas|         null|         VE|    null|10.497892| -66.938855|      null|         null|            null|   null|\n|grid.415331.1|      null|grid.415331.1| null|Gaziantep Onkoloj...|[gaziantep onkolo...|[gul6.bim.gantep....|                null|        null|         null|[00ajg8537]|[Q30280433]| null|     Gaziantep|         null|         TR|    null|37.072312|  37.371895|      null|         null|            null|   null|\n|grid.416095.f|      null|grid.416095.f| null|Social Insurance ...|[social insurance...|[yokohama.jcho.go...|                null|        null|         null|[000vvpv33]|[Q30280765]| null|      Yokohama|         null|         JP|    null|35.440947| 139.643895|      null|         null|            null|   null|\n|grid.416746.6|      null|grid.416746.6| null|St. Joseph's Chil...|[st josephs child...|   [baycare.orgsjch]|                null|        null|         null|[03j7t7330]|[Q30280993]| null|         Tampa|      Florida|         US|    null|27.982615| -82.490853|      null|         null|            null|   null|\n|grid.417487.9|      null|grid.417487.9| null|Twin Star Medical...| [twin star medical]|[www.twinstarmedi...|                null|        null|         null|[045mbap50]|[Q30281340]| null|   Minneapolis|    Minnesota|         US|    null|44.970891| -93.259063|      null|         null|            null|   null|\n|grid.417576.6|      null|grid.417576.6| null|      Abbott (Spain)|            [abbott]|[www.abbott.esind...|[https://en.wikip...|        null|         null|[01w8r0j67]|[Q28974637]| null|        Madrid|         null|         ES|    null|40.493957|  -3.670681|      null|         null|            null|   null|\n|grid.419549.4|      null|grid.419549.4| null|Shell (United Kin...|[royal dutch shel...|   [www.shell.co.uk]|[https://en.wikip...|        null|         null|[05p330p21]|[Q28974622]| null|        London|         null|         GB|    null|51.509508|  -0.119485|      null|         null|            null|   null|\n|grid.420164.5|      null|grid.420164.5| null|Tyrolean Cancer R...|[tcri, tiroler kr...|       [www.tcri.at]|                null|[TCRI, TKFI]|         null|[016sds817]|[Q30282402]| null|     Innsbruck|         null|         AT|    null|47.260848|  11.382692|      null|         null|            null|   null|\n|grid.420585.e|      null|grid.420585.e| null|JP Laboratories (...|   [jp laboratories]|    [www.jplabs.com]|                null|        null|         null|[040ktyf25]|[Q30282627]| null|     Middlesex|   New Jersey|         US|    null|40.571076| -74.489425|      null|         null|            null|   null|\n|grid.420588.3|      null|grid.420588.3| null|   Clark Planetarium| [clark planetarium]|[clarkplanetarium...|[https://en.wikip...|        null|         null|[028ca6f22]| [Q5127353]| null|Salt Lake City|         Utah|         US|    null|40.766613|-111.903376|      null|         null|            null|   null|\n|grid.420601.1|      null|grid.420601.1| null|Aspire Health Par...|[aspire health pa...|[aspirehealthpart...|                null|        null|         null|[04ffs2p40]|[Q30282641]| null|       Orlando|      Florida|         US|    null|28.617023| -81.391444|      null|         null|            null|   null|\n|grid.421475.1|      null|grid.421475.1| null|Consad (United St...|            [consad]|    [www.consad.com]|                null|        null|         null|[02d7h9t50]|[Q30283150]| null|    Pittsburgh| Pennsylvania|         US|    null|40.463578| -79.925272|      null|         null|            null|   null|\n+-------------+----------+-------------+-----+--------------------+--------------------+--------------------+--------------------+------------+-------------+-----------+-----------+-----+--------------+-------------+-----------+--------+---------+-----------+----------+-------------+----------------+-------+\nonly showing top 20 rows\n\nimport org.apache.spark.sql.expressions.Window\n\u001b[1m\u001b[34mwindow\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.expressions.WindowSpec\u001b[0m = org.apache.spark.sql.expressions.WindowSpec@1bf6de99\n\u001b[1m\u001b[34mdist_rows\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId2: string, ringgoldId: string ... 24 more fields]\n\u001b[1m\u001b[34mdouble_Grids\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [gridId: string, count: bigint]\n\u001b[1m\u001b[34mids2drop\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string]\n\u001b[1m\u001b[34mremainingInstitutions\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [affId: string, ringgoldId: string ... 21 more fields]\n\u001b[1m\u001b[34mmergedInstances\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [affId: string, ...\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=269"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=270"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=271"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=273"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=274"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=275"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616338270161_407408359",
   "id": "paragraph_1616338270161_407408359",
   "dateCreated": "2021-03-21T16:51:10+0200",
   "dateStarted": "2021-03-21T16:51:10+0200",
   "dateFinished": "2021-03-21T16:51:12+0200",
   "status": "FINISHED"
  },
  {
   "title": "Name based matching on unmatched MAG",
   "text": "%spark\nimport org.apache.spark.sql.functions._\n\nval unmatchedMag = newInstitutionsdf\n.filter(\n        \n       ($\"magId\"=!=0 && !isnull($\"magId\") \n        && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\"))\n        && ($\"gridId\"===\"\" || isnull($\"gridId\"))) \n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\nunmatchedMag.show(false)\nprintln(unmatchedMag.count())\n\nval name_based_matches_mag = newInstitutionsdf.filter($\"magId\"===\"\" || isnull($\"magId\") ).as(\"df1\").join(broadcast(unmatchedMag.as(\"df2\")),  \n    arrays_overlap($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\") && $\"df1.affId\" =!=$\"df2.affId\" \n            && (arrays_overlap($\"df1.urlsArr\",$\"df2.urlsArr\") || arrays_overlap($\"df1.wikiPageUrlsArr\",$\"df2.wikiPageUrlsArr\")) \n&& $\"df2.countryCode\" === $\"df1.countryCode\"\n    , \"inner\")\n .select( $\"df2.affId\".as(\"affId2\"), \n     $\"df1.ringgoldId\".as(\"ringgoldId\"),$\"df1.gridId\".as(\"gridId\"),\n     when($\"df2.magId\"=!=0 && !isnull($\"df2.magId\"),$\"df2.magId\").otherwise($\"df1.magId\").as(\"magId\"),    \n     \n     $\"df1.affId\".as(\"affId1\"),  $\"df2.name\".as(\"name\"), $\"df1.name\".as(\"name1\"),   \n     \n             array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\").as(\"normalizedNamesArr\"),\n            array_union($\"df1.urlsArr\",$\"df2.urlsArr\").as(\"urlsArr\"),\n            array_union($\"df1.wikiPageUrlsArr\",$\"df2.wikiPageUrlsArr\").as(\"wikiPageUrlsArr\"),\n            array_union($\"df1.acronymsArr\",$\"df2.acronymsArr\").as(\"acronymsArr\"),\n        array_union($\"df1.fundrefIdsArr\",$\"df2.fundrefIdsArr\").as(\"fundrefIdsArr\"),\n        array_union($\"df1.rorIdsArr\",$\"df2.rorIdsArr\").as(\"rorIdsArr\"),\n        array_union($\"df1.wikiIdsArr\",$\"df2.wikiIdsArr\").as(\"wikiIdsArr\"),\n     when($\"df2.email\"=!=0 && !isnull($\"df2.email\"),$\"df2.email\").otherwise($\"df1.email\").as(\"email\"),\n     when($\"df2.city\"=!=0 && !isnull($\"df2.city\"),$\"df2.city\").otherwise($\"df1.city\").as(\"city\"),\n     when($\"df2.state\"=!=0 && !isnull($\"df2.state\"),$\"df2.state\").otherwise($\"df1.state\").as(\"state\"),\n     $\"df2.countryCode\".as(\"countryCode\"),\n     when($\"df2.postCode\"=!=0 && !isnull($\"df2.postCode\"),$\"df2.postCode\").otherwise($\"df1.postCode\").as(\"postCode\"),\n     when($\"df2.latitude\"=!=0 && !isnull($\"df2.latitude\"),$\"df2.latitude\").otherwise($\"df1.latitude\").as(\"latitude\"),\n     when($\"df2.longitude\"=!=0 && !isnull($\"df2.longitude\"),$\"df2.longitude\").otherwise($\"df1.longitude\").as(\"longitude\"),\n     when($\"df2.papercount\"=!=0 && !isnull($\"df2.papercount\"),$\"df2.papercount\").otherwise($\"df1.papercount\").as(\"papercount\"),\n     when($\"df2.citationcount\"=!=0 && !isnull($\"df2.citationcount\"),$\"df2.citationcount\").otherwise($\"df1.citationcount\").as(\"citationcount\"),\n     when($\"df2.paperFamilyCount\"=!=0 && !isnull($\"df2.paperFamilyCount\"),$\"df2.paperFamilyCount\").otherwise($\"df1.paperFamilyCount\").as(\"paperFamilyCount\"),\n     when($\"df2.magrank\"=!=0 && !isnull($\"df2.magrank\"),$\"df2.magrank\").otherwise($\"df1.magrank\").as(\"magrank\"),\n               \n                ((size(array_intersect($\"df1.urlsArr\",$\"df2.urlsArr\")) / size(array_union($\"df1.urlsArr\",$\"df2.urlsArr\")))+\n                (size(array_intersect($\"df1.wikiPageUrlsArr\",$\"df2.wikiPageUrlsArr\")) / size(array_union($\"df1.wikiPageUrlsArr\",$\"df2.wikiPageUrlsArr\")))+\n                (size(array_intersect($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")) / size(array_union($\"df1.normalizedNamesArr\",$\"df2.normalizedNamesArr\")))).as(\"jaccard\")\n         //, ($\"jaccurl\"+$\"jaccname\").as(\"jacc\")\n                \n                )\n        .orderBy($\"df2.papercount\")\n        .cache()\n\nprintln(name_based_matches_mag.count())\nname_based_matches_mag.show(false)\n//4400\n//548",
   "user": "anonymous",
   "dateUpdated": "2021-03-21T16:52:15+0200",
   "config": {
    "title": true,
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Table",
        "chart": {
         "series": [
          {
           "type": "Line",
           "x": {
            "column": "papercount",
            "index": 19.0
           },
           "y": {
            "column": "affId",
            "index": 0.0
           }
          }
         ]
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "\u001b[33mwarning: \u001b[0mthere was one feature warning; for details, enable `:setting -feature' or `:replay -feature'\n+----------+----------+------+----------+------------------------------------+--------------------------------------+-------------------------------------------------------------+------------------------------------------------------------------------+-----------+-------------+---------+----------+-----+----+-----+-----------+--------+----------+-----------+----------+-------------+----------------+-------+\n|affId     |ringgoldId|gridId|magId     |name                                |normalizedNamesArr                    |urlsArr                                                      |wikiPageUrlsArr                                                         |acronymsArr|fundrefIdsArr|rorIdsArr|wikiIdsArr|email|city|state|countryCode|postCode|latitude  |longitude  |papercount|citationcount|paperFamilyCount|magrank|\n+----------+----------+------+----------+------------------------------------+--------------------------------------+-------------------------------------------------------------+------------------------------------------------------------------------+-----------+-------------+---------+----------+-----+----+-----+-----------+--------+----------+-----------+----------+-------------+----------------+-------+\n|204730241 |null      |null  |204730241 |University of Paris                 |[university of paris]                 |[www.aup.edu]                                                |[http://en.wikipedia.org/wiki/University_of_Paris]                      |null       |null         |null     |null      |null |null|null |FR         |null    |48.84861  |2.343333   |170325    |3415062      |165165          |6232   |\n|72090969  |null      |null  |72090969  |Bell Labs                           |[bell labs]                           |[www.bell-labs.com]                                          |[http://en.wikipedia.org/wiki/Bell_Labs]                                |null       |null         |null     |null      |null |null|null |US         |null    |42.3603859|-71.09401  |57761     |2389111      |55994           |6344   |\n|9217761   |null      |null  |9217761   |Westinghouse Electric               |[westinghouse electric]               |[www.westinghouse.com]                                       |[http://en.wikipedia.org/wiki/Westinghouse_Electric_(1886)]             |null       |null         |null     |null      |null |null|null |US         |null    |40.43646  |-79.78011  |37557     |460384       |37303           |7529   |\n|78570951  |null      |null  |78570951  |Monash University, Clayton campus   |[monash university clayton campus]    |null                                                         |[http://en.wikipedia.org/wiki/Monash_University,_Clayton_campus]        |null       |null         |null     |null      |null |null|null |AU         |null    |-37.91    |145.134    |36571     |968776       |35949           |7787   |\n|115475287 |null      |null  |115475287 |Oklahoma State University–Stillwater|[oklahoma state university stillwater]|[go.okstate.edu]                                             |[http://en.wikipedia.org/wiki/Oklahoma_State_University–Stillwater]     |null       |null         |null     |null      |null |null|null |US         |null    |36.13222  |-97.08083  |35813     |770320       |35196           |7604   |\n|56067802  |null      |null  |56067802  |University of Rennes                |[university of rennes]                |null                                                         |[http://en.wikipedia.org/wiki/University_of_Rennes]                     |null       |null         |null     |null      |null |null|null |FR         |null    |48.10804  |-1.68449   |30128     |593994       |29208           |8152   |\n|2738502077|null      |null  |2738502077|Nokia                               |[nokia]                               |[www.nokia.com]                                              |[http://en.wikipedia.org/wiki/Nokia]                                    |null       |null         |null     |null      |null |null|null |FI         |null    |60.22471  |24.7566    |27926     |603288       |27773           |7814   |\n|2279609970|null      |null  |2279609970|university of lille                 |[university of lille]                 |null                                                         |[http://en.wikipedia.org/wiki/University_of_Lille]                      |null       |null         |null     |null      |null |null|null |FR         |null    |46.63728  |2.33826232 |27284     |414080       |26684           |8414   |\n|2251713219|null      |null  |2251713219|Nippon Telegraph and Telephone      |[nippon telegraph and telephone]      |[www.ntt.co.jp]                                              |[http://en.wikipedia.org/wiki/Nippon_Telegraph_and_Telephone]           |null       |null         |null     |null      |null |null|null |JP         |null    |35.68408  |139.808853 |20700     |301633       |20172           |8425   |\n|67826202  |null      |null  |67826202  |Helsinki University of Technology   |[helsinki university of technology]   |[www.tkk.fi]                                                 |[http://en.wikipedia.org/wiki/Helsinki_University_of_Technology]        |null       |null         |null     |null      |null |null|null |FI         |null    |60.18583  |24.82778   |19435     |537733       |18998           |8257   |\n|1306430637|null      |null  |1306430637|St. Vincent's Health System         |[st vincent s health system]          |[www.stvhs.com]                                              |[http://en.wikipedia.org/wiki/St._Vincent's_Health_System]              |null       |null         |null     |null      |null |null|null |US         |null    |33.5083923|-86.78954  |19093     |469231       |18950           |8433   |\n|918370745 |null      |null  |918370745 |College of Health Sciences, Bahrain |[college of health sciences bahrain]  |[www.uob.edu.bhenindex.phpcollegescollege-of-health-sciences]|[http://en.wikipedia.org/wiki/College_of_Health_Sciences,_Bahrain]      |null       |null         |null     |null      |null |null|null |BH         |null    |26.21694  |50.57361   |18923     |244977       |18819           |8828   |\n|862296814 |null      |null  |862296814 |Business International Corporation  |[business international corporation]  |null                                                         |[http://en.wikipedia.org/wiki/Business_International_Corporation]       |null       |null         |null     |null      |null |null|null |US         |null    |40.7140541|-74.00349  |18400     |279573       |18387           |8738   |\n|169238054 |null      |null  |169238054 |Czechoslovak Academy of Sciences    |[czechoslovak academy of sciences]    |null                                                         |[http://en.wikipedia.org/wiki/Czechoslovak_Academy_of_Sciences]         |null       |null         |null     |null      |null |null|null |CZ         |null    |50.0833321|14.416667  |17932     |239285       |17794           |8867   |\n|103775301 |null      |null  |103775301 |PetroChina                          |[petrochina]                          |[www.petrochina.com.cnptr]                                   |[http://en.wikipedia.org/wiki/PetroChina]                               |null       |null         |null     |null      |null |null|null |CN         |null    |39.92855  |116.416367 |17504     |75838        |17495           |9412   |\n|1293067938|null      |null  |1293067938|International Institute of Minnesota|[international institute of minnesota]|[www.iimn.org]                                               |[http://en.wikipedia.org/wiki/International_Institute_of_Minnesota]     |null       |null         |null     |null      |null |null|null |US         |null    |44.94339  |-93.09648  |17092     |420205       |16931           |8611   |\n|865419266 |null      |null  |865419266 |Catholic University of Leuven       |[catholic university of leuven]       |null                                                         |[http://en.wikipedia.org/wiki/Catholic_University_of_Leuven_(1834–1968)]|null       |null         |null     |null      |null |null|null |BE         |null    |50.6697235|4.612222   |16707     |575720       |16472           |8339   |\n|2898336195|null      |null  |2898336195|Netherlands Cancer Institute        |[netherlands cancer institute]        |null                                                         |null                                                                    |null       |null         |null     |null      |null |null|null |NL         |null    |52.3532181|5.00276947 |16602     |903792       |16472           |7907   |\n|193659739 |null      |null  |193659739 |Ciber                               |[ciber]                               |[www.ciber.com]                                              |[http://en.wikipedia.org/wiki/Ciber]                                    |null       |null         |null     |null      |null |null|null |US         |null    |39.6012268|-104.890518|16582     |410341       |16420           |8503   |\n|2948482138|null      |null  |2948482138|Fujifilm Holdings Corporation       |[fujifilm]                            |[www.fujifilm.com]                                           |[https://en.wikipedia.org/wiki/Fujifilm]                                |null       |null         |null     |null      |null |null|null |JP         |null    |35.68321  |139.808945 |14101     |122773       |14088           |9123   |\n+----------+----------+------+----------+------------------------------------+--------------------------------------+-------------------------------------------------------------+------------------------------------------------------------------------+-----------+-------------+---------+----------+-----+----+-----+-----------+--------+----------+-----------+----------+-------------+----------------+-------+\nonly showing top 20 rows\n\n4400\n553\n+----------+----------+-------------+----------+-------------------+---------------------------------------------+------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+-----------+-------------+---------+----------+-----+------------+-----------------+-----------+----------+----------+-----------+----------+-------------+----------------+-------+------------------+\n|affId2    |ringgoldId|gridId       |magId     |affId1             |name                                         |name1                                     |normalizedNamesArr                                                                                                                                                                                                                                                                                                       |urlsArr                                    |wikiPageUrlsArr                                                                                                                |acronymsArr|fundrefIdsArr|rorIdsArr|wikiIdsArr|email|city        |state            |countryCode|postCode  |latitude  |longitude  |papercount|citationcount|paperFamilyCount|magrank|jaccard           |\n+----------+----------+-------------+----------+-------------------+---------------------------------------------+------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+-----------+-------------+---------+----------+-----+------------+-----------------+-----------+----------+----------+-----------+----------+-------------+----------------+-------+------------------+\n|1311255228|581228    |null         |1311255228|581228             |Georgia Museum of Art                        |Georgia Museum of Art                     |[georgia museum of art]                                                                                                                                                                                                                                                                                                  |[georgiamuseum.org]                        |null                                                                                                                           |null       |null         |null     |null      |null |Athens      |GA               |US         |30602-1502|33.9410362|-83.3701248|1         |null         |1               |19426  |3.0               |\n|913647346 |42343     |null         |913647346 |42343              |Precision Castparts Corp.                    |Precision Castparts Corp                  |[precision castparts, precision castparts corp, precision castparts corporation france]                                                                                                                                                                                                                                  |[www.precast.com]                          |null                                                                                                                           |null       |null         |null     |null      |null |Portland    |OR               |US         |97239-4262|45.4897766|-122.673813|1         |null         |1               |19426  |2.3333333333333335|\n|3046555506|142323    |null         |3046555506|142323             |Royal Newfoundland Constabulary              |Royal Newfoundland Constabulary           |[royal newfoundland constabulary]                                                                                                                                                                                                                                                                                        |[www.rnc.gov.nl.ca]                        |null                                                                                                                           |null       |null         |null     |null      |null |St. John's  |NL               |CA         |A1C 2G2   |47.56083  |-52.71219  |1         |null         |1               |19426  |3.0               |\n|293529861 |62867     |null         |293529861 |62867              |Banco de la Nación Argentina                 |Banco de la Nacion Argentina              |[banco de la nacion argentina]                                                                                                                                                                                                                                                                                           |[www.bna.com.ar]                           |null                                                                                                                           |null       |null         |null     |null      |null |Buenos Aires|null             |AR         |1428      |-34.60722 |-58.37139  |2         |2            |2               |18708  |3.0               |\n|158506100 |143035    |null         |158506100 |143035             |Pennsylvania Board of Probation and Parole   |Pennsylvania Board of Probation and Parole|[pbpp, pennsylvania board of probation and parole]                                                                                                                                                                                                                                                                       |[www.pbpp.pa.gov, www.pbpp.state.pa.us]    |null                                                                                                                           |null       |null         |null     |null      |null |Harrisburg  |PA               |US         |17104-2554|40.25986  |-76.88223  |3         |70           |3               |17628  |2.0               |\n|1294539833|392038    |null         |1294539833|392038             |Friedman Foundation for Educational Choice   |EdChoice                                  |[edchoice, friedman foundation for educational choice]                                                                                                                                                                                                                                                                   |[www.edchoice.org]                         |null                                                                                                                           |null       |null         |null     |null      |null |Indianapolis|null             |US         |46204-5102|39.7704   |-86.1604   |3         |4            |3               |18155  |2.5               |\n|1330569906|31614     |null         |1330569906|31614              |Austrian Federal Economic Chamber            |Wirtschaftskammer Osterreich              |[austrian federal economic chamber, wirtschaftskammer osterreich, wko]                                                                                                                                                                                                                                                   |[portal.wko.at, www.wko.at]                |null                                                                                                                           |null       |null         |null     |null      |null |Wien        |Wien             |AT         |1045      |48.19042  |16.36678   |3         |7            |3               |18241  |1.8333333333333333|\n|166926384 |122379    |null         |166926384 |122379             |Loews Hotels                                 |Loews Hotels                              |[loews hotels]                                                                                                                                                                                                                                                                                                           |[www.loewshotels.com]                      |null                                                                                                                           |null       |null         |null     |null      |null |New York    |NY               |US         |10065-8087|36.15005  |-86.80202  |3         |26           |3               |17862  |3.0               |\n|9467721   |54561     |grid.6988.f  |9467721   |grid.6988.f_54561  |International University Audentes            |Tallinna Tehnikaulikool                   |[audentes university, concordia international university estonia, concordia international university in estonia, international university audentes, tallinn polytechnic institute, tallinn technical university, tallinn university of technology, tallinna tehnikaulikool, ttu, tut, таллинскии техническии университет]|[www.ttu.eeen, www.audentes.eu, www.ttu.ee]|[http://en.wikipedia.org/wiki/Tallinn_University_of_Technology, http://en.wikipedia.org/wiki/International_University_Audentes]|null       |null         |null     |null      |null |Tallinn     |Harjumaa         |EE         |19086     |59.40667  |24.72278   |4         |84           |4               |17161  |0.4242424242424242|\n|904483982 |95395     |null         |904483982 |95395              |Singapore American School                    |Singapore American School                 |[sas, singapore american school]                                                                                                                                                                                                                                                                                         |[www.sas.edu.sg]                           |null                                                                                                                           |null       |null         |null     |null      |null |Singapore   |Singapore        |SG         |738547    |1.42598057|103.774612 |4         |29           |4               |17723  |2.5               |\n|336847307 |226406    |null         |336847307 |226406             |Ahlcon International School                  |Ahlcon International School               |[ahlcon international school]                                                                                                                                                                                                                                                                                            |[www.ahlconinternational.com]              |null                                                                                                                           |null       |null         |null     |null      |null |New Delhi   |Delhi            |IN         |110 091   |28.6432056|77.11578   |4         |1            |4               |18035  |3.0               |\n|1341891094|392579    |null         |1341891094|392579             |American Family Association                  |American Family Association               |[afa, american family association, american family association center for law and policy]                                                                                                                                                                                                                                |[www.afa.net]                              |null                                                                                                                           |null       |null         |null     |null      |null |Tupelo      |MS               |US         |38803-2440|34.25741  |-88.70783  |4         |null         |4               |18040  |2.3333333333333335|\n|21602254  |43459     |null         |21602254  |43459              |The Hartford                                 |Hartford Financial Services Group Inc     |[hartford financial services group inc, the hartford]                                                                                                                                                                                                                                                                    |[www.thehartford.com]                      |null                                                                                                                           |null       |null         |null     |null      |null |Hartford    |CT               |US         |06155-0002|41.771595 |-72.6885147|5         |17           |5               |17650  |2.5               |\n|203156710 |86779     |null         |203156710 |86779              |International School of Brussels             |International School of Brussels          |[international school of brussels, isb]                                                                                                                                                                                                                                                                                  |[www.isb.be]                               |null                                                                                                                           |null       |null         |null     |null      |null |Brussels    |null             |BE         |1170      |50.78889  |4.41694    |5         |67           |5               |17426  |2.5               |\n|1340609872|252080    |null         |1340609872|252080             |International Fertilizer Industry Association|International Fertilizer Association      |[ifa, international fertilizer association, international fertilizer industry association]                                                                                                                                                                                                                               |[www.fertilizer.org]                       |null                                                                                                                           |null       |null         |null     |null      |null |Paris       |Île-de-France    |FR         |75116     |48.86279  |2.34096    |5         |34           |5               |17446  |2.3333333333333335|\n|251190476 |113774    |null         |251190476 |113774             |Ontario Securities Commission                |Ontario Securities Commission             |[commission des valeurs mobilieres de lontario, cvmo, ontario securities commission, osc]                                                                                                                                                                                                                                |[www.osc.gov.on.ca]                        |null                                                                                                                           |null       |null         |null     |null      |null |Toronto     |ON               |CA         |M5H 3S8   |43.65236  |-79.38062  |5         |13           |5               |17709  |2.25              |\n|262538115 |14578     |null         |262538115 |14578              |Alliance of Automobile Manufacturers         |Alliance of Automobile Manufacturers      |[alliance of automobile manufacturers]                                                                                                                                                                                                                                                                                   |[www.autoalliance.org]                     |null                                                                                                                           |null       |null         |null     |null      |null |Washington  |DC               |US         |20001     |38.89037  |-77.03196  |5         |61           |4               |17120  |3.0               |\n|280214520 |477503    |null         |280214520 |477503             |RIB Software AG                              |RIB Software AG                           |[rib software ag]                                                                                                                                                                                                                                                                                                        |[www.rib-software.com]                     |null                                                                                                                           |null       |null         |null     |null      |null |Stuttgart   |Baden-Württemberg|DE         |70567     |48.72796  |9.135      |6         |2            |6               |17615  |3.0               |\n|115102062 |489472    |null         |115102062 |489472             |Australian National University Library       |Australian National University Library    |[anu library, australian national university library]                                                                                                                                                                                                                                                                    |[anulib.anu.edu.au]                        |null                                                                                                                           |null       |null         |null     |null      |null |Canberra    |ACT              |AU         |0200      |-35.278   |149.12     |6         |8            |6               |17470  |2.5               |\n|2809498410|82888     |grid.496853.5|2809498410|grid.496853.5_82888|Kimmage Development Studies Centre           |Kimmage Development Studies Centre        |[kdsc, kimmage development studies centre, kimmage dsc]                                                                                                                                                                                                                                                                  |[kimmagedsc.ie, www.kimmagedsc.ie]         |[https://en.wikipedia.org/wiki/Kimmage_Development_Studies_Centre]                                                             |null       |null         |null     |null      |null |Dublin      |null             |IE         |D12 P5YP  |53.30857  |-6.309929  |6         |34           |6               |17444  |1.8333333333333333|\n+----------+----------+-------------+----------+-------------------+---------------------------------------------+------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+-----------+-------------+---------+----------+-----+------------+-----------------+-----------+----------+----------+-----------+----------+-------------+----------------+-------+------------------+\nonly showing top 20 rows\n\nimport org.apache.spark.sql.functions._\n\u001b[1m\u001b[34munmatchedMag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string, ringgoldId: string ... 21 more fields]\n\u001b[1m\u001b[34mname_based_matches_mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId2: string, ringgoldId: string ... 24 more fields]\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=276"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=277"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=278"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=279"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=280"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616338335587_1923499709",
   "id": "paragraph_1616338335587_1923499709",
   "dateCreated": "2021-03-21T16:52:15+0200",
   "dateStarted": "2021-03-21T16:52:15+0200",
   "dateFinished": "2021-03-21T16:52:17+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\nval df22 = name_based_matches_mag.select(countDistinct(\"ringgoldId\"))\ndf22.show(false)\n\nval df3 = name_based_matches_mag.select(countDistinct(\"gridId\"))\ndf3.show(false)\n\nval df4 = name_based_matches_mag.select(countDistinct(\"magId\"))\ndf4.show(false)\n\nval double_Grids = name_based_matches_mag.groupBy($\"gridId\")\n  .agg(count(\"gridId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Grids.count())\n\nval double_Mag = name_based_matches_mag.groupBy($\"magId\")\n  .agg(count(\"magId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Mag.count())\n\nval double_ringgoldId= name_based_matches_mag.groupBy($\"ringgoldId\")\n  .agg(count(\"ringgoldId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_ringgoldId.count())\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-21T16:43:52+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console"
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "+--------------------------+\n|count(DISTINCT ringgoldId)|\n+--------------------------+\n|551                       |\n+--------------------------+\n\n+----------------------+\n|count(DISTINCT gridId)|\n+----------------------+\n|67                    |\n+----------------------+\n\n+---------------------+\n|count(DISTINCT magId)|\n+---------------------+\n|542                  |\n+---------------------+\n\n3\n11\n2\n\u001b[1m\u001b[34mdf22\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT ringgoldId): bigint]\n\u001b[1m\u001b[34mdf3\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT gridId): bigint]\n\u001b[1m\u001b[34mdf4\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT magId): bigint]\n\u001b[1m\u001b[34mdouble_Grids\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [gridId: string, count: bigint]\n\u001b[1m\u001b[34mdouble_Mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [magId: bigint, count: bigint]\n\u001b[1m\u001b[34mdouble_ringgoldId\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [ringgoldId: string, count: bigint]\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=253"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=254"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=255"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=256"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=257"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=258"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616337832248_2047494183",
   "id": "paragraph_1616337832248_2047494183",
   "dateCreated": "2021-03-21T16:43:52+0200",
   "dateStarted": "2021-03-21T16:43:52+0200",
   "dateFinished": "2021-03-21T16:43:57+0200",
   "status": "FINISHED"
  },
  {
   "title": "Merge matched MAG",
   "text": "%spark\n\nimport org.apache.spark.sql.expressions.Window\n\nval window = Window.partitionBy(\"magId\").orderBy(\"jaccard\")\n\nval dist_rows_mag = name_based_matches_mag.withColumn(\"row_num\", row_number().over(window))\n  .filter($\"row_num\" === 1)\n  .drop(\"row_num\").cache()\n\n \nprintln(\"dist_rows_mag:\"+dist_rows_mag.count())\n\nval ids2drop_mag = dist_rows_mag.select($\"affId2\".as(\"affId\")).union(dist_rows_mag.select($\"affId1\".as(\"affId\")).distinct())\n\nprintln(\"ids2drop_mag:\"+ids2drop_mag.count())\nprintln(\"newInstitutionsdf:\"+newInstitutionsdf.count())\n\nval remainingInstitutions_mag = newInstitutionsdf.join(ids2drop_mag,ids2drop_mag(\"affId\") === newInstitutionsdf(\"affId\"), \"leftanti\") \n.select( $\"affId\", $\"ringgoldId\",$\"gridId\",$\"magId\", $\"name\",\n           $\"normalizedNamesArr\",    $\"urlsArr\",     $\"wikiPageUrlsArr\",\n           $\"acronymsArr\",  $\"fundrefIdsArr\",  $\"rorIdsArr\",   $\"wikiIdsArr\",\n     $\"email\", $\"city\",  $\"state\",  $\"countryCode\",   $\"postCode\",   $\"latitude\",    $\"longitude\",\n     $\"papercount\",     $\"citationcount\",     $\"paperFamilyCount\",     $\"magrank\")\n\n                      \nprintln(\"remainingInstitutions_mag:\"+remainingInstitutions_mag.count())\n\n          \nval mergedInstances_mag = dist_rows_mag\n.select( \n    concat(when($\"magId\"=!=0 && !isnull($\"magId\"),$\"magId\").otherwise(\"\")\n         ,when($\"gridId\"=!=\"\" && !isnull($\"gridId\"), concat(lit(\"_\"), $\"gridId\")).otherwise(\"\")\n         ,when($\"ringgoldId\"=!=\"\" && !isnull($\"ringgoldId\"), concat(lit(\"_\"), $\"ringgoldId\")).otherwise(\"\")) \n    .as(\"affId\"),                  \n    $\"ringgoldId\",$\"gridId\",$\"magId\", $\"name\",\n           $\"normalizedNamesArr\",    $\"urlsArr\",     $\"wikiPageUrlsArr\",\n           $\"acronymsArr\",  $\"fundrefIdsArr\",  $\"rorIdsArr\",   $\"wikiIdsArr\",\n     $\"email\", $\"city\",  $\"state\",  $\"countryCode\",   $\"postCode\",   $\"latitude\",    $\"longitude\",\n     $\"papercount\",     $\"citationcount\",     $\"paperFamilyCount\",     $\"magrank\")\n//.show(true)\n\nval  newInstitutionsdf_full =  remainingInstitutions_mag.union(mergedInstances_mag)\n        .withColumn(\"normalizedNames\",array_join($\"normalizedNamesArr\", \"||\"))\n          .withColumn(\"wikiPageUrls\",array_join($\"wikiPageUrlsArr\", \"||\"))\n          .withColumn(\"urls\",array_join($\"urlsArr\", \"||\"))\n          .withColumn(\"acronyms\",array_join($\"acronymsArr\", \"||\"))\n          .withColumn(\"fundrefIds\",array_join($\"fundrefIdsArr\", \"||\"))\n          .withColumn(\"rorIds\",array_join($\"rorIdsArr\", \"||\"))\n          .withColumn(\"wikiIds\",array_join($\"wikiIdsArr\", \"||\"))\n          .withColumn(\"urls\",array_join($\"urlsArr\", \"||\"))\n        .cache()\n    \nprintln(\"newInstitutionsdf_full:\"+newInstitutionsdf_full.count())\nnewInstitutionsdf_full.show(false)\n            \n",
   "user": "anonymous",
   "dateUpdated": "2021-03-21T16:55:12+0200",
   "config": {
    "title": true,
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console",
        "chart": {
         "series": [
          {
           "type": "Line",
           "x": {
            "column": "affId",
            "index": 0.0
           },
           "y": {
            "column": "latitude",
            "index": 17.0
           }
          }
         ]
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "dist_rows_mag:542\nids2drop_mag:1083\nnewInstitutionsdf:600782\nremainingInstitutions_mag:599699\nnewInstitutionsdf_full:600241\n+-------------+----------+-------------+-----+----------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------+--------------------------------------------------------+------------+-------------+-----------+-----------+-----+--------------+-------------+-----------+--------+---------+-----------+----------+-------------+----------------+-------+-------------------------------------------------------------------------------+------------------------------------------------------+--------------------------------+----------+----------+---------+---------+\n|affId        |ringgoldId|gridId       |magId|name                                                      |normalizedNamesArr                                                               |urlsArr                           |wikiPageUrlsArr                                         |acronymsArr |fundrefIdsArr|rorIdsArr  |wikiIdsArr |email|city          |state        |countryCode|postCode|latitude |longitude  |papercount|citationcount|paperFamilyCount|magrank|normalizedNames                                                                |wikiPageUrls                                          |urls                            |acronyms  |fundrefIds|rorIds   |wikiIds  |\n+-------------+----------+-------------+-----+----------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------+--------------------------------------------------------+------------+-------------+-----------+-----------+-----+--------------+-------------+-----------+--------+---------+-----------+----------+-------------+----------------+-------+-------------------------------------------------------------------------------+------------------------------------------------------+--------------------------------+----------+----------+---------+---------+\n|grid.282237.e|null      |grid.282237.e|null |Proportional Technologies                                 |[proportional technologies, pti]                                                 |[www.proportionaltech.comnew_site]|null                                                    |[PTI]       |null         |[02ccwf677]|[Q30253499]|null |Houston       |Texas        |US         |null    |29.687341|-95.388437 |null      |null         |null            |null   |proportional technologies||pti                                                 |null                                                  |www.proportionaltech.comnew_site|PTI       |null      |02ccwf677|Q30253499|\n|grid.292707.9|null      |grid.292707.9|null |Canadian Foundation For The International Space University|[canadian foundation for the international space university, cfisu]              |[www.cfisu.ca]                    |null                                                    |[CFISU]     |null         |[01wpkc438]|[Q30253589]|null |Ottawa        |Ontario      |CA         |null    |45.412415|-75.702792 |null      |null         |null            |null   |canadian foundation for the international space university||cfisu              |null                                                  |www.cfisu.ca                    |CFISU     |null      |01wpkc438|Q30253589|\n|grid.294071.9|null      |grid.294071.9|null |Institut Universitaire de Gériatrie de Montréal           |[institut universitaire de geriatrie de montreal]                                |[www.iugm.qc.ca]                  |null                                                    |[IUGM]      |null         |[031z68d90]|[Q3152656] |null |Montreal      |Quebec       |CA         |null    |45.491105|-73.623713 |null      |null         |null            |null   |institut universitaire de geriatrie de montreal                                |null                                                  |www.iugm.qc.ca                  |IUGM      |null      |031z68d90|Q3152656 |\n|grid.300821.8|null      |grid.300821.8|null |University of Massachusetts Donahue Institute             |[umass donahue institute, university of massachusetts donahue institute]         |[www.donahue.umassp.edu]          |null                                                    |null        |null         |[057e34m22]|[Q30253622]|null |Hadley        |Massachusetts|US         |null    |42.364902|-72.546288 |null      |null         |null            |null   |umass donahue institute||university of massachusetts donahue institute         |null                                                  |www.donahue.umassp.edu          |null      |null      |057e34m22|Q30253622|\n|grid.410314.3|null      |grid.410314.3|null |Bayer (Canada)                                            |[bayer]                                                                          |[www.bayer.ca]                    |[http://en.wikipedia.org/wiki/Bayer]                    |null        |null         |[01vnxev61]|[Q29122885]|null |Mississauga   |Ontario      |CA         |null    |43.666091|-79.59124  |null      |null         |null            |null   |bayer                                                                          |http://en.wikipedia.org/wiki/Bayer                    |www.bayer.ca                    |null      |null      |01vnxev61|Q29122885|\n|grid.410750.7|null      |grid.410750.7|null |Thermo Fisher Scientific (China)                          |[fei company, thermo fisher scientific]                                          |[www.thermoscientific.cn]         |[https://en.wikipedia.org/wiki/Thermo_Fisher_Scientific]|null        |null         |[05jtcqr88]|[Q30253764]|null |Shanghai      |null         |CN         |null    |31.190599|121.588336 |null      |null         |null            |null   |fei company||thermo fisher scientific                                          |https://en.wikipedia.org/wiki/Thermo_Fisher_Scientific|www.thermoscientific.cn         |null      |null      |05jtcqr88|Q30253764|\n|grid.413164.5|null      |grid.413164.5|null |458th Hospital PLA                                        |[458th hospital pla, 中国人民解放军第四五八]                                     |[www.458hospital.com]             |null                                                    |null        |null         |[05bhd7f62]|[Q30254185]|null |Guangzhou     |null         |CN         |null    |23.13157 |113.312755 |null      |null         |null            |null   |458th hospital pla||中国人民解放军第四五八                                     |null                                                  |www.458hospital.com             |null      |null      |05bhd7f62|Q30254185|\n|grid.414422.5|null      |grid.414422.5|null |Centre Hospitalier Universitaire Mohammed VI              |[centre hospitalier universitaire mohammed vi, chu mohammed vi]                  |[www.chumarrakech.ma]             |null                                                    |null        |null         |[009nscf91]|[Q30280028]|null |Marrakesh     |null         |MA         |null    |31.663427|-7.995839  |null      |null         |null            |null   |centre hospitalier universitaire mohammed vi||chu mohammed vi                  |null                                                  |www.chumarrakech.ma             |null      |null      |009nscf91|Q30280028|\n|grid.414838.2|null      |grid.414838.2|null |Hospital Militar Dr. Carlos Arvelo                        |[hospital militar de caracas, hospital militar dr carlos arvelo]                 |[hmcarlosarvelo.mil.ve]           |null                                                    |null        |null         |[03n85hy63]|[Q16576090]|null |Caracas       |null         |VE         |null    |10.497892|-66.938855 |null      |null         |null            |null   |hospital militar de caracas||hospital militar dr carlos arvelo                 |null                                                  |hmcarlosarvelo.mil.ve           |null      |null      |03n85hy63|Q16576090|\n|grid.415331.1|null      |grid.415331.1|null |Gaziantep Onkoloji Hastanesi                              |[gaziantep onkoloji hastanesi]                                                   |[gul6.bim.gantep.edu.tr~onkoloji] |null                                                    |null        |null         |[00ajg8537]|[Q30280433]|null |Gaziantep     |null         |TR         |null    |37.072312|37.371895  |null      |null         |null            |null   |gaziantep onkoloji hastanesi                                                   |null                                                  |gul6.bim.gantep.edu.tr~onkoloji |null      |null      |00ajg8537|Q30280433|\n|grid.416095.f|null      |grid.416095.f|null |Social Insurance Yokohama Central Hospital                |[social insurance yokohama central hospital, 横浜中央病院]                       |[yokohama.jcho.go.jp]             |null                                                    |null        |null         |[000vvpv33]|[Q30280765]|null |Yokohama      |null         |JP         |null    |35.440947|139.643895 |null      |null         |null            |null   |social insurance yokohama central hospital||横浜中央病院                       |null                                                  |yokohama.jcho.go.jp             |null      |null      |000vvpv33|Q30280765|\n|grid.416746.6|null      |grid.416746.6|null |St. Joseph's Children's Hospital                          |[st josephs childrens hospital]                                                  |[baycare.orgsjch]                 |null                                                    |null        |null         |[03j7t7330]|[Q30280993]|null |Tampa         |Florida      |US         |null    |27.982615|-82.490853 |null      |null         |null            |null   |st josephs childrens hospital                                                  |null                                                  |baycare.orgsjch                 |null      |null      |03j7t7330|Q30280993|\n|grid.417487.9|null      |grid.417487.9|null |Twin Star Medical (United States)                         |[twin star medical]                                                              |[www.twinstarmedical.com]         |null                                                    |null        |null         |[045mbap50]|[Q30281340]|null |Minneapolis   |Minnesota    |US         |null    |44.970891|-93.259063 |null      |null         |null            |null   |twin star medical                                                              |null                                                  |www.twinstarmedical.com         |null      |null      |045mbap50|Q30281340|\n|grid.417576.6|null      |grid.417576.6|null |Abbott (Spain)                                            |[abbott]                                                                         |[www.abbott.esindex.asp]          |[https://en.wikipedia.org/wiki/Abbott_Laboratories]     |null        |null         |[01w8r0j67]|[Q28974637]|null |Madrid        |null         |ES         |null    |40.493957|-3.670681  |null      |null         |null            |null   |abbott                                                                         |https://en.wikipedia.org/wiki/Abbott_Laboratories     |www.abbott.esindex.asp          |null      |null      |01w8r0j67|Q28974637|\n|grid.419549.4|null      |grid.419549.4|null |Shell (United Kingdom)                                    |[royal dutch shell, shell, shell u k, shell u k limited]                         |[www.shell.co.uk]                 |[https://en.wikipedia.org/wiki/Shell_Oil_Company]       |null        |null         |[05p330p21]|[Q28974622]|null |London        |null         |GB         |null    |51.509508|-0.119485  |null      |null         |null            |null   |royal dutch shell||shell||shell u k||shell u k limited                         |https://en.wikipedia.org/wiki/Shell_Oil_Company       |www.shell.co.uk                 |null      |null      |05p330p21|Q28974622|\n|grid.420164.5|null      |grid.420164.5|null |Tyrolean Cancer Research Institute                        |[tcri, tiroler krebsforschungsinstitut, tkfi, tyrolean cancer research institute]|[www.tcri.at]                     |null                                                    |[TCRI, TKFI]|null         |[016sds817]|[Q30282402]|null |Innsbruck     |null         |AT         |null    |47.260848|11.382692  |null      |null         |null            |null   |tcri||tiroler krebsforschungsinstitut||tkfi||tyrolean cancer research institute|null                                                  |www.tcri.at                     |TCRI||TKFI|null      |016sds817|Q30282402|\n|grid.420585.e|null      |grid.420585.e|null |JP Laboratories (United States)                           |[jp laboratories]                                                                |[www.jplabs.com]                  |null                                                    |null        |null         |[040ktyf25]|[Q30282627]|null |Middlesex     |New Jersey   |US         |null    |40.571076|-74.489425 |null      |null         |null            |null   |jp laboratories                                                                |null                                                  |www.jplabs.com                  |null      |null      |040ktyf25|Q30282627|\n|grid.420588.3|null      |grid.420588.3|null |Clark Planetarium                                         |[clark planetarium]                                                              |[clarkplanetarium.org]            |[https://en.wikipedia.org/wiki/Clark_Planetarium]       |null        |null         |[028ca6f22]|[Q5127353] |null |Salt Lake City|Utah         |US         |null    |40.766613|-111.903376|null      |null         |null            |null   |clark planetarium                                                              |https://en.wikipedia.org/wiki/Clark_Planetarium       |clarkplanetarium.org            |null      |null      |028ca6f22|Q5127353 |\n|grid.420601.1|null      |grid.420601.1|null |Aspire Health Partners                                    |[aspire health partners]                                                         |[aspirehealthpartners.com]        |null                                                    |null        |null         |[04ffs2p40]|[Q30282641]|null |Orlando       |Florida      |US         |null    |28.617023|-81.391444 |null      |null         |null            |null   |aspire health partners                                                         |null                                                  |aspirehealthpartners.com        |null      |null      |04ffs2p40|Q30282641|\n|grid.421475.1|null      |grid.421475.1|null |Consad (United States)                                    |[consad]                                                                         |[www.consad.com]                  |null                                                    |null        |null         |[02d7h9t50]|[Q30283150]|null |Pittsburgh    |Pennsylvania |US         |null    |40.463578|-79.925272 |null      |null         |null            |null   |consad                                                                         |null                                                  |www.consad.com                  |null      |null      |02d7h9t50|Q30283150|\n+-------------+----------+-------------+-----+----------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------+--------------------------------------------------------+------------+-------------+-----------+-----------+-----+--------------+-------------+-----------+--------+---------+-----------+----------+-------------+----------------+-------+-------------------------------------------------------------------------------+------------------------------------------------------+--------------------------------+----------+----------+---------+---------+\nonly showing top 20 rows\n\nimport org.apache.spark.sql.expressions.Window\n\u001b[1m\u001b[34mwindow\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.expressions.WindowSpec\u001b[0m = org.apache.spark.sql.expressions.WindowSpec@71647920\n\u001b[1m\u001b[34mdist_rows_mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId2: string, ringgoldId: string ... 24 more fields]\n\u001b[1m\u001b[34mids2drop_mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string]\n\u001b[1m\u001b[34mremainingInstitutions_mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [affId: string, ringgoldId: string ... 21 more fields]\n\u001b[1m\u001b[34mmergedInstances_mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [affId: string, ringgoldId: string ... 21 more fields]\n\u001b[1m\u001b[34mnewInstitutionsdf_full\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset...\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=281"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=282"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=283"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=285"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=287"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=288"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616338512326_2018344210",
   "id": "paragraph_1616338512326_2018344210",
   "dateCreated": "2021-03-21T16:55:12+0200",
   "dateStarted": "2021-03-21T16:55:12+0200",
   "dateFinished": "2021-03-21T16:55:19+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\n//newInsitutionsdf_full.filter($\"magId\"===\"9467721\").show(false)\nval df22 = newInstitutionsdf_full.select(countDistinct(\"ringgoldId\"))\ndf22.show(false)\n\nval df3 = newInstitutionsdf_full.select(countDistinct(\"gridId\"))\ndf3.show(false)\n\nval df4 = newInstitutionsdf_full.select(countDistinct(\"magId\"))\ndf4.show(false)\n\nval double_Grids = newInstitutionsdf_full.groupBy($\"gridId\")\n  .agg(count(\"gridId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Grids.count())\n\nval double_Mag = newInstitutionsdf_full.groupBy($\"magId\")\n  .agg(count(\"magId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_Mag.count())\n\nval double_ringgoldId= newInstitutionsdf_full.groupBy($\"ringgoldId\")\n  .agg(count(\"ringgoldId\").alias(\"count\"))\n  .filter($\"count\">1)\n\nprintln(double_ringgoldId.count())\n\n\nprintln(\"newInstitutionsdf_full:\"+newInstitutionsdf_full.count())\nprintln(\"newInstitutionsdf_full_100pubs:\"+newInstitutionsdf_full.filter($\"paperCount\">100).count())\n\nval unMatchedMAG = newInstitutionsdf_full\n.filter(\n    ($\"gridId\"===\"\" || isnull($\"gridId\"))\n     && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\"))        \n        &&  $\"magId\"=!=0 && !isnull($\"magId\")\n        //&& $\"paperCount\" > 1000\n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\n\nunMatchedMAG.show(20)\nprintln(\"unMatchedMAG:\"+unMatchedMAG.count())\nprintln(\"unMatchedMAG_100pubs:\"+unMatchedMAG.filter($\"paperCount\">100).count())\n\n\n\n\nval grid_noRing = newInstitutionsdf_full\n.filter(\n    $\"gridId\"=!=\"\" && !isnull($\"gridId\")\n \n        && ($\"ringgoldId\"===\"\" || isnull($\"ringgoldId\")) \n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\ngrid_noRing.show(true)\nprintln(\"grid_noRing:\"+grid_noRing.count())\nprintln(\"grid_noRing_100pubs:\"+grid_noRing.filter($\"paperCount\">100).count())\n\n\nval noRing = newInstitutionsdf_full\n.filter(\n    $\"ringgoldId\"===\"\" || isnull($\"ringgoldId\") \n            )        \n        .orderBy($\"paperCount\" desc)\n        .cache()\ngrid_noRing.show(true)\nprintln(\"noRing:\"+noRing.count())\nprintln(\"noRing_100pubs:\"+noRing.filter($\"paperCount\">100).count())\n\n//newInsitutionsdf_full.filter(array_contains($\"normalizedNamesArr\",\"university of paris\")).show(false)\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-21T17:11:23+0200",
   "config": {
    "results": [
     {}
    ]
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "size": {
        "height": 741.0
       },
       "state": {
        "currentPage": "Console"
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "\u001b[33mwarning: \u001b[0mthere were three feature warnings; for details, enable `:setting -feature' or `:replay -feature'\n+--------------------------+\n|count(DISTINCT ringgoldId)|\n+--------------------------+\n|544340                    |\n+--------------------------+\n\n+----------------------+\n|count(DISTINCT gridId)|\n+----------------------+\n|99780                 |\n+----------------------+\n\n+---------------------+\n|count(DISTINCT magId)|\n+---------------------+\n|25800                |\n+---------------------+\n\n1081\n0\n1383\nnewInstitutionsdf_full:600241\nnewInstitutionsdf_full_100pubs:15051\n+----------+----------+------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+---------+----------+-----+----+-----+-----------+--------+----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+------+-------+\n|     affId|ringgoldId|gridId|     magId|                name|  normalizedNamesArr|             urlsArr|     wikiPageUrlsArr|acronymsArr|fundrefIdsArr|rorIdsArr|wikiIdsArr|email|city|state|countryCode|postCode|  latitude|  longitude|papercount|citationcount|paperFamilyCount|magrank|     normalizedNames|        wikiPageUrls|                urls|acronyms|fundrefIds|rorIds|wikiIds|\n+----------+----------+------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+---------+----------+-----+----+-----+-----------+--------+----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+------+-------+\n| 204730241|      null|  null| 204730241| University of Paris|[university of pa...|       [www.aup.edu]|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         FR|    null|  48.84861|   2.343333|    170325|      3415062|          165165|   6232| university of paris|http://en.wikiped...|         www.aup.edu|    null|      null|  null|   null|\n|  72090969|      null|  null|  72090969|           Bell Labs|         [bell labs]| [www.bell-labs.com]|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         US|    null|42.3603859|  -71.09401|     57761|      2389111|           55994|   6344|           bell labs|http://en.wikiped...|   www.bell-labs.com|    null|      null|  null|   null|\n|   9217761|      null|  null|   9217761|Westinghouse Elec...|[westinghouse ele...|[www.westinghouse...|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         US|    null|  40.43646|  -79.78011|     37557|       460384|           37303|   7529|westinghouse elec...|http://en.wikiped...|www.westinghouse.com|    null|      null|  null|   null|\n|  78570951|      null|  null|  78570951|Monash University...|[monash universit...|                null|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         AU|    null|    -37.91|    145.134|     36571|       968776|           35949|   7787|monash university...|http://en.wikiped...|                null|    null|      null|  null|   null|\n|  56067802|      null|  null|  56067802|University of Rennes|[university of re...|                null|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         FR|    null|  48.10804|   -1.68449|     30128|       593994|           29208|   8152|university of rennes|http://en.wikiped...|                null|    null|      null|  null|   null|\n|2738502077|      null|  null|2738502077|               Nokia|             [nokia]|     [www.nokia.com]|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         FI|    null|  60.22471|    24.7566|     27926|       603288|           27773|   7814|               nokia|http://en.wikiped...|       www.nokia.com|    null|      null|  null|   null|\n|2279609970|      null|  null|2279609970| university of lille|[university of li...|                null|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         FR|    null|  46.63728| 2.33826232|     27284|       414080|           26684|   8414| university of lille|http://en.wikiped...|                null|    null|      null|  null|   null|\n|  67826202|      null|  null|  67826202|Helsinki Universi...|[helsinki univers...|        [www.tkk.fi]|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         FI|    null|  60.18583|   24.82778|     19435|       537733|           18998|   8257|helsinki universi...|http://en.wikiped...|          www.tkk.fi|    null|      null|  null|   null|\n|1306430637|      null|  null|1306430637|St. Vincent's Hea...|[st vincent s hea...|     [www.stvhs.com]|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         US|    null|33.5083923|  -86.78954|     19093|       469231|           18950|   8433|st vincent s heal...|http://en.wikiped...|       www.stvhs.com|    null|      null|  null|   null|\n| 918370745|      null|  null| 918370745|College of Health...|[college of healt...|[www.uob.edu.bhen...|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         BH|    null|  26.21694|   50.57361|     18923|       244977|           18819|   8828|college of health...|http://en.wikiped...|www.uob.edu.bheni...|    null|      null|  null|   null|\n| 862296814|      null|  null| 862296814|Business Internat...|[business interna...|                null|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         US|    null|40.7140541|  -74.00349|     18400|       279573|           18387|   8738|business internat...|http://en.wikiped...|                null|    null|      null|  null|   null|\n| 169238054|      null|  null| 169238054|Czechoslovak Acad...|[czechoslovak aca...|                null|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         CZ|    null|50.0833321|  14.416667|     17932|       239285|           17794|   8867|czechoslovak acad...|http://en.wikiped...|                null|    null|      null|  null|   null|\n| 103775301|      null|  null| 103775301|          PetroChina|        [petrochina]|[www.petrochina.c...|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         CN|    null|  39.92855| 116.416367|     17504|        75838|           17495|   9412|          petrochina|http://en.wikiped...|www.petrochina.co...|    null|      null|  null|   null|\n|1293067938|      null|  null|1293067938|International Ins...|[international in...|      [www.iimn.org]|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         US|    null|  44.94339|  -93.09648|     17092|       420205|           16931|   8611|international ins...|http://en.wikiped...|        www.iimn.org|    null|      null|  null|   null|\n| 865419266|      null|  null| 865419266|Catholic Universi...|[catholic univers...|                null|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         BE|    null|50.6697235|   4.612222|     16707|       575720|           16472|   8339|catholic universi...|http://en.wikiped...|                null|    null|      null|  null|   null|\n|2898336195|      null|  null|2898336195|Netherlands Cance...|[netherlands canc...|                null|                null|       null|         null|     null|      null| null|null| null|         NL|    null|52.3532181| 5.00276947|     16602|       903792|           16472|   7907|netherlands cance...|                null|                null|    null|      null|  null|   null|\n| 193659739|      null|  null| 193659739|               Ciber|             [ciber]|     [www.ciber.com]|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         US|    null|39.6012268|-104.890518|     16582|       410341|           16420|   8503|               ciber|http://en.wikiped...|       www.ciber.com|    null|      null|  null|   null|\n|  81082344|      null|  null|  81082344|     Science College|   [science college]|                null|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         GB|    null|54.5608864|-2.21251178|     14090|       104123|           14032|   9449|     science college|http://en.wikiped...|                null|    null|      null|  null|   null|\n|   2388115|      null|  null|   2388115|Japan Atomic Ener...|[japan atomic ene...|                null|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         JP|    null|36.2816467| 139.077271|     13733|       160277|           13642|   9075|japan atomic ener...|http://en.wikiped...|                null|    null|      null|  null|   null|\n| 119233137|      null|  null| 119233137|Nicolaus Copernic...|[nicolaus coperni...|      [www.umk.plen]|[http://en.wikipe...|       null|         null|     null|      null| null|null| null|         PL|    null|  53.01833|   18.57222|     13268|       129111|           13027|   9411|nicolaus copernic...|http://en.wikiped...|        www.umk.plen|    null|      null|  null|   null|\n+----------+----------+------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+---------+----------+-----+----+-----+-----------+--------+----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+------+-------+\nonly showing top 20 rows\n\nunMatchedMAG:3858\nunMatchedMAG_100pubs:1810\n+--------------------+----------+-------------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+-----------+-----------+-----+-----------+--------------+-----------+--------+-----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+---------+---------+\n|               affId|ringgoldId|       gridId|     magId|                name|  normalizedNamesArr|             urlsArr|     wikiPageUrlsArr|acronymsArr|fundrefIdsArr|  rorIdsArr| wikiIdsArr|email|       city|         state|countryCode|postCode|   latitude|  longitude|papercount|citationcount|paperFamilyCount|magrank|     normalizedNames|        wikiPageUrls|                urls|acronyms|fundrefIds|   rorIds|  wikiIds|\n+--------------------+----------+-------------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+-----------+-----------+-----+-----------+--------------+-----------+--------+-----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+---------+---------+\n|1320697193_grid.4...|      null|grid.471046.0|1320697193|          Canon Inc.|[canon, canon inc...|[canon.jp, global...|[http://en.wikipe...|       null|         null|[05gg0gh87]|   [Q62621]| null|      Tokyo|          null|         FR|    null| 48.1325569|  -1.624552|     70036|       915384|           70007|   7138|canon||canon inc|...|http://en.wikiped...|canon.jp||global....|    null|      null|05gg0gh87|   Q62621|\n|1306287861_grid.5...|      null|grid.508713.8|1306287861|          Mitsubishi|[mitsubishi, mits...|[www.mitsubishi.c...|[http://en.wikipe...|       null|         null|[0234cd281]|  [Q183275]| null|      Tokyo|          null|         JP|    null|   35.68408| 139.808853|     51641|       830631|           51461|   7224|mitsubishi||mitsu...|http://en.wikiped...|www.mitsubishi.co...|    null|      null|0234cd281|  Q183275|\n|1293612202_grid.4...|      null|grid.481782.0|1293612202|              Toyota|[toyota, toyota a...|[www.toyota-globa...|[http://en.wikipe...|       null|         null|[05p0pbv75]|[Q30273407]| null|   Safenwil|          null|         US|    null| 29.7511616|  -95.36219|     47660|       641509|           47342|   7529|toyota||toyota ag...|http://en.wikiped...|www.toyota-global...|    null|      null|05p0pbv75|Q30273407|\n|19268510_grid.472...|      null|grid.472821.a|  19268510|            Qualcomm|          [qualcomm]|  [www.qualcomm.com]|[http://en.wikipe...|       null|         null|[04d3djg48]|[Q28974281]| null|Farnborough|          null|         US|    null|    32.8952|  -117.1957|     37137|       709987|           36892|   7743|            qualcomm|http://en.wikiped...|    www.qualcomm.com|    null|      null|04d3djg48|Q28974281|\n|1309191912_grid.4...|      null|grid.419178.2|1309191912|Research Triangle...|[research triangl...|       [www.rtp.org]|[http://en.wikipe...|      [RTP]|         null|[03eqttr49]| [Q1187093]| null|     Durham|North Carolina|         US|    null|   35.90806|  -78.86278|     34844|      1288744|           34452|   7436|research triangle...|http://en.wikiped...|         www.rtp.org|     RTP|      null|03eqttr49| Q1187093|\n|1306339040_grid.2...|      null|grid.28287.37|1306339040|            Ericsson|[ericson, ericsso...|[www.ericsson.com...|[http://en.wikipe...|       null|         null|[05a7rhx54]|   [Q52618]| null|      Kista|          null|         SE|    null|   59.40567|   17.95499|     34654|       507958|           34419|   7833|ericson||ericsson...|http://en.wikiped...|www.ericsson.com|...|    null|      null|05a7rhx54|   Q52618|\n|1326427960_grid.4...|      null|grid.475296.b|1326427960|Fred Hutchinson C...|[cape town hvtn i...|[www.chil.org.za,...|[http://en.wikipe...|     [CHIL]|         null|[00wdsp051]|[Q30268063]| null|  Cape Town|          null|         ZA|    null|  -33.92478| 18.4238224|     31242|      1746457|           30747|   7127|cape town hvtn im...|http://en.wikiped...|www.chil.org.za||...|    CHIL|      null|00wdsp051|Q30268063|\n|1288702032_grid.4...|      null|grid.488641.7|1288702032|Ministry of Educa...|[ministere de led...|[www.education.go...|[http://en.wikipe...|       null|         null|[05p70jq59]| [Q1937182]| null| Wellington|          null|         NZ|    null|-41.2756157| 174.778778|     26081|       354365|           25896|   8668|ministere de ledu...|http://en.wikiped...|www.education.gov...|    null|      null|05p70jq59| Q1937182|\n|39854257_grid.474...|      null|grid.474748.c|  39854257| Mitsubishi Electric|[mitsubishi elect...|[de.mitsubishiele...|[http://en.wikipe...|    [MELCO]|         null|[04ccqwj03]|[Q29124061]| null|   Ratingen|          null|         DE|    null| 51.2926445|   6.866118|     23954|       205056|           23609|   8470| mitsubishi electric|http://en.wikiped...|de.mitsubishielec...|   MELCO|      null|04ccqwj03|Q29124061|\n|142066694_grid.48...|      null|grid.481662.f| 142066694|Industrial Techno...|[industrial techn...|[www.itri.org.tw,...|[http://en.wikipe...|     [ITRI]|         null|[04wwsbd59]|[Q30273357]| null|   San Jose|    California|         US|    null|   37.39521|-121.927765|     23051|       286524|           22934|   8581|industrial techno...|http://en.wikiped...|www.itri.org.tw||...|    ITRI|      null|04wwsbd59|Q30273357|\n|140025399_grid.46...|      null|grid.461671.3| 140025399| Hochschule Hannover|[fachhochschule h...|[www.hs-hannover....|[http://en.wikipe...|      [HsH]|         null|[03m2kj587]|  [Q224514]| null|    Hanover|          null|         DE|    null|   52.35361|   9.724167|     21597|       347157|           21496|   8623|fachhochschule ha...|http://en.wikiped...|www.hs-hannover.d...|     HsH|      null|03m2kj587|  Q224514|\n|1290603121_grid.4...|      null|grid.475671.6|1290603121|World Health Orga...|[who, world healt...|[www.who.int, www...|[http://en.wikipe...|      [WHO]|         null|[047bn1w15]|[Q30268380]| null|  Islamabad|          null|         CH|    null|   46.23222|    6.13417|     21092|       923493|           20884|   7512|who||world health...|http://en.wikiped...|www.who.int||www....|     WHO|      null|047bn1w15|Q30268380|\n|2802905097_grid.4...|      null|grid.416526.2|2802905097|  St Mary's Hospital|[centre hospitali...|  [www.smhc.qc.caen]|[http://en.wikipe...|       null|         null|[03s3dhf22]| [Q2945713]| null|   Montreal|        Quebec|         CA|    null|   45.49472|  -73.62417|     20256|       485439|           20136|   8303|centre hospitalie...|http://en.wikiped...|    www.smhc.qc.caen|    null|      null|03s3dhf22| Q2945713|\n|318025780_grid.48...|      null|grid.481660.d| 318025780|             Foxconn|[foxconn, foxconn...|   [www.foxconn.com]|[http://en.wikipe...|       null|         null|[043xc2b47]|[Q30343831]| null|   San Jose|    California|         US|    null| 37.3512878|-121.890228|     20107|       133317|           20107|   8939|foxconn||foxconn ...|http://en.wikiped...|     www.foxconn.com|    null|      null|043xc2b47|Q30343831|\n|97429440_grid.8155.9|      null|  grid.8155.9|  97429440| University of Wales|[prifysgol cymru,...|   [www.wales.ac.uk]|[http://en.wikipe...|       null|  [100009878]|[01se4f844]| [Q1072029]| null|    Cardiff|          null|         GB|    null|   51.48543|  -3.181384|     18585|       581733|           18482|   8256|prifysgol cymru||...|http://en.wikiped...|     www.wales.ac.uk|    null| 100009878|01se4f844| Q1072029|\n|36527812_grid.473...|      null|grid.473117.7|  36527812|         Halliburton|       [halliburton]|[www.halliburton....|[http://en.wikipe...|       null|         null|[01jn7ba52]|[Q28974293]| null|   Arbroath|          null|         US|    null|   29.78918|-95.3155441|     18124|       219219|           17912|   8890|         halliburton|http://en.wikiped...|www.halliburton.c...|    null|      null|01jn7ba52|Q28974293|\n|1311921367_grid.4...|      null|grid.471110.2|1311921367|Advanced Micro De...|[advanced micro d...|[www.amd.com, www...|[http://en.wikipe...|      [AMD]|         null|[02yh0k313]|[Q28971311]| null|    Markham|       Ontario|         US|    null|  37.386673|-121.998764|     16658|       267927|           16622|   8471|advanced micro de...|http://en.wikiped...|www.amd.com||www....|     AMD|      null|02yh0k313|Q28971311|\n|127558574_grid.10...|      null|grid.10760.30| 127558574|                 DSM|[dsm, dutch state...|[www.dsm.com, www...|[http://en.wikipe...|       null|         null|[00k01kt20]|  [Q902650]| null|    Heerlen|          null|         CH|    null| 47.5396576|   7.740793|     13417|       323294|           13206|   8239|dsm||dutch state ...|http://en.wikiped...|www.dsm.com||www....|    null|      null|00k01kt20|  Q902650|\n|33375025_grid.472...|      null|grid.472764.4|  33375025|              Airbus|            [airbus]|[www.airbus.com, ...|[http://en.wikipe...|       null|         null|[05tw0wf88]|[Q28971301]| null|  Bengaluru|     Karnataka|         FR|    null|   43.61207| 1.37002969|     12345|        71331|           12299|   9559|              airbus|http://en.wikiped...|www.airbus.com||w...|    null|      null|05tw0wf88|Q28971301|\n|1296127346_grid.4...|      null|grid.472794.b|1296127346|            Broadcom|[avago technologi...|[www.broadcom.com...|[http://en.wikipe...|       null|         null|[01jsrac29]|[Q28975963]| null|    Raanana|          null|         US|    null| 33.6427078|-117.849937|     12152|       202854|           12125|   9083|avago technologie...|http://en.wikiped...|www.broadcom.com|...|    null|      null|01jsrac29|Q28975963|\n+--------------------+----------+-------------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+-----------+-----------+-----+-----------+--------------+-----------+--------+-----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+---------+---------+\nonly showing top 20 rows\n\ngrid_noRing:50584\ngrid_noRing_100pubs:736\n+--------------------+----------+-------------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+-----------+-----------+-----+-----------+--------------+-----------+--------+-----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+---------+---------+\n|               affId|ringgoldId|       gridId|     magId|                name|  normalizedNamesArr|             urlsArr|     wikiPageUrlsArr|acronymsArr|fundrefIdsArr|  rorIdsArr| wikiIdsArr|email|       city|         state|countryCode|postCode|   latitude|  longitude|papercount|citationcount|paperFamilyCount|magrank|     normalizedNames|        wikiPageUrls|                urls|acronyms|fundrefIds|   rorIds|  wikiIds|\n+--------------------+----------+-------------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+-----------+-----------+-----+-----------+--------------+-----------+--------+-----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+---------+---------+\n|1320697193_grid.4...|      null|grid.471046.0|1320697193|          Canon Inc.|[canon, canon inc...|[canon.jp, global...|[http://en.wikipe...|       null|         null|[05gg0gh87]|   [Q62621]| null|      Tokyo|          null|         FR|    null| 48.1325569|  -1.624552|     70036|       915384|           70007|   7138|canon||canon inc|...|http://en.wikiped...|canon.jp||global....|    null|      null|05gg0gh87|   Q62621|\n|1306287861_grid.5...|      null|grid.508713.8|1306287861|          Mitsubishi|[mitsubishi, mits...|[www.mitsubishi.c...|[http://en.wikipe...|       null|         null|[0234cd281]|  [Q183275]| null|      Tokyo|          null|         JP|    null|   35.68408| 139.808853|     51641|       830631|           51461|   7224|mitsubishi||mitsu...|http://en.wikiped...|www.mitsubishi.co...|    null|      null|0234cd281|  Q183275|\n|1293612202_grid.4...|      null|grid.481782.0|1293612202|              Toyota|[toyota, toyota a...|[www.toyota-globa...|[http://en.wikipe...|       null|         null|[05p0pbv75]|[Q30273407]| null|   Safenwil|          null|         US|    null| 29.7511616|  -95.36219|     47660|       641509|           47342|   7529|toyota||toyota ag...|http://en.wikiped...|www.toyota-global...|    null|      null|05p0pbv75|Q30273407|\n|19268510_grid.472...|      null|grid.472821.a|  19268510|            Qualcomm|          [qualcomm]|  [www.qualcomm.com]|[http://en.wikipe...|       null|         null|[04d3djg48]|[Q28974281]| null|Farnborough|          null|         US|    null|    32.8952|  -117.1957|     37137|       709987|           36892|   7743|            qualcomm|http://en.wikiped...|    www.qualcomm.com|    null|      null|04d3djg48|Q28974281|\n|1309191912_grid.4...|      null|grid.419178.2|1309191912|Research Triangle...|[research triangl...|       [www.rtp.org]|[http://en.wikipe...|      [RTP]|         null|[03eqttr49]| [Q1187093]| null|     Durham|North Carolina|         US|    null|   35.90806|  -78.86278|     34844|      1288744|           34452|   7436|research triangle...|http://en.wikiped...|         www.rtp.org|     RTP|      null|03eqttr49| Q1187093|\n|1306339040_grid.2...|      null|grid.28287.37|1306339040|            Ericsson|[ericson, ericsso...|[www.ericsson.com...|[http://en.wikipe...|       null|         null|[05a7rhx54]|   [Q52618]| null|      Kista|          null|         SE|    null|   59.40567|   17.95499|     34654|       507958|           34419|   7833|ericson||ericsson...|http://en.wikiped...|www.ericsson.com|...|    null|      null|05a7rhx54|   Q52618|\n|1326427960_grid.4...|      null|grid.475296.b|1326427960|Fred Hutchinson C...|[cape town hvtn i...|[www.chil.org.za,...|[http://en.wikipe...|     [CHIL]|         null|[00wdsp051]|[Q30268063]| null|  Cape Town|          null|         ZA|    null|  -33.92478| 18.4238224|     31242|      1746457|           30747|   7127|cape town hvtn im...|http://en.wikiped...|www.chil.org.za||...|    CHIL|      null|00wdsp051|Q30268063|\n|1288702032_grid.4...|      null|grid.488641.7|1288702032|Ministry of Educa...|[ministere de led...|[www.education.go...|[http://en.wikipe...|       null|         null|[05p70jq59]| [Q1937182]| null| Wellington|          null|         NZ|    null|-41.2756157| 174.778778|     26081|       354365|           25896|   8668|ministere de ledu...|http://en.wikiped...|www.education.gov...|    null|      null|05p70jq59| Q1937182|\n|39854257_grid.474...|      null|grid.474748.c|  39854257| Mitsubishi Electric|[mitsubishi elect...|[de.mitsubishiele...|[http://en.wikipe...|    [MELCO]|         null|[04ccqwj03]|[Q29124061]| null|   Ratingen|          null|         DE|    null| 51.2926445|   6.866118|     23954|       205056|           23609|   8470| mitsubishi electric|http://en.wikiped...|de.mitsubishielec...|   MELCO|      null|04ccqwj03|Q29124061|\n|142066694_grid.48...|      null|grid.481662.f| 142066694|Industrial Techno...|[industrial techn...|[www.itri.org.tw,...|[http://en.wikipe...|     [ITRI]|         null|[04wwsbd59]|[Q30273357]| null|   San Jose|    California|         US|    null|   37.39521|-121.927765|     23051|       286524|           22934|   8581|industrial techno...|http://en.wikiped...|www.itri.org.tw||...|    ITRI|      null|04wwsbd59|Q30273357|\n|140025399_grid.46...|      null|grid.461671.3| 140025399| Hochschule Hannover|[fachhochschule h...|[www.hs-hannover....|[http://en.wikipe...|      [HsH]|         null|[03m2kj587]|  [Q224514]| null|    Hanover|          null|         DE|    null|   52.35361|   9.724167|     21597|       347157|           21496|   8623|fachhochschule ha...|http://en.wikiped...|www.hs-hannover.d...|     HsH|      null|03m2kj587|  Q224514|\n|1290603121_grid.4...|      null|grid.475671.6|1290603121|World Health Orga...|[who, world healt...|[www.who.int, www...|[http://en.wikipe...|      [WHO]|         null|[047bn1w15]|[Q30268380]| null|  Islamabad|          null|         CH|    null|   46.23222|    6.13417|     21092|       923493|           20884|   7512|who||world health...|http://en.wikiped...|www.who.int||www....|     WHO|      null|047bn1w15|Q30268380|\n|2802905097_grid.4...|      null|grid.416526.2|2802905097|  St Mary's Hospital|[centre hospitali...|  [www.smhc.qc.caen]|[http://en.wikipe...|       null|         null|[03s3dhf22]| [Q2945713]| null|   Montreal|        Quebec|         CA|    null|   45.49472|  -73.62417|     20256|       485439|           20136|   8303|centre hospitalie...|http://en.wikiped...|    www.smhc.qc.caen|    null|      null|03s3dhf22| Q2945713|\n|318025780_grid.48...|      null|grid.481660.d| 318025780|             Foxconn|[foxconn, foxconn...|   [www.foxconn.com]|[http://en.wikipe...|       null|         null|[043xc2b47]|[Q30343831]| null|   San Jose|    California|         US|    null| 37.3512878|-121.890228|     20107|       133317|           20107|   8939|foxconn||foxconn ...|http://en.wikiped...|     www.foxconn.com|    null|      null|043xc2b47|Q30343831|\n|97429440_grid.8155.9|      null|  grid.8155.9|  97429440| University of Wales|[prifysgol cymru,...|   [www.wales.ac.uk]|[http://en.wikipe...|       null|  [100009878]|[01se4f844]| [Q1072029]| null|    Cardiff|          null|         GB|    null|   51.48543|  -3.181384|     18585|       581733|           18482|   8256|prifysgol cymru||...|http://en.wikiped...|     www.wales.ac.uk|    null| 100009878|01se4f844| Q1072029|\n|36527812_grid.473...|      null|grid.473117.7|  36527812|         Halliburton|       [halliburton]|[www.halliburton....|[http://en.wikipe...|       null|         null|[01jn7ba52]|[Q28974293]| null|   Arbroath|          null|         US|    null|   29.78918|-95.3155441|     18124|       219219|           17912|   8890|         halliburton|http://en.wikiped...|www.halliburton.c...|    null|      null|01jn7ba52|Q28974293|\n|1311921367_grid.4...|      null|grid.471110.2|1311921367|Advanced Micro De...|[advanced micro d...|[www.amd.com, www...|[http://en.wikipe...|      [AMD]|         null|[02yh0k313]|[Q28971311]| null|    Markham|       Ontario|         US|    null|  37.386673|-121.998764|     16658|       267927|           16622|   8471|advanced micro de...|http://en.wikiped...|www.amd.com||www....|     AMD|      null|02yh0k313|Q28971311|\n|127558574_grid.10...|      null|grid.10760.30| 127558574|                 DSM|[dsm, dutch state...|[www.dsm.com, www...|[http://en.wikipe...|       null|         null|[00k01kt20]|  [Q902650]| null|    Heerlen|          null|         CH|    null| 47.5396576|   7.740793|     13417|       323294|           13206|   8239|dsm||dutch state ...|http://en.wikiped...|www.dsm.com||www....|    null|      null|00k01kt20|  Q902650|\n|33375025_grid.472...|      null|grid.472764.4|  33375025|              Airbus|            [airbus]|[www.airbus.com, ...|[http://en.wikipe...|       null|         null|[05tw0wf88]|[Q28971301]| null|  Bengaluru|     Karnataka|         FR|    null|   43.61207| 1.37002969|     12345|        71331|           12299|   9559|              airbus|http://en.wikiped...|www.airbus.com||w...|    null|      null|05tw0wf88|Q28971301|\n|1296127346_grid.4...|      null|grid.472794.b|1296127346|            Broadcom|[avago technologi...|[www.broadcom.com...|[http://en.wikipe...|       null|         null|[01jsrac29]|[Q28975963]| null|    Raanana|          null|         US|    null| 33.6427078|-117.849937|     12152|       202854|           12125|   9083|avago technologie...|http://en.wikiped...|www.broadcom.com|...|    null|      null|01jsrac29|Q28975963|\n+--------------------+----------+-------------+----------+--------------------+--------------------+--------------------+--------------------+-----------+-------------+-----------+-----------+-----+-----------+--------------+-----------+--------+-----------+-----------+----------+-------------+----------------+-------+--------------------+--------------------+--------------------+--------+----------+---------+---------+\nonly showing top 20 rows\n\nnoRing:54442\nnoRing_100pubs:2546\n\u001b[1m\u001b[34mdf22\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT ringgoldId): bigint]\n\u001b[1m\u001b[34mdf3\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT gridId): bigint]\n\u001b[1m\u001b[34mdf4\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [count(DISTINCT magId): bigint]\n\u001b[1m\u001b[34mdouble_Grids\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [gridId: string, count: bigint]\n\u001b[1m\u001b[34mdouble_Mag\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [magId: bigint, count: bigint]\n\u001b[1m\u001b[34mdouble_ringgoldId\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [ringgoldId: string, count: bigint]\n\u001b[1m\u001b[34munMatchedMAG\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: stri...\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=289"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=290"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=291"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=292"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=293"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=294"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=295"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=296"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=297"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=298"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=299"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=300"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=301"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=302"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=303"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=304"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=305"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=306"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=307"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=308"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=309"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=310"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=311"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=312"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616339483179_1421113444",
   "id": "paragraph_1616339483179_1421113444",
   "dateCreated": "2021-03-21T17:11:23+0200",
   "dateStarted": "2021-03-21T17:11:23+0200",
   "dateFinished": "2021-03-21T17:11:42+0200",
   "status": "FINISHED"
  },
  {
   "text": "%spark\n\n    \n/*\nnewInstitutionsdf_full.write.mode(\"overwrite\").parquet(s\"$ORGS_HOME/newInstitutions.parquet\")\n\nnewInstitutionsdf_full\n        .select($\"affId\", $\"ringgoldId\",$\"gridId\",$\"magId\", $\"name\",\n           $\"normalizedNames\",    $\"urls\",     $\"wikiPageUrls\",\n           $\"acronyms\",  $\"fundrefIds\",  $\"rorIds\",   $\"wikiIds\",\n     $\"email\", $\"city\",  $\"state\",  $\"countryCode\",   $\"postCode\",   $\"latitude\",    $\"longitude\",\n     $\"papercount\",     $\"citationcount\",     $\"paperFamilyCount\",     $\"magrank\")\n        .coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/PKGInstitutions.csv\")\n\nnewInstitutionsdf_full\n        .select($\"affId\", $\"ringgoldId\",$\"gridId\",$\"magId\",   $\"wikiIds\", $\"name\",           \n           $\"acronyms\",  $\"fundrefIds\",  $\"rorIds\", \n       $\"countryCode\", \n     $\"papercount\")\n        .coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/PKGInstitutions_basic.csv\")\n*/\n\nval  cases = newInstitutionsdf_full\n.filter( \n    ($\"normalizedNames\".contains(\"rio tinto\")    &&  $\"urls\".contains(\"riotinto.com\"))            ||\n            $\"normalizedNames\".contains(\"adva optical networking\") ||        \n            array_contains($\"normalizedNamesArr\",\"toyota\") || \n            array_contains($\"normalizedNamesArr\",\"mitsubishi\") || $\"ringgoldid\"===\"50230\" ||\n     array_contains($\"normalizedNamesArr\",\"canon\") || $\"ringgoldid\"===\"11776\" || \n    array_contains($\"normalizedNamesArr\",\"university of paris\") || array_contains($\"wikiIdsArr\",\"Q1155944\") || array_contains($\"wikiIdsArr\",\"Q1235608\") || \n    array_contains($\"normalizedNamesArr\",\"oklahoma state university\") ||\n    array_contains($\"normalizedNamesArr\",\"ericsson\") ||\n    array_contains($\"normalizedNamesArr\",\"advanced micro devices\") ||\n    array_contains($\"normalizedNamesArr\",\"mitsubishi electric\") ||\n    array_contains($\"normalizedNamesArr\",\"world health organization\")  || $\"normalizedNames\".contains(\"world health organization\") || \n            array_contains($\"normalizedNamesArr\",\"qualcomm\") \n            ).select($\"affId\", $\"ringgoldId\",$\"gridId\",$\"magId\", $\"name\",\n           $\"normalizedNames\",    $\"urls\",     $\"wikiPageUrls\",\n           $\"acronyms\",  $\"fundrefIds\",  $\"rorIds\",   $\"wikiIds\",\n      $\"countryCode\",\n     $\"papercount\" ).cache()\n\n      cases.show()      \n        cases.coalesce(1).write.mode(\"overwrite\").options(Map(\"sep\"->\",\", \"header\"-> \"true\")).csv(s\"$ORGS_HOME/cases.csv\")\n\n",
   "user": "anonymous",
   "dateUpdated": "2021-03-21T19:05:51+0200",
   "config": {
    "results": [
     {}
    ],
    "title": true
   },
   "settings": {
    "params": {
     "bdtMeta": {
      "inlay": {
       "state": {
        "currentPage": "Console",
        "table": {
         "visibleRow": 3.0
        },
        "chart": {
         "series": [
          {
           "type": "Line",
           "x": {
            "column": "affId",
            "index": 0.0
           },
           "y": {
            "column": "latitude",
            "index": 17.0
           }
          }
         ]
        }
       }
      }
     }
    },
    "forms": {}
   },
   "results": {
    "code": "SUCCESS",
    "msg": [
     {
      "type": "TEXT",
      "data": "+--------------------+----------+-------------+-----+--------------------+--------------------+--------------------+--------------------+--------+----------+--------------------+--------------------+-----------+----------+\n|               affId|ringgoldId|       gridId|magId|                name|     normalizedNames|                urls|        wikiPageUrls|acronyms|fundrefIds|              rorIds|             wikiIds|countryCode|papercount|\n+--------------------+----------+-------------+-----+--------------------+--------------------+--------------------+--------------------+--------+----------+--------------------+--------------------+-----------+----------+\n|grid.426427.1_495602|    495602|grid.426427.1| null|World Health Orga...|who italy||world ...|www.who.intcountr...|https://en.wikipe...|     WHO|      null|           0558jee48|           Q30285506|         IT|      null|\n| grid.420226.0_93773|     93773|grid.420226.0| null|World Health Orga...|bureau regional d...|www.euro.who.inte...|https://en.wikipe...|WHO EURO|      null|           01rz37c55|           Q33121054|         DK|      null|\n|grid.481807.2_421292|    421292|grid.481807.2| null|    Canon France SAS|canon||canon fran...|www.canon.fr||www...|https://en.wikipe...|    null|      null|           02se40x69|           Q30273420|         FR|      null|\n|              547681|    547681|         null| null|Organisation mond...|oms departement d...|www.who.intviolen...|                null|    null|      null|                null|                null|         CH|      null|\n|               66793|     66793|         null| null|World Health Orga...|who afghanistan||...|www.emro.who.intc...|                null|    null|      null|                null|                null|         AF|      null|\n| grid.462605.3_13340|     13340|grid.462605.3| null|Mitsubishi Denki ...|mitsubishi denki ...|www.mitsubishiele...|https://en.wikipe...|    null|      null|           033y26782|              Q53257|         JP|      null|\n|              216013|    216013|         null| null|World Health Orga...|world health orga...|www.afro.who.intc...|                null|    null|      null|                null|                null|         SC|      null|\n|              243839|    243839|         null| null|World Health Orga...|who china office|...|www.wpro.who.intc...|                null|    null|      null|                null|                null|         CN|      null|\n| grid.465204.1_50230|     50230|grid.465204.1| null|Mitsubishi Shoji ...|kowa jitsugyo kai...|www.mitsubishicor...|https://en.wikipe...|      MC|      null|           014m1ef46|             Q650745|         JP|      null|\n| grid.463718.f_93781|     93781|grid.463718.f| null|Organisation mond...|oms pour afrique|...|www.afro.who.inte...|https://en.wikipe...|WHO AFRO|      null|           04rtx9382|           Q30262121|         CG|      null|\n|              515652|    515652|         null| null|Rio Tinto Fer et ...|rio tinto fer et ...|www.riotinto.comc...|                null|    null|      null|                null|                null|         CA|      null|\n|       grid.457504.7|      null|grid.457504.7| null|   Ericsson (Norway)|            ericsson|  www.ericsson.comno|                null|    null|      null|           012674h84|           Q30338850|         NO|      null|\n|       grid.472821.a|      null|grid.472821.a| null|Qualcomm (United ...|       csr||qualcomm|    www.qualcomm.com|https://en.wikipe...|    null|      null|04d3djg48||04dxzc906|Q28974281||Q30256109|         GB|      null|\n|               64025|     64025|         null| null|World Health Orga...|who turkey||world...|www.euro.who.inte...|                null|    null|      null|                null|                null|         TR|      null|\n| grid.417259.c_68803|     68803|grid.417259.c| null|World Health Orga...|organisation mond...|www.who.intcountr...|https://en.wikipe...|     WHO|      null|           055ttwk14|           Q50356723|         EG|      null|\n|       grid.508252.8|      null|grid.508252.8| null|World Health Orga...|world health orga...|www.emro.who.intc...|https://en.wikipe...|    null|      null|           0292bqz47|           Q97041550|         JO|      null|\n|              306090|    306090|         null| null|World Health Orga...|who viet nam||wor...|www2.wpro.who.int...|                null|    null|      null|                null|                null|         VN|      null|\n|       grid.508254.e|      null|grid.508254.e| null|World Health Orga...|who||world health...|www.emro.who.intf...|https://en.wikipe...|     WHO|      null|           005xgxx88|           Q97041556|         MA|      null|\n|              524714|    524714|         null| null|World Health Orga...|who country offic...|www.afro.who.intc...|                null|    null|      null|                null|                null|         NG|      null|\n|              339421|    339421|         null| null|Organizacion Mund...|oms espana||organ...|www.euro.who.inte...|                null|    null|      null|                null|                null|         ES|      null|\n+--------------------+----------+-------------+-----+--------------------+--------------------+--------------------+--------------------+--------+----------+--------------------+--------------------+-----------+----------+\nonly showing top 20 rows\n\n\u001b[1m\u001b[34mcases\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [affId: string, ringgoldId: string ... 12 more fields]\n"
     }
    ]
   },
   "apps": [],
   "runtimeInfos": {
    "jobUrl": {
     "propertyName": "jobUrl",
     "label": "SPARK JOB",
     "tooltip": "View in Spark web UI",
     "group": "spark",
     "values": [
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=366"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=367"
      },
      {
       "jobUrl": "http://omiros.station:4040/jobs/job?id=368"
      }
     ],
     "interpreterSettingId": "spark"
    }
   },
   "progressUpdateIntervalMs": 500.0,
   "jobName": "paragraph_1616346351327_873461438",
   "id": "paragraph_1616346351327_873461438",
   "dateCreated": "2021-03-21T19:05:51+0200",
   "dateStarted": "2021-03-21T19:05:51+0200",
   "dateFinished": "2021-03-21T19:05:54+0200",
   "status": "FINISHED",
   "title": "Analyze problematic cases"
  }
 ],
 "name": "Zeppelin Notebook",
 "id": "",
 "noteParams": {},
 "noteForms": {},
 "angularObjects": {},
 "config": {
  "isZeppelinNotebookCronEnable": false,
  "looknfeel": "default",
  "personalizedMode": "false"
 },
 "info": {}
}